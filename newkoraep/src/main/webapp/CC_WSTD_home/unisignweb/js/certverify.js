var __certverify=function(b){var p=function(k){function m(d,a,f){if(!d||!a)return null;var c=null;if(1&b.ESVS.Mode){if(b.plugin().valid){console.log("*** Call VerifyCertWithCRL Func ***");var h=b.plugin().VerifyCertWithCRL(d);if(0===h)c=a.IDS_VERIFY_CERT_OK;else{var e=b.plugin().GetLastErrorCode();d=b.plugin().GetLastErrorMessage();console.log("*** VerifyCertWithCRL return error ***");console.log("Err Code : ",e,"\nErr Msg : ",d);switch(e){case 3001:c=a.IDS_VERIFY_CERT_ERROR_INVALID_TYPE;break;case 3002:c=a.IDS_VERIFY_CERT_ERROR_DECODING_FAIL;break;case 3003:c=a.IDS_VERIFY_CERT_ERROR_LOADING_FAIL;break;case 3005:c=a.IDS_VERIFY_CERT_ERROR_EXPIRED;break;case 3009:c=a.IDS_VERIFY_CERT_ERROR_NO_DP;break;case 3010:c=a.IDS_VERIFY_CERT_ERROR_WRONG_DP;break;case 3013:c=a.IDS_VERIFY_CERT_ERROR_WRONG_CRL+"<br><br>Code [ "+e+" ]";break;case 3014:c=a.IDS_VERIFY_CERT_ERROR_EXPIRED_CRL;break;case 3015:c=a.IDS_VERIFY_CERT_ERROR_WRONG_CRL+"<br><br>Code [ "+e+" ]";break;case 3016:c=a.IDS_VERIFY_CERT_ERROR_HOLDED+"<br><br>Code [ "+e+" ]";break;case 3017:c=a.IDS_VERIFY_CERT_ERROR_REVOKED+"<br><br>Code [ "+e+" ]";break;case 3059:c=a.IDS_VERIFY_CERT_ERROR_GETTING_CRL_FROM_LDAP_FAIL;break;case 3060:c=a.IDS_VERIFY_CERT_ERROR_CHECKING_ISSUER_FAIL;break;case 3062:c=a.IDS_VERIFY_CERT_ERROR_CA_CERT_PATH;break;case 3063:c=a.IDS_VERIFY_CERT_ERROR_ROOTCA_CERT_PATH;break;case 3900:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_UNSUPERSEDED;break;case 3901:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_KEYCOMPROMISE;break;case 3902:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_CACOMPROMISE;break;case 3903:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_AFFILIATIONCHANGED;break;case 3904:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_SUPERSEDED;break;case 3905:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_CESSATIONOFOPERATION;break;case 3906:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_HOLD;break;case 3907:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_REMOVEFROMCRL;break;case 3908:c=a.IDS_VERIFY_CERT_ERROR_REVOKED+"<br><br>Code [ "+e+" ]";break;case 3909:c=a.IDS_VERIFY_CERT_ERROR_REVOKED+"<br><br>Code [ "+e+" ]";break;case 3999:c=a.IDS_VERIFY_CERT_ERROR_EXPIRED+"<br><br>Code [ "+e+" ]";break;default:c=a.IDS_VERIFY_CERT_ERROR_UNKNOWN+"<br><br>Code [ "+e+" ]"}}}else b.uiUtil().msgBox(a.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD),c=null;return c}if(4&b.ESVS.Mode)if(b.nimservice())b.nimservice().ValidateCertificate(d,function(b,d,e,h){if(0==b)if(999==e)c=a.IDS_VERIFY_CERT_OK;else switch(e){case 0:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_UNSUPERSEDED;break;case 1:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_KEYCOMPROMISE;break;case 2:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_CACOMPROMISE;break;case 3:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_AFFILIATIONCHANGED;break;case 4:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_SUPERSEDED;break;case 5:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_CESSATIONOFOPERATION;break;case 6:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_HOLD;break;case 8:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_REMOVEFROMCRL;break;case 9:c=a.IDS_VERIFY_CERT_ERROR_REVOKED+"<br><br>Code [ "+e+" ]";break;case 10:c=a.IDS_VERIFY_CERT_ERROR_REVOKED+"<br><br>Code [ "+e+" ]";break;case 11:c=a.IDS_VERIFY_CERT_ERROR_EXPIRED;break;default:c=a.IDS_VERIFY_CERT_ERROR_UNKNOWN+"<br><br>Code [ "+e+" ]"}else c=d;f(c)});else return b.uiUtil().msgBox(a.IDS_MSGBOX_NIM_ERROR_UNLOAD),c=null;else if(2==b.ESVS.Mode){var g=null;try{var k=b.usWebToolkit.pki.createCaStore(),g=b.PFSH.GetCACerts(),l;for(l in g)caCert=g[l],k.addCertificate(b.usWebToolkit.pki.certificateFromBase64(caCert));if(null==b.certsList||null==b.certsList.list||0>=b.certsList.list.length)return"";var n=b.usWebToolkit.pki.certificateFromBase64(b.certsList.list[d-1].cert);b.usWebToolkit.pki.verifyCertificateChain(k,n,function(b,d,g){!0===b?(h=0,c=a.IDS_VERIFY_CERT_OK):(h=-1,null!=g&&void 0!=g&&0<=g.indexOf("Certificate is not valid yet or has expired")?(e=3005,c=a.IDS_VERIFY_CERT_ERROR_EXPIRED):null!=g&&void 0!=g&&0<=g.indexOf("no parent issuer, so certificate not trusted")?(e=3060,c=a.IDS_VERIFY_CERT_ERROR_CHECKING_ISSUER_FAIL):(e=-1,c=g));f(c)})}catch(m){e=m.code,c=m.message,f(c)}}}function l(b){if(!b)return alert("UI load error."),!1;var a=document.createElement("div");document.body.insertBefore(a,document.body.firstChild);a.innerHTML=b;return!0}var h=function(){var d;d=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");d.open("GET",b.ESVS.SRCPath+"unisignweb/rsrc/layout/certverify.html?version="+b.ver,!1);d.send(null);return d.responseText},n=function(){var d;d=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");d.open("GET",b.ESVS.SRCPath+"unisignweb/rsrc/lang/certverify_"+b.ESVS.Language+".js?version="+b.ver,!1);d.send(null);return d.responseText},g=b.ESVS.TabIndex;return function(){var d=eval(h),a=eval(eval(n)()),f=k.args.idx;l(d());d=document.getElementById("us-cert-verify-lbl-title");d.appendChild(document.createTextNode(a.IDS_VERIFY_CERT));d.setAttribute("tabindex",g,0);4&b.ESVS.Mode||2&b.ESVS.Mode?m(f,a,function(a){var b=document.getElementById("us-cert-verify-lbl");a&&b&&(b.innerHTML=a,b.setAttribute("tabindex",g+1,0))}):(f=m(f,a),d=document.getElementById("us-cert-verify-lbl"),f&&d&&(d.innerHTML=f,d.setAttribute("tabindex",g+1,0)));f=document.getElementById("us-cert-verify-confirm-btn");f.setAttribute("value",a.IDS_CONFIRM,0);f.setAttribute("title",a.IDS_CONFIRM+a.IDS_BUTTON,0);f.setAttribute("tabindex",g+2,0);f.onclick=function(){k.onConfirm()};f=document.getElementById("us-cert-verify-cls-img-btn");f.setAttribute("title",a.IDS_VERIFY_CERT_CLOSE,0);f.setAttribute("tabindex",g+3,0);f.onclick=function(){k.onCancel()};document.getElementById("us-cert-verify-cls-btn-img").setAttribute("src",b.ESVS.SRCPath+"unisignweb/rsrc/img/x-btn.png",0);return document.getElementById("us-div-cert-verify")}()};return function(k){var m=b.uiLayerLevel,l=b.uiUtil().getOverlay(m),h=p({type:k.type,args:k.args,onConfirm:k.onConfirm,onCancel:k.onCancel});h.style.zIndex=m+1;b.ESVS.TargetObj.insertBefore(l,b.ESVS.TargetObj.firstChild);var n=window.onresize;return{show:function(){draggable(h,document.getElementById("us-div-cert-verify-title"));l.style.display="block";b.uiUtil().offsetResize(h);window.onresize=function(){b.uiUtil().offsetResize(h);n&&n()};b.uiLayerLevel+=10;b.ESVS.TabIndex+=30;setTimeout(function(){var b=h.getElementsByTagName("p");if(0<b.length)for(var d=0;d<b.length;d++)"us-cert-verify-lbl-title"==b[d].id&&b[d].focus()},10)},hide:function(){l.style.display="none";h.style.display="none"},dispose:function(){window.onresize=function(){n&&n()};h.parentNode.parentNode.removeChild(h.parentNode);l.parentNode.removeChild(l);b.uiLayerLevel-=10;b.ESVS.TabIndex-=30}}}};