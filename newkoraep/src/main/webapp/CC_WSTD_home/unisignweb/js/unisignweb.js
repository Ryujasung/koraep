var UnisignWebEngine=function(w,$){function ma(){if(4!=k.Mode)return null;eval(F({eval:!1,intergrity:!1,name:"nimservice",url:"unisignweb/js/nimservice.js"}));return eval("__nimservice")(a)}function F(a){var c=null,c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",k.SRCPath+a.url+"?version="+P,!1);c.send(null);if(200==c.status){if(!0===a.intergrity){var d={};d.name=a.name+".js";d.data=c.responseText;H[fa++]=d}return null==a.eval||!0==a.eval?eval(c.responseText):c.responseText}C=!1;return null}function na(){1&a.ESVS.Mode&&!a.STATUS.HadCheckedLicense&&a.plugin().valid&&(t&&J.log("Do retry to initialize module."),VerifyLicense()&&(__ForgeryUtil=new A.FORGERY,CheckIntergrity()&&(t&&J.log("Success to reinitialize module."),H=null)))}function oa(b){var c;if(!b||0>=b.length)return null;var d=b+".js";c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");a.uiUtil().isItPortableDevice()?"gridlist"!=b?(d="m_"+d,c.open("GET",k.SRCPath+"unisignweb/js/mobile/m_"+b+".js?version="+P,!1)):c.open("GET",k.SRCPath+"unisignweb/js/"+b+".js?version="+P,!1):c.open("GET",k.SRCPath+"unisignweb/js/"+b+".js?version="+P,!1);c.send(null);var e=c.responseText,f=null;"certprocessing.js"!=d&&(f=a.forgeryUtil().verify(d,e),"success"!=f&&null!=f&&(a.uiUtil().flagAlert(f),C=!1));eval(c.responseText);return eval("__"+b)(a)}function ga(b,c,d,e,f,g,h){if(b)ha(b,c,d,e,f,g,h);else{var l=a.loadUI("ssn")({type:null,onConfirm:function(a){ha(a,c,d,e,f,g,h);l.dispose()},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg();h(a.ERROR.Code,"","");l.dispose()}});l.show()}}function ha(b,c,d,e,f,g,h){a.uiUtil().createLoadingBox("show","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_VID_VERIFY_MESSAGE);"undefined"!==typeof c&&"undefined"!==typeof d&&(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!=g?a.nimservice()?a.nimservice().VerifyVID(c,d,b,function(b,c){a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");0==b?h(b,e,f,g):(a.ERROR.Code=b,a.ERROR.Message=c,h(b,"",f))}):(a.ERROR.Code=-1,a.ERROR.Message=this._errormsglang.IDS_ERROR_LOADING_NIMSERVIER,a.uiUtil().createLoadingBox("hide","us-div-loading-dialog"),h(-1,"")):(a.uiUtil().createLoadingBox("hide","us-div-loading-dialog"),a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList(),d=b=""))}if(w&&$){var z=w.Mode,x=w.EncAlgo,G=w.HashAlgo,U=w.PKI,u=w.SRCPath,Q=w.Language,K=w.TargetObj,S=w.TabIndex,V=w.Embedded,R=w.LimitNumOfTimesToTryToInputPW,aa=w.CMPIP,W=w.CMPPort,M=w.NimCheckURL,y=w.Media,ba=w.Organization,X=w.Policy,Y=w.ShowExpiredCerts,D=w.LimitMinNewPWLen,I=w.LimitMaxNewPWLen,L=w.LimitNewPWPattern,ca=w.ChangePWByNPKINewPattern,ia=w.License,t=!0,Z=function(a){!1!=t&&window.console&&window.console.log&&window.console.log(a)},C=null,P="1.0.15.0",da=null,k={};if(!z||"undefined"===typeof z||1>z||6<z)z=2;k.Mode=z;x&&"undefined"!==typeof x||(x="3des");k.EncAlgo=x;G&&"undefined"!==typeof G||(G="sha256");k.HashAlgo=G;U||(U="NPKI");k.PKI=U;u||(u="");k.SRCPath=u;Q=Q?"ko-kr"==Q.toLowerCase()?"ko_kr":"en_us":!navigator.browserLanguage||"ko"!=navigator.browserLanguage.toLowerCase()&&"kr"!=navigator.browserLanguage.toLowerCase()&&"ko-kr"!=navigator.browserLanguage.toLowerCase()?!document.documentElement.lang||"ko"!=document.documentElement.lang.toLowerCase()&&"kr"!=document.documentElement.lang.toLowerCase()&&"ko-kr"!=document.documentElement.lang.toLowerCase()?!navigator.language||"ko"!=navigator.language.toLowerCase()&&"kr"!=navigator.language.toLowerCase()&&"ko-kr"!=navigator.language.toLowerCase()?"en_us":"ko_kr":"ko_kr":"ko_kr";k.Language=Q;M||(M="../install/VestCert_Obj_check.html");k._NimCheckURL=M;if(!1==V){var ja=function(){!K&&document.body&&(K=document.createElement("div"),K.style.width="0px",K.style.height="0px",document.body.insertBefore(K,document.body.firstChild));K?k.TargetObj=K:setTimeout(ja,500)};setTimeout(ja,300)}k.TargetObj=K;if(0>S||!S)S=0;k.TabIndex=S;V||(V=!1);k.Embedded=V;if(0>=R||10<R||!R)R=3;k.LimitNumOfTimesToTryToInputPW=R;aa||(aa="211.192.169.70");k.CMPIP=aa;if(0>W||!W)W=4502;k.CMPPort=W;y?(y.list=y.list?y.list.toLowerCase():null,y.defaultdevice?(y.defaultdevice=y.defaultdevice.toLowerCase(),null!=y.list&&(y.defaultdevice=0>y.list.indexOf(y.defaultdevice)?y.list.split("|")[0]:y.defaultdevice)):y.defaultdevice=null):y={defaultdevice:null,list:"removable|sectoken|savetoken|mobilephone|harddisk|mobiletoken|webstorage|touchsign|smartsign|websectoken|websofttoken"};if(void 0==y.defaultdevice||null==y.defaultdevice)y.defaultdevice=2==z?"webstorage":"harddisk";k.Media=y;ba||(ba=null);k.Organization=ba;X||(X=null);k.Policy=X;"boolean"!==typeof Y&&(Y=!0);k.ShowExpiredCerts=Y;if("NPKI"===k.PKI){if(10>D||64<D||!D)D=10;k.LimitMinNewPWLen=D;if(10>I||64<I||!I||D>I)I=64;k.LimitMaxNewPWLen=I;L=2}else{if(8>D||64<D||!D)D=8;k.LimitMinNewPWLen=D;if(8>I||64<I||!I||D>I)I=64;k.LimitMaxNewPWLen=I;if(0>L||2<L||!L)L=0}k.LimitNewPWPattern=L;ca||(ca=!1);k.ChangePWByNPKINewPattern=ca;if(!(z&2||z&4)){if(!ia){alert("License is null. Please input license.");return}k.License=ia}var ka=null,H=[],fa=0,z={};z.name=$.NAME;z.data=$.DATA;H[fa++]=z;var N=[{eval:!0,intergrity:!0,name:"json2",url:"unisignweb/framework/json2.js"},{eval:!0,intergrity:!0,name:"Blob",url:"unisignweb/framework/Blob.js"},{eval:!1,intergrity:!0,name:"FileSaver",url:"unisignweb/framework/FileSaver.js"},{eval:!1,intergrity:!0,name:"UniSignW2AUtil",url:"unisignweb/framework/UniSignW2AUtil.js"},{eval:!1,intergrity:!0,name:"UniSignW2AExtension",url:"unisignweb/framework/UniSignW2AExtension.js"},{eval:!0,intergrity:!0,name:"draggable",url:"unisignweb/framework/draggable.js"},{eval:!0,intergrity:!0,name:"jsustoolkitErrCode",url:"jsustoolkit/jsustoolkitErrCode.js"},{eval:!0,intergrity:!0,name:"asn1",url:"jsustoolkit/toolkit/asn1.js"},{eval:!0,intergrity:!0,name:"jsbn",url:"jsustoolkit/toolkit/jsbn.js"},{eval:!0,intergrity:!0,name:"oids",url:"jsustoolkit/toolkit/oids.js"},{eval:!0,intergrity:!0,name:"util",url:"jsustoolkit/toolkit/util.js"},{eval:!0,intergrity:!0,name:"unicode",url:"jsustoolkit/toolkit/unicode.js"},{eval:!0,intergrity:!0,name:"aes",url:"jsustoolkit/crypto/aes.js"},{eval:!0,intergrity:!0,name:"des",url:"jsustoolkit/crypto/des.js"},{eval:!0,intergrity:!0,name:"desofb",url:"jsustoolkit/crypto/desofb.js"},{eval:!0,intergrity:!0,name:"seed",url:"jsustoolkit/crypto/seed.js"},{eval:!0,intergrity:!0,name:"rc2",url:"jsustoolkit/crypto/rc2.js"},{eval:!0,intergrity:!0,name:"hmac",url:"jsustoolkit/crypto/hmac.js"},{eval:!0,intergrity:!0,name:"md5",url:"jsustoolkit/crypto/md5.js"},{eval:!0,intergrity:!0,name:"sha1",url:"jsustoolkit/crypto/sha1.js"},{eval:!0,intergrity:!0,name:"sha256",url:"jsustoolkit/crypto/sha256.js"},{eval:!0,intergrity:!0,name:"rsa",url:"jsustoolkit/crypto/rsa.js"},{eval:!0,intergrity:!0,name:"prng",url:"jsustoolkit/crypto/prng.js"},{eval:!0,intergrity:!0,name:"random",url:"jsustoolkit/crypto/random.js"},{eval:!0,intergrity:!0,name:"pki",url:"jsustoolkit/toolkit/pki.js"},{eval:!0,intergrity:!0,name:"pkcs5",url:"jsustoolkit/toolkit/pkcs5.js"},{eval:!0,intergrity:!0,name:"pkcs8",url:"jsustoolkit/toolkit/pkcs8.js"},{eval:!0,intergrity:!0,name:"pkcs7",url:"jsustoolkit/toolkit/pkcs7.js"},{eval:!0,intergrity:!0,name:"pkcs7asn1",url:"jsustoolkit/toolkit/pkcs7asn1.js"},{eval:!0,intergrity:!0,name:"pkcs12",url:"jsustoolkit/toolkit/pkcs12.js"},{eval:!0,intergrity:!0,name:"x509Certificate",url:"jsustoolkit/toolkit/x509Certificate.js"},{eval:!0,intergrity:!0,name:"cmpasn1",url:"jsustoolkit/toolkit/cmpasn1.js"},{eval:!0,intergrity:!0,name:"cmp",url:"jsustoolkit/toolkit/cmp.js"},{eval:!0,intergrity:!0,name:"usWebCMP",url:"jsustoolkit/toolkit/usWebCMP.js"},{eval:!0,intergrity:!0,name:"usWebCMPXMLHttp",url:"jsustoolkit/toolkit/usWebCMPXMLHttp.js"}],la=[{eval:!1,intergrity:!0,name:"npkicacerts",url:"unisignweb/js/storage/ins/npkicacerts.js"},{eval:!1,intergrity:!0,name:"encryptstorage",url:"unisignweb/js/storage/enc/encryptstorage.js"},{eval:!1,intergrity:!0,name:"localstorage",url:"unisignweb/js/storage/ls/localstorage.js"},{eval:!1,intergrity:!0,name:"localstoragehandler",url:"unisignweb/js/storage/ls/localstoragehandler.js"},{eval:!1,intergrity:!0,name:"storagehandler",url:"unisignweb/js/storage/storagehandler.js"},{eval:!1,intergrity:!0,name:"storageerrcode",url:"unisignweb/js/storage/err/storageerrcode.js"}];new function(){for(var a=0;a<N.length;a++)0==a?"object"!==typeof JSON&&F(N[a]):1==a||2==a?document.createElementNS&&(2==a?(eval(F(N[a])),ka=eval("saveAs")):F(N[a])):3==a?(F(N[3]),F(N[4]),a=4):F(N[a]);if(2&k.Mode){for(var c=null,a=0;a<la.length;a++)c=eval(F(la[a]));try{da=new StorageHandler(1,{enc_algo:k.EncAlgo,hash_algo:k.HashAlgo,pki:k.PKI,domain:document.domain,error_code:c})}catch(d){a=window.console||{log:function(){}},a.log("*** StorageHandler initializing error ***"),a.log("e.code : ",d.code,"e.message : ",d.message,"e.detail : ",d.detail),da=null}}};var A={UI:function(){this._errormsglang=eval(eval(function(){return F({eval:!1,intergrity:!1,name:"errormsg_"+k.Language,url:"unisignweb/rsrc/lang/errormsg_"+k.Language+".js"})})())}};A.UI.prototype={getMediaName:function(b){var c="",d;for(d in a.CONST.medias)if(a.CONST.medias[d].device===b){c=a.CONST.medias[d].name;break}return c},getMediaDevice:function(b){var c=-1,d;for(d in a.CONST.medias)if(a.CONST.medias[d].name===b){c=a.CONST.medias[d].device;break}return c},isItPortableDevice:function(){return"android"===a.osName||"ios"===a.osName?!0:!1},isItLGAndroidBrowser:function(){return"android lg"===a.browserName?!0:!1},isItSamsungAndroidBrowser:function(){return"android samsung"===a.browserName?!0:!1},isItSupportingPFCertBackUp:function(){if(!(2&a.ESVS.Mode))return!1;if(this.isItPortableDevice())return"android samsung"===a.browserName||"android lg"===a.browserName||"android browser"===a.browserName||"android chrome"===a.browserName||"ios safari"===a.browserName||"ios chrome"===a.browserName?!0:!1;if("chrome"===a.browserName)return!0;if("msie"===a.browserName){if(10<=parseInt(a.browserVersion))return!0}else{if("firefox"===a.browserName)return parseInt(a.browserVersion),!0;if("safari"===a.browserName){if(6.1<=parseFloat(a.browserVersion))return!0}else if("opera"===a.browserName)return parseInt(a.browserVersion),!0}return!1},isItSupportingThisStorage:function(b){if(!b)return!1;var c=!1;if(1===(255&a.ESVS.Mode)||4&a.ESVS.Mode)switch(b.device){case a.CONST.__USFB_M_DISK.device:case a.CONST.__USFB_M_HSMKEY.device:case a.CONST.__USFB_M_SMARTCARD.device:case a.CONST.__USFB_M_MOBILE.device:case a.CONST.__USFB_M_HDD.device:case a.CONST.__USFB_M_MOBILETOKEN.device:c=this.isItPortableDevice()?!1:!0;break;default:c=!1}else if(2===(255&a.ESVS.Mode))switch(b.device){case a.CONST.__PF_M_LS.device:c=!0;break;case a.CONST.__PF_M_TOUCHSIGN.device:case a.CONST.__PF_M_SMARTSIGN.device:case a.CONST.__PF_M_WEBSECTOKEN.device:case a.CONST.__PF_M_WEBSOFTTOKEN.device:c=this.isItPortableDevice()?!1:!0;break;default:c=!1}else if(3===(255&a.ESVS.Mode)||6===(255&a.ESVS.Mode))switch(b.device){case a.CONST.__USFB_M_DISK.device:case a.CONST.__USFB_M_HSMKEY.device:case a.CONST.__USFB_M_SMARTCARD.device:case a.CONST.__USFB_M_MOBILE.device:case a.CONST.__USFB_M_HDD.device:case a.CONST.__USFB_M_MOBILETOKEN.device:c=this.isItPortableDevice()?!1:!0;break;case a.CONST.__PF_M_LS.device:c=!0;break;case a.CONST.__PF_M_TOUCHSIGN.device:case a.CONST.__PF_M_SMARTSIGN.device:case a.CONST.__PF_M_WEBSECTOKEN.device:case a.CONST.__PF_M_WEBSOFTTOKEN.device:c=this.isItPortableDevice()?!1:!0;break;default:c=!1}return c},getScrollTop:function(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop},getScrollLeft:function(){return self.pageXOffset?self.pageXOffset:document.documentElement&&document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft},getViewportHeight:function(){return window.undefined!=window.innerHeight?window.innerHeight:"CSS1Compat"==document.compatMode?document.documentElement.clientHeight:document.body?document.body.clientHeight:window.undefined},getViewportWidth:function(){return window.undefined!=window.innerWidth?window.innerWidth:"CSS1Compat"==document.compatMode?document.documentElement.clientWidth:document.body?document.body.clientWidth:window.undefined},getStyle:function(a,c,d){if(!a||!c||!d)return null;var e=null;return e=a.currentStyle?a.currentStyle[c]:window.getComputedStyle?window.getComputedStyle(a,"").getPropertyValue(d):null},getNumSize:function(a){if(!a)return-1;a=a.toLowerCase();var c="";if(-1<a.indexOf("px"))c=a.substring(0,a.indexOf("px"));else return-1;return parseInt(c)},getOverlay:function(a){if(0>a||!a)return null;var c=document.createElement("div");c.style.zIndex=a;c.style.backgroundImage="none";c.style.margin="0px";c.style.cursor="auto";c.style.display="none";c.onclick=null;c.style.position="fixed";c.style.width="100%";c.style.height="100%";c.style.top="0";c.style.left="0";c.style.filter="alpha(opacity=50)";c.style.backgroundColor="#000";c.style.opacity="0.5";return c},loadingBox:function(b,c,d){if(null==c||""==c)c="us-div-list-load";c=document.getElementById(c);if(null!=c){document.getElementById("us-cert-processing-img").setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/processing-img.gif",0);null==d&&(d=0);var e=document.getElementById("us-cert-processing-text");e.innerHTML="";e.appendChild(document.createTextNode(this._errormsglang.IDS_CERT_LOADING_MSG[d]));c.style.display=b?"":"none"}},createLoadingBox:function(b,c,d){if(null==c||""==c)c="us-div-loading-dialog";null==document.getElementById(c)?(a.ESVS.TargetObj.innerHTML='<div id="us-div-loading-dialog" class="us-layout-loading-o"></div><div class="us-layout-loading"><span class="us-layout-cert-processing-img"><img id="us-div-loading-dialog-img" class="us-layout-cert-processing-img"></span><span id="us-div-loading-dialog-text" class="us-layout-cert-processing-text"></span></div>',document.getElementById("us-div-loading-dialog-img").setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/processing-img.gif",0),b=document.getElementById("us-div-loading-dialog-text"),b.innerHTML="",b.appendChild(document.createTextNode(d))):"change"==b?(b=document.getElementById("us-div-loading-dialog-text"),b.innerHTML="",b.appendChild(d)):a.ESVS.TargetObj.innerHTML=""},offsetResize:function(a,c){if(a){var d=this.getViewportHeight()/2-a.offsetHeight/2,e=this.getViewportWidth()/2-a.offsetWidth/2;0>d&&(d=0);0>e&&(e=0);"center"==c?(a.style.top=d+"px",a.style.left=e+"px"):c&&"center"!=c?(a.style.top=c.split(",")[0]+"px",a.style.left=c.split(",")[1]+"px"):(a.style.top="30px",a.style.left=e+"px")}},msgBox:function(a){a&&alert(a)},flagAlert:function(a){a&&!1!=C&&alert(a)},errMsgBox:function(a,c){a&&alert(a+"\n\nError Code [ "+c+" ]")},getErrorMessageLang:function(){return this._errormsglang},getUserCancelErrCodeNMsg:function(){a.ERROR.Code=999;a.ERROR.Message=this._errormsglang.IDS_ERROR_USER_CANCEL},CheckPwdPattern:function(b){var c=!0;a.ESVS.LimitMinNewPWLen>b.length&&(c=!1);if("NPKI"===a.ESVS.PKI||2===a.ESVS.LimitNewPWPattern){var d=/^(?=.*[a-zA-Z])(?=.*[0-9])(?=.*[^a-zA-Z0-9])/g;d.exec(b)||(c=!1)}else 1===a.ESVS.LimitNewPWPattern&&(d=/^(?=.*[a-zA-Z])(?=.*[0-9])/g,d.exec(b)||(c=!1));if("NPKI"===a.ESVS.PKI&&(d=/['"\\|]/g,d.exec(b)&&(c=!1),2<b.length)){for(d=0;d<b.length-2;d++)if(b.charAt(d)===b.charAt(d+1)&&b.charAt(d)===b.charAt(d+2)){c=!1;break}for(d=0;d<b.length-2;d++)if(b.charCodeAt(d)===b.charCodeAt(d+1)-1&&b.charCodeAt(d)===b.charCodeAt(d+2)-2){c=!1;break}}return c}};A.CERT=function(){var a=eval(eval(function(){return F({intergrity:!1,name:"errormsg_"+k.Language,url:"unisignweb/rsrc/lang/certlist_"+k.Language+".js"})})());this._certOidNameTable={};this._certOidNameTable["1.2.410.200004.5.1.1.5"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.1.1.7"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.2.1.1"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.2.1.2"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.3.1.1"]=a.IDS_AGENCY_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.3.1.2"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.3.1.9"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.4.1.1"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.4.1.2"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.4.1.3"]=a.IDS_SERVER_CERTIFICATE;this._certOidNameTable["1.2.410.200005.1.1.1"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200005.1.1.5"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200012.1.1.1"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200012.1.1.3"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.2.1.7.1"]=a.IDS_PERSON_BANKING_N_INSURANCE;this._certOidNameTable["1.2.410.200004.5.2.1.7.2"]=a.IDS_PERSON_STOCKTRADING_N_INSURANCE;this._certOidNameTable["1.2.410.200004.5.2.1.7.3"]=a.IDS_PERSON_CREDITCARD;this._certOidNameTable["1.2.410.200004.5.1.1.9"]=a.IDS_PERSON_STOCKTRADING_N_INSURANCE;this._certOidNameTable["1.2.410.200004.5.1.1.9.2"]=a.IDS_PERSON_CREDITCARD;this._certOidNameTable["1.2.410.200005.1.1.4"]=a.IDS_PERSON_BANKING_N_INSURANCE;this._certOidNameTable["1.2.410.200005.1.1.6.2"]=a.IDS_PERSON_CREDITCARD;this._certOidNameTable["1.2.410.200004.5.4.1.101"]=a.IDS_PERSON_BANKING_N_INSURANCE;this._certOidNameTable["1.2.410.200004.5.4.1.102"]=a.IDS_PERSON_STOCKTRADING_N_INSURANCE;this._certOidNameTable["1.2.410.200004.5.4.1.103"]=a.IDS_PERSON_CREDITCARD;this._certOidNameTable["1.2.410.200004.5.4.1.104"]=a.IDS_PERSON_ELECTRONIC_CIVIL_APPEAL;this._certOidNameTable["1.2.410.200012.1.1.101"]=a.IDS_PERSON_BANKING_N_INSURANCE;this._certOidNameTable["1.2.410.200012.1.1.103"]=a.IDS_PERSON_STOCKTRADING_N_INSURANCE;this._certOidNameTable["1.2.410.200012.1.1.105"]=a.IDS_PERSON_CREDITCARD;this._certOidNameTable["1.1.1.1.1.1.1.1.1.1"]=a.IDS_VERISIGN;this._certOidNameTable.restriction=a.IDS_RESTRICTION;this._certCAOidTable={};this._certCAOidTable.crosscert="1.2.410.200004.5.4";this._certCAOidTable.yessign="1.2.410.200005.1.1";this._certCAOidTable.koscom="1.2.410.200004.5.1";this._certCAOidTable.ktnet="1.2.410.200012.1.1";this._certCAOidTable.kica="1.2.410.200004.5.2";this._certCAOidTable.verisign="1.1.1.1.1.1";this._certCANameTable={};this._certCANameTable.crosscert=a.IDS_CA_CROSSCERT;this._certCANameTable.yessign=a.IDS_CA_YESSIGN;this._certCANameTable.koscom=a.IDS_CA_KOSCOM;this._certCANameTable.ktnet=a.IDS_CA_KTNET;this._certCANameTable.kica=a.IDS_CA_KICA;this._certCANameTable.verisign=a.IDS_VERISIGN;this._certValidState={};this._certValidState.valid=a.IDS_CERT_STATE_VALID;this._certValidState.invalid=a.IDS_CERT_STATE_INVALID;this._certValidState.notice1=a.IDS_CERT_STATE_NOTICE_1;this._certValidState.notice2=a.IDS_CERT_STATE_NOTICE_2;this.certDNAttribute=[];this.certDNAttribute[0]="cn";this.certDNAttribute[1]="c";this.certDNAttribute[2]="l";this.certDNAttribute[3]="s";this.certDNAttribute[4]="st";this.certDNAttribute[5]="street";this.certDNAttribute[6]="o";this.certDNAttribute[7]="ou";this.certDNAttribute[8]="dnqualifier";this.certDNAttribute[9]="dc";this.certDNAttribute[10]="serialnumber";this.certDNAttribute[11]="e"};A.CERT.prototype={getCN:function(a){if(!a)return"undefined";var c=null,d=a.replace(/(^\s*)|(\s*$)/gi,"").split("="),e=d.length;a=[];var f=0;if(1<e){for(var g=0;g<e;g++)if(-1!=d[g].indexOf(","))for(var h=d[g].split(","),l=h.length,n=0;n<l;n++)a[f++]=h[n];else a[f++]=d[g];for(d=0;d<f;d++)if(this.certDNAttribute[0]==a[d].toLowerCase()){c=a[++d];break}if(f<=d+1)return null===c?"undefined":c;e=this.certDNAttribute.length;do{++d;for(n=1;n<e;n++)if(this.certDNAttribute[n]==a[d].toLowerCase())return c;c=c+", "+a[d]}while(d<f)}return"undefined"},getO:function(a){if(!a)return"undefined";var c=null,d=a.replace(/(^\s*)|(\s*$)/gi,"").split("="),e=d.length;a=[];var f=0;if(1<e){for(var g=0;g<e;g++)if(-1!=d[g].indexOf(","))for(var h=d[g].split(","),l=h.length,n=0;n<l;n++)a[f++]=h[n];else a[f++]=d[g];for(d=0;d<f;d++)if(this.certDNAttribute[6]==a[d].toLowerCase()){c=a[++d];break}if(f<=d+1)return null===c?"undefined":c;e=this.certDNAttribute.length;do{++d;for(n=0;n<e;n++)if(this.certDNAttribute[n]==a[d].toLowerCase())return c;c=c+", "+a[d]}while(d<f)}return"undefined"},getLocalDate:function(a){if(!a)return"undefined";var c=new Date(a);a=c.getFullYear();var d=c.getMonth()+1,c=c.getDate();10>d&&(d="0"+d);10>c&&(c="0"+c);return a+"-"+d+"-"+c},getLocalDateNTime:function(a){if(!a)return"undefined";var c=new Date(a);a=c.getFullYear();var d=c.getMonth()+1,e=c.getDate(),f=c.getHours(),g=c.getMinutes(),c=c.getSeconds();10>d&&(d="0"+d);10>e&&(e="0"+e);10>f&&(f="0"+f);10>g&&(g="0"+g);10>c&&(c="0"+c);return a+"-"+d+"-"+e+" "+f+":"+g+":"+c},getCertType:function(a){if(!a)return"undefined";a=this._certOidNameTable[a];return null==a||""==a?this._certOidNameTable.restriction:a},getIssuerName:function(a){if(!a)return"undefined";var c=null;return c=-1!=a.indexOf(this._certCAOidTable.crosscert)?this._certCANameTable.crosscert:-1!=a.indexOf(this._certCAOidTable.yessign)?this._certCANameTable.yessign:-1!=a.indexOf(this._certCAOidTable.koscom)?this._certCANameTable.koscom:-1!=a.indexOf(this._certCAOidTable.ktnet)?this._certCANameTable.ktnet:-1!=a.indexOf(this._certCAOidTable.kica)?this._certCANameTable.kica:-1!=a.indexOf(this._certCAOidTable.verisign)?this._certCANameTable.verisign:"undefined"},getIssuerEnName:function(a){if(!a)return"undefined";var c=null;return c=-1!=a.indexOf(this._certCAOidTable.crosscert)?"crosscert":-1!=a.indexOf(this._certCAOidTable.yessign)?"yessign":-1!=a.indexOf(this._certCAOidTable.koscom)?"koscom":-1!=a.indexOf(this._certCAOidTable.ktnet)?"ktnet":-1!=a.indexOf(this._certCAOidTable.kica)?"kica":-1!=a.indexOf(this._certCAOidTable.verisign)?"verisign":"undefined"},getExpirationState:function(a){if(!a)return"undefined";a=new Date(a);var c=(new Date).getTime();a=a.getTime()-c;return 0<a?2592E6<=a?this._certValidState.valid:this._certValidState.notice1+parseInt(a/1E3/60/60/24)+this._certValidState.notice2:this._certValidState.invalid},getExpirationStateValue:function(a){if(!a)return-1;a=new Date(a);var c=(new Date).getTime();a=a.getTime()-c;return 0<a?2592E6<=a?0:1:2},getTheCertAttributes:function(b,c){if(!b||!c)return{};a.usWebToolkit.x509Certificate.parser(b,c);var d=null;try{d=a.usWebToolkit.x509Certificate.getVersion()}catch(e){}var f=null;try{f=a.usWebToolkit.x509Certificate.getSerialNumber()}catch(g){}var h=null;try{h=a.usWebToolkit.x509Certificate.getSignAlgo()}catch(l){}var n=null;try{n=a.usWebToolkit.x509Certificate.getIssuerName()}catch(m){}var p=null;try{p=a.usWebToolkit.x509Certificate.getNotBefore()}catch(q){}var v=null;try{v=a.usWebToolkit.x509Certificate.getNotAfter()}catch(s){}var O=null;try{O=a.usWebToolkit.x509Certificate.getSubjectName()}catch(B){}var T=null;try{T=a.usWebToolkit.x509Certificate.getPublickey()}catch(k){}var r=null;try{r=a.usWebToolkit.x509Certificate.getAuthorityKeyIndentifier()}catch(u){}var t=null;try{t=a.usWebToolkit.x509Certificate.getSubjectKeyIdentifier()}catch(x){}var w=null;try{w=a.usWebToolkit.x509Certificate.getKeyUsage()}catch(z){}var y=null;try{y=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid()}catch(C){}var A=null;try{A=a.usWebToolkit.x509Certificate.getSubjectAltName()}catch(E){}var F=null;try{F=a.usWebToolkit.x509Certificate.getAuthorityInfoAccess()}catch(H){}var D=null;try{D=a.usWebToolkit.x509Certificate.getcRLDistributionPoints()}catch(I){}var G=null;try{G=a.usWebToolkit.x509Certificate.getCertificatePoliciesCPS()}catch(J){}var K=null;try{K=a.usWebToolkit.x509Certificate.getCertificatePoliciesUserNotice()}catch(M){}var L=null;try{L=a.usWebToolkit.x509Certificate.getSignature()}catch(N){}return{version:d,serialNumber:f,signAlgo:h,issuerName:n,validateFrom:p,validateTo:v,subjectName:O,publicKey:T,authorityKeyIndentifier:r,subjectKeyIndentifier:t,keyUsage:w,policiesOid:y,subjectAltName:A,authorityInfoAccess:F,crlDistributionPoints:D,policiesCps:G,policiesUserNotice:K,signature:L}}};A.FORGERY=function(){this._lang=eval(eval(function(){return F({eval:!1,intergrity:!1,name:"forgery_"+k.Language,url:"unisignweb/rsrc/lang/forgery_"+k.Language+".js"})})());this._md=a.usWebToolkit.md.algorithms.sha256.create();this._integrityList=[];var b=F({eval:!1,intergrity:!1,name:"unisign",url:"unisignweb/integrity/unisign.js"}),c=null;if(!(1&a.ESVS.Mode)){var d=window.console||{log:function(){}};null!=b||11<b.length?a.logger(" >>>> SignData : ["+b.length+"] "+b.substring(0,10)+"..."+b.substring(b.length-10,b.length)):a.logger(" >>>> SignData ERROR : "+b);var e=null,f,g;try{f=b,e=a.usWebToolkit.pkcs7.messageFromBase64(b),g=b,e.verify()}catch(h){a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : "+h.code);C=!1;a.logger(C+" >> signdata :: ("+(f==g)+") "+this._lang.IDS_MSGBOX_ERROR_VERIFY_SIGNED_DATA_OF_MD_TABLE+"\nerror code : "+h.code+"\nerror msg : "+h.message+"\na:"+f+"\nb:"+g);t&&d.log("error code : ",h.code,"\nerror msg : ",h.message);return}Z("verify result : "+e.verifyResult);if(!0==e.verifyResult)a.intergrity.data=e.content;else if(-1<navigator.userAgent.indexOf("compatible"))a.nimservice()?a.nimservice().VerifySignedData(null,b,function(b,c){0!=b?(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : 1368"),C=!1):a.intergrity.data=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(c))}):(a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : 1509"),C=!1);else{a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : 1513");C=!1;a.logger(">> verifyResult :: "+this._lang.IDS_MSGBOX_ERROR_VERIFY_SIGNED_DATA_OF_MD_TABLE);return}try{c=a.usWebToolkit.pki.certificateToBase64(e.certificates[0])}catch(l){a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : "+l.code);C=!1;a.logger(">> certificate error :: "+this._lang.IDS_MSGBOX_ERROR_GET_THE_CERT_FROM_SIGNED_DATA);t&&d.log("error code : ",l.code,"\nerror msg : ",l.message);return}}a.usWebToolkit.x509Certificate.parser(c,"Base64");ea();b=a.usWebToolkit.x509Certificate.getSubjectName();if(!b||0>=b.length||"cn=crosscertwebv3,ou=stlab,o=crosscert,c=kr"!==b.toLowerCase())a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : 1401"),C=!1,a.logger(">> get dn : "+this._lang.IDS_MSGBOX_ERROR_VERIFY_THE_CERT);else if(b=a.usWebToolkit.x509Certificate.getSubjectKeyIdentifier(),!b||0>=b.length||"9ecd6e86418013304666aff0c486a6c31a6fe363"!==b)a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : 1411"),C=!1,a.logger(">> get ski : "+this._lang.IDS_MSGBOX_ERROR_VERIFY_THE_CERT)};A.FORGERY.prototype={verify:function(b,c){ea();var d=a.intergrity.getList();if(!d||0>=d.length)return null;if(!b||!c)return this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE;var e=null;this._md.start();this._md.update(c);for(var e=this._md.digest().toHex(),f=0;f<d.length;f++)if(d[f].name==b){if(d[f].data==e)return"success";var g=window.console||{log:function(){}};a.logger("*** Suspicion Forgery ***\nintergrity file name : "+d[f].name+"\nintergrity file md data : "+d[f].data+"\ndownloaded file name : "+b+"\ndownloaded file md data : "+e+"\n"+this._lang.IDS_MSGBOX_WARNING_SUSPICION_FORGERY);t&&(g.log("*** Suspicion Forgery ***"),g.log("intergrity file name : ",d[f].name,"\nintergrity file md data : ",d[f].data),g.log("downloaded file name : ",b,"\ndownloaded file md data : ",e));break}return this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE}};CheckIntergrity=function(){ea();var b=null,c=null;Z("==================================== CheckIntergrity START");for(var d=0;d<H.length;d++)if(b=H[d].name,c=H[d].data,rstr=a.forgeryUtil().verify(b,c),"success"===rstr)H[d].name=null,H[d].data=null,H[d]=null;else if(rstr){H[d].name=null;H[d].data=null;H[d]=null;a.uiUtil().flagAlert(rstr);C=!1;break}else return!1;return!0};A.FILE=function(){};A.FILE.prototype={save:function(a,c){if(a&&!(0>=a.length)&&c){var d=new Blob([c],{type:"application/octet-stream"});ka(d,a)}}};var r=z=null,E=0,x=null,G=navigator.platform,u=navigator.userAgent,z=0<=G.indexOf("Win")?"win":0<=G.indexOf("Mac")?"mac":0<=G.indexOf("Linux")?"linux":0<=G.indexOf("iPhone")||0<=G.indexOf("iPad")||0<=G.indexOf("iPod")?"ios":"unknown";0<=u.indexOf("Android")&&(z="android");"android"===z?0<=u.indexOf("SAMSUNG")?(r="android samsung",x=/Version\/([0-9]{1,}[.0-9]{0,})/):0<=u.indexOf("OPR")?(r="android opera",x=/OPR\/([0-9]{1,}[.0-9]{0,})/):0<=u.indexOf("Opera")?(r="android opera classic",x=/Version\/([0-9]{1,}[.0-9]{0,})/):0<=u.indexOf("Firefox")?(r="android firefox",x=/Firefox\/([0-9]{1,}[.0-9]{0,})/):0<=u.indexOf("NAVER")?r="android naver":0<=u.indexOf("DaumApps")?(r="android daum",x=/DaumApps\/([0-9]{1,}[.0-9]{0,})/):0<=u.indexOf("nate_app")?r="android nate":0<=u.indexOf("UCBrowser")?(r="android uc",x=/UCBrowser\/([0-9]{1,}[.0-9]{0,})/):0<=u.indexOf("Chrome")?0<=u.indexOf("Version")?(r=0<=u.indexOf("LG")?"android lg":"android browser",x=/Version\/([0-9]{1,}[.0-9]{0,})/):0<=u.indexOf("LG")?((x=/Chrome\/([0-9]{1,}[.0-9]{0,})/)&&x.exec(u)&&(E=parseFloat(RegExp.$1)),r=39>E?"android lg":"android chrome"):(r="android chrome",x=/Chrome\/([0-9]{1,}[.0-9]{0,})/):(r="unknown",E=0):"ios"===z?0<=u.indexOf("CriOS")?(r="ios chrome",x=/CriOS\/([0-9]{1,}[.0-9]{0,})/):0<=u.indexOf("NAVER")?r="ios naver":0<=u.indexOf("DaumApps")?(r="ios daum",x=/DaumApps\/([0-9]{1,}[.0-9]{0,})/):0<=u.indexOf("Coast")?(r="ios opera coast",x=/Coast\/([0-9]{1,}[.0-9]{0,})/):0<=u.indexOf("Safari")?(r="ios safari",x=/Version\/([0-9]{1,}[.0-9]{0,})/):(r="unknown",E=0):0<=u.indexOf("MSIE")?(r="msie","BackCompat"==document.compatMode?E=5:document.documentMode?E=document.documentMode:x=/MSIE ([0-9]{1,}[.0-9]{0,})/):0<=u.indexOf("Chrome")?(r="chrome",x=/Chrome\/([0-9]{1,}[.0-9]{0,})/):0<=u.indexOf("Firefox")?(r="firefox",x=/Firefox\/([0-9]{1,}[.0-9]{0,})/):0<=u.indexOf("Safari")?(r="safari",x=/Version\/([0-9]{1,}[.0-9]{0,})/):0<=u.indexOf("Opera")?(r="opera",x=/Version\/([0-9]{1,}[.0-9]{0,})/):0<=u.indexOf("rv:11.")?(r="msie",x=/rv:([0-9]{1,}[.0-9]{0,})/):(r="unknown",E=0);x&&x.exec(u)&&(E=parseFloat(RegExp.$1));var ea=function(){return"msie"==r?10>E:"chrome"==r?10>E:"firefox"==r?10>E:"safari"==r?6.1>E:"opera"==r?15>E:!0},J=window.console||{log:function(){}};t&&(J.log("UI ver : ",P,"\nplatform : ",G,"\nuseragent : ",u),J.log("OS name : ",z,"\nbrowser name : ",r,"\nbrowser version : ",E));var a={ver:P,nimVersion:"2.0.4.0",osName:z,browserName:r,browserVersion:E,usWebToolkit:window.crosscert,isAvailable:function(){return t?!0:null==C?!1:C},intergrity:{data:null,list:null,getList:function(){null==this.list&&(this.list=this.parser(this.data));return this.list},parser:function(a){"string"!==typeof a&&(a=new String(a));var c=[];a=a.split(/\r\n|\r|\n/g);for(var d=0;d<a.length;d++){var e=a[d].split("|"),f={};f.name=e[0];f.data=e[1];c[d]=f}return c}},logger:function(a){},trace:Z,nimCheckUrl:M,plugin:function(){return document.getElementById("unisignwebplugin")},nimservice:function(){return pa},options:{img_src:null},ubiKeyEnv:{version:"1,3,0,7",siteInfo:"CROSSCERT|https://ansimclick.hyundaicard.com/ubikey/download.html",securityInfo:"CROSSCERT|NULL",downloadURL:"https://ansimclick.hyundaicard.com/ubikey/download.html"},usimEnv:{sitecode:"303010001",modecode:"0003",siteURL:"www.crosscert.com",serviceIP:"servic.smartcert.kr",servicePort:"443"},uiUtil:function(){return __UIUtil},certUtil:function(){return __CertUtil},forgeryUtil:function(){return __ForgeryUtil},fileUtil:function(){return __FileUtil},uiLayerLevel:1E4,certsList:null,reInitialize:na,loadUI:oa,ESVS:k,STATUS:{HadCheckedLicense:!1},PFSH:da,PFUC:null,ERROR:{Code:0,Message:null},CONST:{__USFB_M_DISK:{device:1,name:"removable"},__USFB_M_HSMKEY:{device:2,name:"sectoken"},__USFB_M_SMARTCARD:{device:3,name:"savetoken"},__USFB_M_MOBILE:{device:4,name:"mobilephone"},__USFB_M_HDD:{device:5,name:"harddisk"},__USFB_M_MOBILETOKEN:{device:6,name:"mobiletoken"},__USFB_M_ETC:{device:9,name:"USFB_M_ETC"},__PF_M_LS:{device:11,name:"webstorage"},__PF_M_TOUCHSIGN:{device:12,name:"touchsign"},__PF_M_SMARTSIGN:{device:13,name:"smartsign"},__PF_M_WEBSECTOKEN:{device:14,name:"websectoken"},__PF_M_WEBSOFTTOKEN:{device:15,name:"websofttoken"},__PF_M_ETC:{device:19,name:"PF_M_ETC"},medias:{}}},pa=ma(a);a.CONST.medias={removable:a.CONST.__USFB_M_DISK,sectoken:a.CONST.__USFB_M_HSMKEY,savetoken:a.CONST.__USFB_M_SMARTCARD,mobilephone:a.CONST.__USFB_M_MOBILE,harddisk:a.CONST.__USFB_M_HDD,mobiletoken:a.CONST.__USFB_M_MOBILETOKEN,webstorage:a.CONST.__PF_M_LS,touchsign:a.CONST.__PF_M_TOUCHSIGN,smartsign:a.CONST.__PF_M_SMARTSIGN,websectoken:a.CONST.__PF_M_WEBSECTOKEN,websofttoken:a.CONST.__PF_M_WEBSOFTTOKEN};VerifyLicense=function(){var b=location.href;t&&J.log("current url : ",b);b=a.plugin().InitUniSignWebPluginAPI(b,a.ESVS.License);t&&J.log("license verification result : ",b);a.STATUS.HadCheckedLicense=!0;if(0!=b){var c=null;switch(b){case 4013E4:c="Error to parse the license string.";break;case 4014E4:c="Error to parse the domain string.";break;case 4015E4:c="Wrong license type.";break;case 4016E4:c="The license is expired.";break;case 4017E4:c="Error to verify the license.";break;default:c="Error to check the license."}a.ERROR.Code=a.plugin().GetLastErrorCode();a.ERROR.Message=a.plugin().GetLastErrorMessage();t&&J.log("Error code : ",a.ERROR.Code,"\nError msg : ",a.ERROR.Message);a.uiUtil().flagAlert(c+"\n\nError Code [ "+b+" ]");return!1}return!0};if(null!=a.plugin()&&a.plugin().valid){if(!VerifyLicense()){t&&J.log("It stop to load unisignweb module.");return}}else t&&J.log("It couldnt check license of module.");__UIUtil=new A.UI;__CertUtil=new A.CERT;__ForgeryUtil=new A.FORGERY;__FileUtil=new A.FILE;M=function(){CheckIntergrity()?(H=null,!1==t&&null==C&&(C=!0)):Z("## It couldnt check intergrity of files.")};null!=a.intergrity.data?M():setTimeout(M,1E3);t&&J.log("Is this Browser supporting plugin free cert backup? ",a.uiUtil().isItSupportingPFCertBackUp());return{Available:function(){return a.isAvailable()},IsValidity:function(){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else return a.plugin().valid},GetLastError:function(b){!1==a.isAvailable()?a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE):(b(a.ERROR.Code,a.ERROR.Message),a.ERROR.Code=0,a.ERROR.Message=null)},SetEmbeddedUI:function(b){!1==a.isAvailable()?a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE):a.ESVS.Embedded=b?!0:!1},SignDataP1:function(b,c,d){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b||!d||document.getElementById("us-div-cert-select"))return!1;a.reInitialize();var e=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P1",args:{dn:c},onConfirm:function(c,g,h,l,n,m){var p=null;if("undefined"!==typeof l&&"undefined"!==typeof n){if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!=m)a.nimservice()?(h=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)),a.nimservice().GetSignDataP1(l,n,h,null,function(b,h,l){0!=b?(a.ERROR.Code=b,a.ERROR.Message=h,a.uiUtil().errMsgBox(h,a.ERROR.Code),d("")):d(l,c,g);a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){e.dispose()},10)})):(d("","",""),setTimeout(function(){e.dispose()},10));else{try{var q=window.console||{log:function(){}};t&&(q.log("b64 cert : ",a.PFUC[l].signcert),q.log("b64 pri : ",a.PFUC[l].signpri));var v=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[l].signcert),s=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[l].signpri),s=crosscert.pki.privateKeyFromAsn1(crosscert.asn1.fromDer(s));l=null;switch(oids[v.signatureOid]){case "sha1WithRSAEncryption":l=crosscert.md.algorithms[sha1].create();break;case "kcdsaWithSHA1":v.md=crosscert.md.algorithms[sha1].create();break;case "md5WithRSAEncryption":l=crosscert.md.algorithms[md5].create();break;case "sha256WithRSAEncryption":l=crosscert.md.algorithms[sha256].create();break;case "RSASSA-PSS":l=crosscert.md.algorithms[sha256].create()}l.update(b);var O=s.sign(l),p=a.usWebToolkit.pkcs7.messageToBase64(O);d(p,c,g)}catch(B){a.ERROR.Code=B.code,a.ERROR.Message=B.message,a.uiUtil().errMsgBox(h,a.ERROR.Code),d("")}setTimeout(function(){e.dispose()},10)}l=n=v=pri=null}else a.plugin().valid?((signatureValue=a.plugin().GenSignatureValue(b))?d(signatureValue,c,g):(a.ERROR.Code=a.plugin().GetLastErrorCode(),a.ERROR.Message=a.plugin().GetLastErrorMessage(),a.uiUtil().errMsgBox(h,a.ERROR.Code)),a.plugin().ClearAllUserCertList()):d("","",""),setTimeout(function(){e.dispose()},10)},onCancel:function(){a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();a.uiUtil().getUserCancelErrCodeNMsg();d("","","");e.dispose()}});e.show();return!0}},VerifySignedDataP1:function(b,c,d,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(b&&c&&d||e(-1),a.reInitialize(),1&a.ESVS.Mode){if(a.plugin().valid)return b=a.plugin().VerifySignatureValueWithCert(b,c,d),0!=b&&(a.ERROR.Code=a.plugin().GetLastErrorCode(),a.ERROR.Message=a.plugin().GetLastErrorMessage()),b}else if(4&a.ESVS.Mode)a.nimservice()&&(b=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)),b=a.nimservice().VerifySignature(b,c,d,function(b,c){0!=b&&(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage());e(b);a.uiUtil().loadingBox(!1,"us-div-list-load")}));else{c=a.usWebToolkit.util.decode64(c);d=a.usWebToolkit.pki.certificateFromBase64(d);var f="1.2.840.113549.1.1.5"==d.signatureOid||"1.2.410.200004.1.9"==d.signatureOid?a.usWebToolkit.md.sha1.create():"1.2.840.113549.1.1.4"==d.signatureOid?a.usWebToolkit.md.md5.create():"1.2.840.113549.1.1.11"==d.signatureOid||"1.2.840.113549.1.1.10"==d.signatureOid?a.usWebToolkit.md.sha256.create():null;f.update(b);var g;try{g=d.publicKey.verify(f.digest().getBytes(),c)}catch(h){g=!1}return g?0:-1}},SignDataP7:function(b,c,d,e,f){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b||!f||document.getElementById("us-div-cert-select"))return!1;a.reInitialize();var g=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:c},onConfirm:function(c,l,n,m,p){var q=null;if("undefined"!==typeof n&&"undefined"!==typeof m){if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!=p)a.nimservice()?(c=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)),a.nimservice().GetSignDataP7(n,m,0,c,d,e,function(c,b,d,e){0!=c?(a.ERROR.Code=c,a.ERROR.Message=b,f("")):f(d,p,l,e);a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){g.dispose()},10)})):(f(""),setTimeout(function(){g.dispose()},10));else{try{var v=window.console||{log:function(){}};t&&(v.log("b64 cert : ",a.PFUC[n].signcert),v.log("b64 pri : ",a.PFUC[n].signpri));var s=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[n].signcert),O=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[n].signpri),B=a.usWebToolkit.pkcs7.createSignedData();B.sign(b,s,O,m,null,null);q=a.usWebToolkit.pkcs7.messageToBase64(B);f(q,p)}catch(T){a.ERROR.Code=T.code,a.ERROR.Message=T.message,a.uiUtil().errMsgBox(c,a.ERROR.Code),f("")}setTimeout(function(){g.dispose()},10)}n=m=s=O=null}else a.plugin().valid?((q=a.plugin().MakeSignedData(b))?f(q,p):(a.ERROR.Code=a.plugin().GetLastErrorCode(),a.ERROR.Message=a.plugin().GetLastErrorMessage(),a.uiUtil().errMsgBox(c,a.ERROR.Code),f("")),a.ESVS.Embedded||a.plugin().ClearAllUserCertList()):f(""),setTimeout(function(){g.dispose()},10)},onCancel:function(){1&a.ESVS.Mode&&a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();a.uiUtil().getUserCancelErrCodeNMsg();f("");g.dispose()}});g.show();return!0}},VerifySignedDataP7:function(b,c){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b)return null;var d=null;a.reInitialize();if(1&a.ESVS.Mode){if(a.plugin().valid)return d=a.plugin().VerifySignedData(b),d||(a.ERROR.Code=a.plugin().GetLastErrorCode(),a.ERROR.Message=a.plugin().GetLastErrorMessage()),d}else if(4&a.ESVS.Mode)a.nimservice()&&a.nimservice().VerifySignedData(null,b,function(b,d){0!=b?(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),c(null)):c(a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(d)));a.uiUtil().loadingBox(!1,"us-div-list-load")});else{d=null;try{d=a.usWebToolkit.pkcs7.messageFromBase64(b),d.verify()}catch(e){return a.ERROR.Code=e.code,a.ERROR.Message=e.message,null}if(d.verifyResult)return d=d.content}}},SignDataP7Ext:function(b,c,d,e,f,g){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!c&&!d||document.getElementById("us-div-cert-select")||!f)return!1;b||(b="DIGITAL_SIGNATURE_P7_EXT");a.reInitialize();var h=a.loadUI("certselect")({type:b,args:{dn:e},onConfirm:function(b,e){var g=null;a.plugin().valid?(g=c?a.plugin().MakeSignedData(c):a.plugin().MakeSignedDataBase64Input(d))?(h.dispose(),h=null,f(g,e)):(a.ERROR.Code=a.plugin().GetLastErrorCode(),a.ERROR.Message=a.plugin().GetLastErrorMessage(),g=window.console||{log:function(){}},t&&g.log("sign err code : ",a.ERROR.Code,"\nsign err msg : ",a.ERROR.Message),a.uiUtil().errMsgBox(b,a.ERROR.Code)):f("",0);null!=h&&h.dispose()},onCancel:function(){a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();h.dispose();a.uiUtil().getUserCancelErrCodeNMsg();g&&g()}});h.show();return!0}},SelectMedia:function(b,c,d){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!c)return!1;var e=b;e||(e="CERT_STORAGE");a.reInitialize();Dialog=a.loadUI("storageselect")({type:e,args:null,onConfirm:function(b,g){Dialog.dispose();2===b||3===b?(e=2===b?"PIN_SECURITY_TOKEN":"PIN_SAVE_TOKEN",PINDialog=a.loadUI("pin")({type:e,args:null,onConfirm:function(a){PINDialog.dispose();c(b,g,a)},onCancel:function(){PINDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();d&&d()}}),PINDialog.show()):c(b,g,null)},onCancel:function(){Dialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();d&&d()}});Dialog.show()}},SelectMediaForCertImporting:function(b,c){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b)return!1;a.reInitialize();Dialog=a.loadUI("storageselect")({type:"CERT_STORAGE",args:null,onConfirm:function(d,e){Dialog.dispose();2===d||3===d?(PWDialog=a.loadUI("password")({type:null,args:null,onConfirm:function(f){PWDialog.dispose();var g=null,g=2===d?"PIN_SECURITY_TOKEN":"PIN_SAVE_TOKEN";PINDialog=a.loadUI("pin")({type:g,args:null,onConfirm:function(a){PINDialog.dispose();b(d,e,a,f);f=null},onCancel:function(){PINDialog.dispose();f=null;a.uiUtil().getUserCancelErrCodeNMsg();c&&c()}});PINDialog.show()},onCancel:function(){PWDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();c&&c()}}),PWDialog.show()):b(d,e,null,null)},onCancel:function(){Dialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();c&&c()}});Dialog.show()}},ExportCert:function(b,c){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b||!c)return null;a.reInitialize();if(a.plugin().valid){var d=a.plugin().ExportPfxCertString_UniCRS(b,c);d||(a.ERROR.Code=a.plugin().GetLastErrorCode(),a.ERROR.Message=a.plugin().GetLastErrorMessage());return d}return null}},ImportCert:function(b,c,d,e,f,g){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b||!c||1>d||0>e)return-1;a.reInitialize();if(a.plugin().valid){var h=0,h=1===d||5===d?a.plugin().ImportPfxCertString_UniCRS(b,c,d,e):a.plugin().ImportPfxCertString_UniCRS_HSM(b,c,g,d,e,f);0!=h&&(a.ERROR.Code=a.plugin().GetLastErrorCode(),a.ERROR.Message=a.plugin().GetLastErrorMessage());return h}return-1}},IssueCert:function(b,c,d){function e(b,c,d){if(4<=a.ESVS.Mode)return a.nimservice()?(IssuingDialog=a.loadUI("certprocessing")({type:"CERT_ISSUE",args:null,onConfirm:null,onCancel:null}),IssuingDialog.show(),a.nimservice().IssueCertificate(a.ESVS.CMPIP,a.ESVS.CMPPort,b,c,"",g,h,function(b,c){if(0!=b)return a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),IssuingDialog.dispose(b,a.ERROR.Code,a.ERROR.Message,function(){l(b)}),!1;IssuingDialog.dispose(b,0,null,function(){l(b)});return!0})):l(-1),!1;var f=null,f=2===b?a.loadUI("pin"):a.loadUI("newpassword");PWDialog=f({type:null,args:null,onConfirm:function(f){PWDialog.dispose();if(1&a.ESVS.Mode&&11!=b){if(a.plugin().valid){a.plugin().SetCAInfo(a.ESVS.CMPIP,a.ESVS.CMPPort);var e=a.loadUI("certprocessing");IssuingDialog=e({type:"CERT_ISSUE",args:null,onConfirm:null,onCancel:null});IssuingDialog.show();setTimeout(function(){var e=null,e=3===b?a.plugin().IssueCertificate_SCard(g,h,f,d):a.plugin().IssueCertificate(g,h,f,b,c);f=d=null;if(0!=e)return a.ERROR.Code=a.plugin().GetLastErrorCode(),a.ERROR.Message=a.plugin().GetLastErrorMessage(),IssuingDialog.dispose(e,a.ERROR.Code,a.ERROR.Message,function(){l(e)}),!1;IssuingDialog.dispose(e,0,null,function(){l(e)});return!0},1E3)}else l(-1);f=d=null}else if(2&a.ESVS.Mode&&11===b){e=a.loadUI("certprocessing");IssuingDialog=e({type:"CERT_ISSUE",args:null,onConfirm:null,onCancel:null});IssuingDialog.show();e=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");e.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/certbackup_"+a.ESVS.Language+".js?version="+a.ver,!1);e.send(null);var n=eval(e.responseText);setTimeout(function(){if(!a.PFSH)return l(-1),!1;try{a.PFSH.LoadAllCerts(document.domain)}catch(b){if(301E5===b.code)a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain);else{var c=window.console||{log:function(){}};t&&(c.log("***** Plugin Free LoadAllCerts error *****"),c.log("e.code : ",b.code,"e.message : ",b.message,"e.detail : ",b.detail))}}try{a.usWebToolkit.usWebCMP.issueCert(g,h,f,document.domain,"",a.PFSH,function(b,c,d){if(1===b){var e=function(){var b=null,c=null,d=null;try{b=a.PFSH.GetP12ForBuToMo(1,"hex"),c=b.key,d=b.p12}catch(f){c=window.console||{log:function(){}};t&&(c.log("***** GetP12ForBuToMo error *****"),c.log("e.code : ",f.code,"e.message : ",f.message,"e.detail : ",f.detail));alert("failure\nerr code : "+f.code+"\nerr msg : "+f.message);return}try{b="default";"android"===a.osName?"android samsung"===a.browserName||"android lg"===a.browserName||"android browser"===a.browserName?b="default":"android chrome"===a.browserName&&(b="chrome"):"ios"==a.osName&&("ios safari"===a.browserName?b="default":"ios chrome"===a.browserName&&(b="googlechrome"));var e=window.location.href.split(/[?#]/)[0],g=e.lastIndexOf("/"),e=e.substr(0,g+1)+a.ESVS.SRCPath+"unisignweb/rsrc/layout/mobile/w2a/m_exportcertresult.html";UniSignW2A.backupStore(e,b,d,c,"0","recall")}catch(h){alert("failure\ne : "+h)}};IssuingDialog.dispose(0,0,null,function(){var b=a.loadUI("confirm")({type:null,args:{msg:n.IDS_CONFIRMBOX_WILL_YOU_BACKUP_CERT},onConfirm:function(){b.dispose();if(a.uiUtil().isItPortableDevice())e();else try{var c=a.PFSH.GetP12ForBuToPc(1,f),d=c.p12,g=a.certUtil().getCN(c.dn),g=g+".p12";a.fileUtil().save(g,d)}catch(h){alert("failure\nerr code : "+h.code+"\nerr msg : "+h.message)}f=null;l(0)},onCancel:function(){b.dispose();f=null;a.uiUtil().getUserCancelErrCodeNMsg();l(a.ERROR.Code)}});b.show()})}else 2===b?(a.ERROR.Code=-1,a.ERROR.Message=c,IssuingDialog.dispose(-1,a.ERROR.Code,a.ERROR.Message,function(){l(a.ERROR.Code)})):(a.ERROR.Code=d.code,a.ERROR.Message=d.message,IssuingDialog.dispose(-2,a.ERROR.Code,a.ERROR.Message,function(){l(a.ERROR.Code)})),f=null})}catch(d){a.ERROR.Code=d.code,a.ERROR.Message=d.message,IssuingDialog.dispose(-2,a.ERROR.Code,a.ERROR.Message,function(){l(a.ERROR.Code)}),f=null}},1E3)}},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg();l(a.ERROR.Code);PWDialog.dispose()}});PWDialog.show()}function f(){n=a.loadUI("storageselect")({type:"CERT_STORAGE",args:null,onConfirm:function(b,c){n.dispose();4&a.ESVS.Mode?e(b,c,""):3===b?(PINDialog=a.loadUI("pin")({type:"PIN_SAVE_TOKEN",args:null,onConfirm:function(a){PINDialog.dispose();e(b,c,a)},onCancel:function(){PINDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();l(a.ERROR.Code)}}),PINDialog.show()):e(b,c,"")},onCancel:function(){n.dispose();a.uiUtil().getUserCancelErrCodeNMsg();l(a.ERROR.Code)}});n.show()}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!d)return!1;var g=b,h=c,l=d;a.reInitialize();if(g&&h)f();else{var n=a.loadUI("certissue")({type:null,args:null,onConfirm:function(a,b){g=a;h=b;n.dispose();f()},onCancel:function(){n.dispose();a.uiUtil().getUserCancelErrCodeNMsg();l(a.ERROR.Code)}});n.show()}return!0}},RenewCert:function(b){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(b&&!document.getElementById("us-div-cert-select")){a.reInitialize();var c=a.loadUI("certselect")({type:"CERT_RENEWAL",args:{dn:null},onConfirm:function(d,e,f,g,h){c.dispose();var l=!0;f!=a.CONST.__USFB_M_MOBILETOKEN.device&&(l=confirm(e));if(l){if(4<=a.ESVS.Mode)return a.nimservice()?(d=a.loadUI("certprocessing"),RenewingDialog=d({type:"CERT_RENEWAL",args:null,onConfirm:null,onCancel:null}),RenewingDialog.show(),a.nimservice().RenewCertificate(a.ESVS.CMPIP,a.ESVS.CMPPort,f,g,h,"","",function(c,d){0==c?RenewingDialog.dispose(0,0,null,function(){b(0)}):(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),RenewingDialog.dispose(c,a.ERROR.Code,a.ERROR.Message,function(){b(c)}))})):b(-1,"",""),!1;f=new Date(d);f.setHours(0);f.setMinutes(0);f.setSeconds(0);f.setDate(f.getDate()-90);g=new Date;g.setHours(0);g.setMinutes(0);g.setSeconds(0);g.getTime()>=f.getTime()?a.plugin().valid?(a.plugin().SetCAInfo(a.ESVS.CMPIP,a.ESVS.CMPPort),d=a.loadUI("certprocessing"),RenewingDialog=d({type:"CERT_RENEWAL",args:null,onConfirm:null,onCancel:null}),RenewingDialog.show(),setTimeout(function(){var c=a.plugin().UpdateCertificate();0!=c?(a.ERROR.Code=a.plugin().GetLastErrorCode(),a.ERROR.Message=a.plugin().GetLastErrorMessage(),RenewingDialog.dispose(c,a.ERROR.Code,a.ERROR.Message)):RenewingDialog.dispose(c,0,null);b(c);a.plugin().ClearAllUserCertList()},1E3)):b(-1,"",""):b(-1,f,d)}},onCancel:function(){a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();c.dispose();a.uiUtil().getUserCancelErrCodeNMsg();b(a.ERROR.Code,"","")}});c.show();return!0}},RevocateCert:function(b){function c(b,c,e,l){var n=a.loadUI("certrevoke")({type:null,args:null,onConfirm:function(m){n.dispose();if(4<=a.ESVS.Mode)if(a.nimservice()){var p=a.loadUI("certprocessing");RevokingDialog=p({type:"CERT_REVOCATION",args:null,onConfirm:null,onCancel:null});RevokingDialog.show();a.nimservice().RevokeCertificate(a.ESVS.CMPIP,a.ESVS.CMPPort,e,l,b,m,function(a,b){0===a?RevokingDialog.dispose(0,null,null,function(){d(0)}):RevokingDialog.dispose(a,a,b,function(){d(a)})})}else d(-1);else"undefined"!==typeof b&&"undefined"!==typeof c?(p=a.loadUI("certprocessing"),RevokingDialog=p({type:"CERT_REVOCATION",args:null,onConfirm:null,onCancel:null}),RevokingDialog.show(),setTimeout(function(){var e=window.console||{log:function(){}};t&&(e.log("b64 cert : ",a.PFUC[b].signcert),e.log("b64 pri : ",a.PFUC[b].signpri));var h=a.usWebToolkit.usWebCMP.revReason.keyCompromise;switch(m){case 1:h=a.usWebToolkit.usWebCMP.revReason.keyCompromise;t&&e.log("cause : keyCompromise");break;case 3:h=a.usWebToolkit.usWebCMP.revReason.afilationChanged;t&&e.log("cause : afilationChanged");break;case 5:h=a.usWebToolkit.usWebCMP.revReason.superseded,t&&e.log("cause : superseded")}try{a.usWebToolkit.usWebCMP.revocation(a.PFUC[b].signcert,a.PFUC[b].signpri,a.PFUC[b].kmcert,c,document.domain,h,a.PFSH,function(b,c,e){1===b?RevokingDialog.dispose(0,0,null,function(){d(0)}):2===b?(a.ERROR.Code=-1,a.ERROR.Message=c,RevokingDialog.dispose(-1,a.ERROR.Code,a.ERROR.Message,function(){d(a.ERROR.Code)})):(a.ERROR.Code=e.code,a.ERROR.Message=e.message,RevokingDialog.dispose(-2,a.ERROR.Code,a.ERROR.Message,function(){d(a.ERROR.Code)}))})}catch(l){a.ERROR.Code=l.code,a.ERROR.Message=l.message,RevokingDialog.dispose(-2,a.ERROR.Code,a.ERROR.Message,function(){d(a.ERROR.Code)})}b=0;c=null},1E3)):a.plugin().valid?(a.plugin().SetCAInfo(a.ESVS.CMPIP,a.ESVS.CMPPort),p=a.loadUI("certprocessing"),RevokingDialog=p({type:"CERT_REVOCATION",args:null,onConfirm:null,onCancel:null}),RevokingDialog.show(),setTimeout(function(){var b=a.plugin().RevokeCertificate(m);0!=b?(a.ERROR.Code=a.plugin().GetLastErrorCode(),a.ERROR.Message=a.plugin().GetLastErrorMessage(),RevokingDialog.dispose(b,a.ERROR.Code,a.ERROR.Message,function(){d(b)})):RevokingDialog.dispose(b,0,null,function(){d(b)});a.plugin().ClearAllUserCertList()},1E3)):d(-1)},onCancel:function(){n.dispose();a.uiUtil().getUserCancelErrCodeNMsg();d(a.ERROR.Code)}});n.show()}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(b&&!document.getElementById("us-div-cert-select")){var d=b;a.reInitialize();var e=a.loadUI("certselect")({type:"CERT_REVOCATION",args:{dn:null},onConfirm:function(b,g,h,l,n){e.dispose();var m=a.loadUI("confirm")({type:null,args:{msg:b},onConfirm:function(){m.dispose();c(g,h,l,n)},onCancel:function(){m.dispose();a.uiUtil().getUserCancelErrCodeNMsg();d(a.ERROR.Code)}});m.show()},onCancel:function(){a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();e.dispose();a.uiUtil().getUserCancelErrCodeNMsg();d(a.ERROR.Code)}});e.show();return!0}},SOECert:function(b){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b||document.getElementById("us-div-cert-select"))return!1;a.reInitialize();var c=a.loadUI("certselect")({type:"CERT_SOE",args:{dn:null},onConfirm:function(d){c.dispose();confirm(d)&&(a.plugin().valid?(a.plugin().SetCAInfo(a.ESVS.CMPIP,a.ESVS.CMPPort),RevokingDialog=a.loadUI("certprocessing")({type:"CERT_SOE",args:null,onConfirm:null,onCancel:null}),RevokingDialog.show(),setTimeout(function(){var c=a.plugin().RevokeCertificate(6);0!=c?(a.ERROR.Code=a.plugin().GetLastErrorCode(),a.ERROR.Message=a.plugin().GetLastErrorMessage(),RevokingDialog.dispose(c,a.ERROR.Code,a.ERROR.Message)):RevokingDialog.dispose(c,0,null);b(c);a.plugin().ClearAllUserCertList()},1E3)):b(-1))},onCancel:function(){a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();c.dispose();a.uiUtil().getUserCancelErrCodeNMsg();b(a.ERROR.Code)}});c.show();return!0}},VerifyVID:function(b,c){function d(b,c,d,f,m,p){if("PFS"==p)try{var q=window.console||{log:function(){}};t&&(q.log("b64 cert : ",a.PFUC[c].signcert),q.log("b64 pri : ",a.PFUC[c].signpri));var v=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[c].signcert),s=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[c].signpri),k=a.usWebToolkit.pkcs8.verifyVID(s,d,b,v);d=b="";k?e(!0):e(!1)}catch(B){d=b="",a.ERROR.Code=B.code,a.ERROR.Message=B.message,e(!1)}else"NIM"==p?(a.uiUtil().createLoadingBox("show","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_VID_VERIFY_MESSAGE),a.nimservice().VerifyVID(c,d,b,function(c,f){a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");0==c?e(!0):(a.ERROR.Code=c,a.ERROR.Message=f,e(!1));d=b=""})):a.plugin().valid&&(k=a.plugin().VerifyIdentifyUserCert(c,d,b),d=b="",0!=k?(a.ERROR.Code=a.plugin().GetLastErrorCode(),a.ERROR.Message=a.plugin().GetLastErrorMessage(),e(!1)):e(!0),a.plugin().ClearAllUserCertList())}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!c||document.getElementById("us-div-cert-select"))return!1;var e=c;a.reInitialize();var f=a.loadUI("certselect")({type:"VID_VERIFICATION",args:{dn:null},onConfirm:function(c,h,l,n,m){f.dispose();if(b)d(b,c,h,l,n,m);else{var p=a.loadUI("ssn")({type:null,onConfirm:function(a){d(a,c,h,l,n,m);p.dispose()},onCancel:function(){a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();p.dispose();a.uiUtil().getUserCancelErrCodeNMsg();e(!1)}});p.show()}},onCancel:function(){a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();f.dispose();a.uiUtil().getUserCancelErrCodeNMsg();e(!1)}});f.show();return!0}},ManageCert:function(){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{a.reInitialize();var b=a.loadUI("certmanage")({type:"CERT_MANAGEMENT",onConfirm:null,onCancel:function(){a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();b.dispose();a.uiUtil().getUserCancelErrCodeNMsg()}});b.show();return!0}},ManageCertByType:function(b){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{a.reInitialize();var c=a.loadUI("certmanage")({type:"CERT_MANAGEMENT",args:{type:b},onConfirm:null,onCancel:function(){a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();c.dispose();a.uiUtil().getUserCancelErrCodeNMsg()}});c.show();return!0}},ImportCertFromMobileApp:function(b,c){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!c||!b)return!1;a.reInitialize();if(!a.PFSH)return!1;try{try{a.PFSH.SelectStorage(1)}catch(d){return t&&(m.log("***** Plugin Free SelectStorage error *****"),m.log("e.code : ",d.code,"e.message : ",d.message,"e.detail : ",d.detail)),alert("error : "+d.detail),!1}try{a.PFSH.LoadAllCerts(document.domain)}catch(e){if(301E5===e.code)a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain);else return t&&(m.log("***** Plugin Free LoadAllCerts error *****"),m.log("e.code : ",e.code,"e.message : ",e.message,"e.detail : ",e.detail)),alert("error : "+e.detail),!1}var f=a.PFSH.SetP12HexOnMemory(b,c),g=f.aluc[f.index];a.usWebToolkit.x509Certificate.parser(g.signcert,"Base64");var h=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),l=a.certUtil().getIssuerEnName(h);a.PFSH.SaveUserCert(l,g,document.domain,!0);return!0}catch(n){var m=window.console||{log:function(){}};t&&(m.log("***** Plugin Free MobileImportCert error *****"),m.log("e.code : ",n.code,"e.message : ",n.message,"e.detail : ",n.detail));alert("error : "+n.detail)}return!1}},SetSelectedDevice:function(b){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{var c="",d;for(d in a.CONST.medias)if(a.CONST.medias[d].device===b){c=a.CONST.medias[d].name;break}a.ESVS.Media.defaultdevice=c}},NimServiceLoaded:function(){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else return a.nimservice()?a.nimservice().GetIframeLoaded():null},SecureMail:function(b,c,d,e,f){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if("seed"!=c)return a.ERROR.Code=-1,a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_ERROR_NOT_SUPPORT_ALGORITHM,f(null);if(null==d||""==d||1>d.length)alert(a.uiUtil().getErrorMessageLang().IDS_NOT_ENCRYPTED_DATA);else{a.reInitialize();var g=0,h=a.loadUI("securemail")({type:"SECURE_MAIL",args:{algorithm:c,data:d,decryptData:this.DecryptFileData,mode:b},onConfirm:function(c,d,m,p){if(3<g)null!=document.getElementById("html_encripted")&&(document.getElementById("html_encripted").innerHTML=""),alert(m.IDS_KEY_TYPE[b]+m.IDS_PASSWORD_WRONG),h.dispose();else{var q=document.getElementById("us-input-secure-mail-password");c=p(c,q.value,d,e);if(-10===c)return a.ERROR.Code=-10,a.ERROR.Message=m.IDS_ALGORITHM_ALERT,h.dispose(),f(null);if(-11===c){a.ERROR.Code=-11;a.ERROR.Message=m.IDS_KEY_TYPE[b]+m.IDS_PASSWORD_WRONG;if(4<g)return h.dispose(),f(null);g+=1;alert(m.IDS_KEY_TYPE[b]+m.IDS_DISCORDANCE_PASSWORD.replace("@",g));q.value=""}else{if(-12===c)return h.dispose(),f(null);if(-13===c){a.ERROR.Code=-13;a.ERROR.Message=m.IDS_KEY_TYPE[b]+m.IDS_PASSWORD_WRONG;if(4<g)return h.dispose(),f(null);g+=1;alert(m.IDS_KEY_TYPE[b]+m.IDS_DISCORDANCE_PASSWORD.replace("@",g));q.value=""}else h.dispose(),f(c)}}},onCancel:function(){h.dispose();a.uiUtil().getUserCancelErrCodeNMsg();f()}});h.show()}}},DecryptFileData:function(b,c,d,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{var f,g=c;f=0;for(c=c.length;16>c;c++)g+="abcdefghijklmnopqrstuvwxyz".substr(f++,1);f=g+"0123450123456789";c=b.toLowerCase();if("seed"==c)g=f.substring(0,16),f=f.substring(16,32);else if("3des"==c)g=f.substring(0,24),f=f.substring(24,32);else if("rc2"==c)g=f.substring(0,5),f=f.substring(5,13);else if("des"==c)g=f.substring(0,8),f=f.substring(8,16);else return-10;d=a.usWebToolkit.util.decode64(d);"3des"==c&&(b="des");c=null;try{var h=a.usWebToolkit.cipher.algorithms[b].startDecrypting(g,f);h.update(a.usWebToolkit.util.createBuffer(d));if(!1==h.finish())return-11;0==e||null==e?c=h.output.toHex():1==e&&(c=h.output.getBytes())}catch(l){return a.ERROR.Code=l.code,a.ERROR.Message=l.message,-12}if(0==e||null==e)try{c=a.usWebToolkit.unicode.hex2UTF8(c)}catch(n){return-13}return c}},getFileDownload:function(b,c){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if("function"==typeof saveAs){if(null==c||""==c||1>c.length){var d=document.location.href.split("/");c=d[d.length-1]}d=new Blob([b],{type:"application/otect-stream"});try{saveAs(d,c)}catch(e){alert(a.uiUtil().getErrorMessageLang().IDS_ERROR_BROWSER_NOT_SUPPORT)}}else alert(a.uiUtil().getErrorMessageLang().IDS_ERROR_BROWSER_NOT_SUPPORT)},SignData_noConWithHash:function(b,c,d,e,f){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b||document.getElementById("us-div-cert-select")||!f)return!1;a.reInitialize();var g=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P1",args:{dn:c},onConfirm:function(c,l,n,m,p,q){var v={};if("undefined"!==typeof m&&"undefined"!==typeof p)if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!=q)if(a.nimservice()){l=function(b){if(!b64HashData)return"";var c=null;if("SHA1"==d||"sha1"==d)c="1.3.14.3.2.26";else if("MD5"==d||"md5"==d)c="1.2.840.113549.2.5";else if("SHA256"==d||"sha256"==d)c="2.16.840.1.101.3.4.2.1";b=crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.SEQUENCE,!0,[crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.SEQUENCE,!0,[crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.OID,!1,crosscert.asn1.oidToDer(c).getBytes()),crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.NULL,!1,"")]),crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.OCTETSTRING,!1,b)]);return a.usWebToolkit.asn1.toDer(b).getBytes()};n=0;q=[];if(b)for(var s in b){var k=a.usWebToolkit.util.decode64(b[s]),k=l(k),k=a.usWebToolkit.util.encode64(k);q[n]=k;n++}a.nimservice().GetSignDataP7(m,p,1,q,!1,e,function(d,e,l,n){if(0!=d)a.ERROR.Code=d,a.ERROR.Message=e,a.uiUtil().errMsgBox(e,a.ERROR.Code),f("","","");else{d=0;for(var q in b)v[q]=l[d++];l=a.certUtil().getTheCertAttributes(c,"Base64");f(v,n,l)}m=p=cert=pri=null;a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){g.dispose()},10)})}else f("","",""),setTimeout(function(){g.dispose()},10);else setTimeout(function(){g.dispose()},10);else f("","",""),setTimeout(function(){g.dispose()},10)},onCancel:function(){a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();g.dispose();a.uiUtil().getUserCancelErrCodeNMsg();f("","","")}});g.show();return!0}},VerifySignData_noConWithHash:function(b,c,d){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!plainText||!c)return!1;a.reInitialize();if(1&a.ESVS.Mode)a.plugin();else if(4&a.ESVS.Mode)a.nimservice()&&a.nimservice().VerifySignedDataWithHashValue(b,c,function(b,c){0!=b&&(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage());d(b)});else{var e=null;try{var f=a.usWebToolkit.util.decode64(b),e=a.usWebToolkit.pkcs7.messageFromBase64(c);e.verifyWithHash(f)}catch(g){return a.ERROR.Code=g.code,a.ERROR.Message=g.message,null}return e.verifyResult}return!1}},SignMultiDataP7:function(b,c,d,e,f,g){if(!b&&!c||!g||document.getElementById("us-div-cert-select"))return!1;a.reInitialize();var h=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:d},onConfirm:function(d,n,m,p,q){var v=1,s={};if("undefined"!==typeof m&&"undefined"!==typeof p)if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!=q)if(a.nimservice()){d=0;v=[];if(b)for(var k in b)v[d]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b[k])),d++;else for(k in B)v[d]=c[k],d++;a.nimservice().GetSignDataP7(m,p,0,v,e,f,function(d,e,f,l){if(0!=d)a.ERROR.Code=d,a.ERROR.Message=e,g("");else{d=0;e=b;c&&(e=c);for(var k in e)s[k]=f[d++];g(s,l,n,q)}m=p=cert=pri=null;a.uiUtil().loadingBox(!1,"us-div-list-load");h.dispose()})}else g(""),h.dispose();else h.dispose(),m=p=cert=pri=null;else{if(a.plugin().valid){var B={};if(c)for(v in c)B[v]=a.usWebToolkit.util.decode64(c[v]);else B=b;for(k in B){var r=B[v],t=null;if(t=e?a.plugin().MakeSignedData(r):a.plugin().MakeSignedData_NoContents(r))s[v]=t;else{s=null;break}}s?g(s,n):(a.ERROR.Code=a.plugin().GetLastErrorCode(),a.ERROR.Message=a.plugin().GetLastErrorMessage(),a.uiUtil().errMsgBox(d,a.ERROR.Code),g(""));a.ESVS.Embedded||a.plugin().ClearAllUserCertList()}else g("");h.dispose()}},onCancel:function(){1&a.ESVS.Mode&&a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();h.dispose();a.uiUtil().getUserCancelErrCodeNMsg();g("")}});h.show();return!0},SignMultiDataP7NVerifyVID:function(b,c,d,e,f,g){if(!b&&!c||!g||document.getElementById("us-div-cert-select"))return!1;a.reInitialize();var h=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:d},onConfirm:function(d,n,m,p,q){var k=1,s={};if("undefined"!==typeof m&&"undefined"!==typeof p)if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!=q)if(a.nimservice()){d=0;k=[];if(b)for(var r in b)k[d]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b[r])),d++;else for(r in B)k[d]=c[r],d++;a.nimservice().GetSignDataP7(m,p,0,k,e,null,function(d,e,l,k){if(0!=d)a.ERROR.Code=d,a.ERROR.Message=e,g(-1,"");else{d=0;e=b;c&&(e=c);for(var v in e)s[v]=l[d++];ga(f,m,p,s,n,q,g)}m=p=cert=pri=null;a.uiUtil().loadingBox(!1,"us-div-list-load");h.dispose()})}else g(-1,""),h.dispose();else m=p=cert=pri=null,h.dispose();else{if(a.plugin().valid){var B={};if(c)for(k in c)B[k]=a.usWebToolkit.util.decode64(c[k]);else B=b;for(r in B){var t=B[k],u=null;if(u=e?a.plugin().MakeSignedData(t):a.plugin().MakeSignedData_NoContents(t))s[k]=u;else{s=null;break}}s?g(s,n):(a.ERROR.Code=a.plugin().GetLastErrorCode(),a.ERROR.Message=a.plugin().GetLastErrorMessage(),a.uiUtil().errMsgBox(d,a.ERROR.Code),g(""));a.ESVS.Embedded||a.plugin().ClearAllUserCertList()}else g("");h.dispose()}},onCancel:function(){1&a.ESVS.Mode&&a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();h.dispose();a.uiUtil().getUserCancelErrCodeNMsg();g(a.ERROR.Code,"")}});h.show();return!0},Base64Encoding:function(b){b=a.usWebToolkit.util.encodeUtf8(b);return(b=a.usWebToolkit.util.encode64(b))?b:null},Base64Decoding:function(b){b=a.usWebToolkit.util.decode64(b);return(b=a.usWebToolkit.util.decodeUtf8(b))?b:null},SignPersonInfoReqP7:function(b,c,d,e,f){if(!b||!c||4>c.length||!f||document.getElementById("us-div-cert-select"))return!1;a.reInitialize();e=null;try{e=a.usWebToolkit.util.encodeUtf8(b)}catch(g){a.ERROR.Code=1E7,a.ERROR.Message="[TOOLKIT UTIL ERROR] during encoding utf8 character set.\ndetail : "+g,f("","")}b=null;try{b=a.usWebToolkit.asn1.create(a.usWebToolkit.asn1.Class.UNIVERSAL,a.usWebToolkit.asn1.Type.UTF8,!1,e)}catch(h){a.ERROR.Code=1E7,a.ERROR.Message="[TOOLKIT ASN.1 ERROR] during creating useragreement asn.1 struct.\ndetail : "+h,f("","")}e=0;"1"===c.charAt(0)&&(e|=128);"1"===c.charAt(1)&&(e|=64);"1"===c.charAt(2)&&(e|=32);"1"===c.charAt(3)&&(e|=16);c=String.fromCharCode(4);var l=String.fromCharCode(e);e=null;try{e=a.usWebToolkit.asn1.create(a.usWebToolkit.asn1.Class.UNIVERSAL,a.usWebToolkit.asn1.Type.BITSTRING,!1,c+l)}catch(n){a.ERROR.Code=1E7,a.ERROR.Message="[TOOLKIT ASN.1 ERROR] during creating useragree asn.1 struct.\ndetail : "+n,f("","")}c=null;try{c=a.usWebToolkit.asn1.create(a.usWebToolkit.asn1.Class.UNIVERSAL,a.usWebToolkit.asn1.Type.SEQUENCE,!0,[b,e])}catch(m){a.ERROR.Code=1E7,a.ERROR.Message="[TOOLKIT ASN.1 ERROR] during creating personinforeq asn.1 struct.\ndetail : "+m,f("","")}b=null;try{b=a.usWebToolkit.asn1.toDer(c)}catch(p){a.ERROR.Code=1E7,a.ERROR.Message="[TOOLKIT ASN.1 ERROR] during converting object to der format.\ndetail : "+p,f("","")}var k=null;try{k=a.usWebToolkit.util.encode64(b.getBytes())}catch(v){a.ERROR.Code=1E7,a.ERROR.Message="[TOOLKIT UTIL ERROR] during encoding base64 string.\ndetail : "+v,f("","")}var s=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:d},onConfirm:function(b,c,d,e,g){"undefined"!==typeof d&&"undefined"!==typeof e&&4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!=g&&(a.nimservice()?a.nimservice().GetSignDataP7(d,e,0,k,!0,null,function(b,d,e){0!=b?(a.ERROR.Code=b,a.ERROR.Message=d,f("")):f(e,c);a.uiUtil().loadingBox(!1,"us-div-list-load");s.dispose()}):(f(""),s.dispose()))},onCancel:function(){1&a.ESVS.Mode&&a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();s.dispose();a.uiUtil().getUserCancelErrCodeNMsg();f("","")}});s.show();return!0},SignMultiDataP1:function(b,c,d){if(!b||!d||document.getElementById("us-div-cert-select"))return!1;a.reInitialize();var e=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P1",args:{dn:c},onConfirm:function(c,g,h,l,n,m){var p={};if("undefined"!==typeof l&&"undefined"!==typeof n)if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!=m)if(a.nimservice()){h=0;m=[];if(b)for(var k in b)m[h]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b[k])),h++;a.nimservice().GetSignDataP1(l,n,m,null,function(h,l,n,m){if(0!=h)a.ERROR.Code=h,a.ERROR.Message=l,a.uiUtil().errMsgBox(l,a.ERROR.Code),d("");else{h=0;for(var k in b)p[k]=n[h++];d(p,c,g)}a.uiUtil().loadingBox(!1,"us-div-list-load");e.dispose()})}else d(""),e.dispose();else l=n=cert=pri=null,e.dispose();else e.dispose()},onCancel:function(){1&a.ESVS.Mode&&a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();e.dispose();a.uiUtil().getUserCancelErrCodeNMsg();d("")}});e.show();return!0},VerifySignedDataP7ExcludedContent:function(b,c,d){if(!c)return null;a.reInitialize();if(1&a.ESVS.Mode){if(a.plugin().valid)return c=a.plugin().VerifySignedData_NoContents(b,c),0!=c&&(a.ERROR.Code=a.plugin().GetLastErrorCode(),a.ERROR.Message=a.plugin().GetLastErrorMessage()),c}else if(4&a.ESVS.Mode)a.nimservice()&&(b=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)),a.nimservice().VerifySignedData(b,c,function(b,c){0!=b&&(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage());d(b);a.uiUtil().loadingBox(!1,"us-div-list-load")}));else{var e=null;try{e=a.usWebToolkit.pkcs7.messageFromBase64(c),e.verify(void 0,a.usWebToolkit.util.encodeUtf8(b))}catch(f){return a.ERROR.Code=f.code,a.ERROR.Message=f.message,-1}return!0==e.verifyResult?0:-1}},SignDataP7AndVerifyVID:function(b,c,d,e){if(!b&&!plainB64Text||!e||document.getElementById("us-div-cert-select"))return!1;a.reInitialize();var f=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION",args:{dn:c},onConfirm:function(c,h,l,n,m){l=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b));a.nimservice().GetSignDataP7(c,h,0,l,!0,null,function(b,l,k,s){0!=b?(a.ERROR.Code=b,a.ERROR.Message=l,e(b,"")):ga(d,c,h,k,n,m,e);h=d="";a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();a.uiUtil().loadingBox(!1,"us-div-list-load");f.dispose()})},onCancel:function(){a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();f.dispose();a.uiUtil().getUserCancelErrCodeNMsg();e(a.ERROR.Code,"")}});f.show();return!0},MakeHash:function(b,c,d,e){if(!b)return null;var f=c;f&&"undefined"!==typeof f||(f="SHA256");if(4&a.ESVS.Mode)a.nimservice()?"FilePath"===d?(b=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)),a.nimservice().HashData(1,b,c,function(b,c){0==b?e(b,c):(a.ERROR.Code=b,e(b,""))})):(b=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)),a.nimservice().HashData(0,b,c,function(b,c){0==b?e(b,c):(a.ERROR.Code=b,e(b,""))})):(a.ERROR.Code=-1,e(-1,""));else if("FilePath"!==d)try{var g=a.usWebToolkit.util.encodeUtf8(b),h=crosscert.md.algorithms[f.toLowerCase()].create();h.start();h.update(g);return a.usWebToolkit.util.encode64(h.digest().getBytes())}catch(l){return a.ERROR.Code=l.code,a.ERROR.Message=l.message,""}},EncryptData:function(b,c,d,e,f){function g(b,c,d,f,g,h){4&a.ESVS.Mode?a.nimservice()?(c=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d)),a.nimservice().EnvelopData("signcert",b,c,function(b,c,d){0==b?g(b,d):(a.ERROR.Code=b,g(b,""));h.dispose()})):(a.ERROR.Code=-1,g(-1,""),h.dispose()):2&a.ESVS.Mode&&(b=null,a.plugin().valid?(d&&(b=c&&0<c.length?a.plugin().MakeEnvelopedDataWithCert(d,c):a.plugin().MakeEnvelopedData(d)),b?g(b):(a.ERROR.Code=a.plugin().GetLastErrorCode(),a.ERROR.Message=a.plugin().GetLastErrorMessage(),a.uiUtil().errMsgBox(f,a.ERROR.Code),g("")),e&&a.plugin().ClearAllUserCertList()):g(""))}if(!b||!f||document.getElementById("us-div-cert-select"))return!1;a.reInitialize();if(d&&0<d.length)g(d,b,null,f);else{var h=a.loadUI("certselect")({type:"ENCRYPT_P7",args:{dn:c},onConfirm:function(a,c,e){g(a,d,b,e,f,h)},onCancel:function(){a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();h.dispose();a.uiUtil().getUserCancelErrCodeNMsg();f("")}});h.show()}return!0},EncryptDataWithSymmKey:function(b,c,d,e,f){if(!d||!c)return null;var g="",h="",g="",l=0;b=b.toLowerCase();if("seed"==b)h=c.substring(0,16),g="0123456789012345",b64SymmKey=a.usWebToolkit.util.encode64(h);else if("3des"==b){l=3;b="des";h=c.substring(0,24);g=crosscert.util.bytesToHex(h);c=h.length;for(i=0;i<24-c;i++)g+="00";b64SymmKey=a.usWebToolkit.util.encode64(crosscert.util.hexToBytes(g));g="01234567"}else return null;if(4&a.ESVS.Mode)if(a.nimservice()){d=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d));var h=a.usWebToolkit.util.encode64(g),n=0;"utf-8"==e.toLowerCase()&&(n=1);a.nimservice().EncryptData(l,h,b64SymmKey,d,1,n,function(b,c){0==b?f(b,c):(a.ERROR.Code=b,f(b,""))})}else a.ERROR.Code=-1,f(-1,"");else try{return n=crosscert.cipher.algorithms[b].startEncrypting(h,g),n.update(crosscert.util.createBuffer(d)),n.finish(),a.usWebToolkit.util.encode64(n.output.getBytes())}catch(m){return a.ERROR.Code=m.code,a.ERROR.Message=m.message,""}},DecryptDataWithSymmKey:function(b,c,d,e,f,g){if(!d||!c)return null;var h="",l="",n=0,m="";b=b.toLowerCase();if("seed"==b)h=c.substring(0,16),l="0123456789012345",m=a.usWebToolkit.util.encode64(c);else if("3des"==b){n=3;b="des";h=c.substring(0,24);m=crosscert.util.bytesToHex(h);c=h.length;for(i=0;i<24-c;i++)m+="00";m=a.usWebToolkit.util.encode64(crosscert.util.hexToBytes(m));l="01234567"}else return null;if(4&a.ESVS.Mode)if(a.nimservice()){var h=a.usWebToolkit.util.encode64(l),k=0;"utf-8"==e.toLowerCase()&&(k=1);e=0;"utf-8"==f.toLowerCase()&&(e=1);a.nimservice().DecryptData(n,h,m,d,k,e,function(b,c){0==b?g(b,a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(c))):(a.ERROR.Code=b,g(b,""))})}else a.ERROR.Code=-1,g(-1,"");else try{var k=a.usWebToolkit.util.decode64(d),q=crosscert.cipher.algorithms[b].startDecrypting(h,l);q.update(crosscert.util.createBuffer(k));q.finish();return q.output.getBytes()}catch(v){return a.ERROR.Code=v.code,a.ERROR.Message=v.message,""}},SetConfigInfo:function(b){b.PKI&&(a.ESVS.PKI=k.PKI=U=b.PKI);b.Language&&("ko-kr"==b.Language.toLowerCase()?a.ESVS.Language=k.Language=Q="ko_kr":a.ESVS.Language=k.Language=Q="en_us",__FileUtil=__ForgeryUtil=__CertUtil=__UIUtil=null,__UIUtil=new A.UI,__CertUtil=new A.CERT,__ForgeryUtil=new A.FORGERY,__FileUtil=new A.FILE);b.TabIndex&&(a.ESVS.TabIndex=k.TabIndex=S=b.TabIndex);b.LimitNumOfTimesToTryToInputPW&&(a.ESVS.LimitNumOfTimesToTryToInputPW=k.LimitNumOfTimesToTryToInputPW=R=b.LimitNumOfTimesToTryToInputPW);b.Policy&&(a.ESVS.Policy=k.Policy=X=b.Policy);b.ShowExpiredCerts&&(a.ESVS.ShowExpiredCerts=k.ShowExpiredCerts=Y=b.ShowExpiredCerts);b.LimitMinNewPWLen&&(a.ESVS.LimitMinNewPWLen=k.LimitMinNewPWLen=D=b.LimitMinNewPWLen);b.LimitMaxNewPWLen&&(a.ESVS.LimitMaxNewPWLen=k.LimitMaxNewPWLen=I=b.LimitMaxNewPWLen);b.LimitNewPWPattern&&(a.ESVS.LimitNewPWPattern=k.LimitNewPWPattern=L=b.LimitNewPWPattern)},SignFileP7:function(b,c,d,e,f,g){if(!b||1==d&&!e||!g||document.getElementById("us-div-cert-select"))return!1;a.reInitialize();var h=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7_FILE",args:{dn:c},onConfirm:function(c,n,m,k,q,v){q=null;4&a.ESVS.Mode?a.nimservice()?(m=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)),k="",null!=e&&(k=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(e))),m=[m,d,k],a.nimservice().GetSignFileP7(c,n,m,f,null,function(b,e,f,m){0!=b?(a.ERROR.Code=b,a.ERROR.Message=e,g(b,"")):1==d?(e=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(f)),g(b,e,v)):g(b,f,v);c=n=cert=pri=null;a.uiUtil().loadingBox(!1,"us-div-list-load");h.dispose()})):(g(-1,""),h.dispose()):(a.plugin().valid?(retStr?q=f?a.plugin().MakeSignedDataFromFile(b):a.plugin().MakeSignedDataFromFile_NoContents(b):f?(q=a.plugin().MakeSignedDataFileFromFile(b,0))||4124E4!==a.plugin().GetLastErrorCode()||confirm(k)&&(q=a.plugin().MakeSignedDataFileFromFile(b,1)):(q=a.plugin().MakeSignedDataFileFromFile_NoContents(b,0))||4124E4!==a.plugin().GetLastErrorCode()||confirm(k)&&(q=a.plugin().MakeSignedDataFileFromFile_NoContents(b,1)),q?g(-1,q):(a.ERROR.Code=a.plugin().GetLastErrorCode(),a.ERROR.Message=a.plugin().GetLastErrorMessage(),a.uiUtil().errMsgBox(m,a.ERROR.Code),g(-1,""))):g(-1,""),h.dispose())},onCancel:function(){a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();h.dispose();a.uiUtil().getUserCancelErrCodeNMsg();g(a.ERROR.Code,"")}});h.show();return!0},SignMultiFileP7:function(b,c,d,e,f,g){if(!b||!g||document.getElementById("us-div-cert-select"))return!1;a.reInitialize();var h=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7_FILE",args:{dn:c},onConfirm:function(c,n,m,k,q,v){var s={};if(4&a.ESVS.Mode)if(a.nimservice()){m=0;k=[];q=[];if(b)for(var r in b)k[m]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b[r])),m++;if(e)for(r in m=0,e)q[m]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(e[r])),m++;r=[k,d,q];a.nimservice().GetSignFileP7(c,n,r,f,null,function(e,f,m,k){if(0!=e)a.ERROR.Code=e,a.ERROR.Message=f,g(e,"");else{f=0;if(1==d)for(var p in b)s[p]=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(m[f++]));else for(p in b)s[p]=m[f++];g(e,s,v)}c=n=cert=pri=null;a.uiUtil().loadingBox(!1,"us-div-list-load");h.dispose()})}else g(-1,""),h.dispose();else a.plugin().valid?(retStr?rData=f?a.plugin().MakeSignedDataFromFile(filePath):a.plugin().MakeSignedDataFromFile_NoContents(filePath):f?(rData=a.plugin().MakeSignedDataFileFromFile(filePath,0))||4124E4!==a.plugin().GetLastErrorCode()||confirm(k)&&(rData=a.plugin().MakeSignedDataFileFromFile(filePath,1)):(rData=a.plugin().MakeSignedDataFileFromFile_NoContents(filePath,0))||4124E4!==a.plugin().GetLastErrorCode()||confirm(k)&&(rData=a.plugin().MakeSignedDataFileFromFile_NoContents(filePath,1)),rData?g(-1,rData):(a.ERROR.Code=a.plugin().GetLastErrorCode(),a.ERROR.Message=a.plugin().GetLastErrorMessage(),a.uiUtil().errMsgBox(m,a.ERROR.Code),g(-1,""))):g(-1,""),h.dispose()},onCancel:function(){a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();h.dispose();a.uiUtil().getUserCancelErrCodeNMsg();g(a.ERROR.Code,"")}});h.show();return!0},SetUBIKeyEnvInfo:function(b,c,d,e){a.ubiKeyEnv={version:b,siteInfo:c,securityInfo:d,downloadURL:e}},SetMobileTokenEnvInfo:function(b,c,d,e,f){a.usimEnv={sitecode:b,modecode:c,siteURL:d,serviceIP:e,servicePort:f}},DecryptData:function(b,c){function d(d,e,h,l){4&a.ESVS.Mode&&(a.nimservice()?a.nimservice().DeenvelopData("signcert",d,e,b,function(b,d,e){0==b?(d=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(e)),c(b,d)):(a.ERROR.Code=b,c(b,""));l.dispose()}):(a.ERROR.Code=-1,c(-1,""),l.dispose()))}if(!b||!c||document.getElementById("us-div-cert-select"))return!1;a.reInitialize();var e=a.loadUI("certselect")({type:"ENCRYPT_P7",args:{dn:null},onConfirm:function(a,b,c){d(a,b,c,e)},onCancel:function(){e.dispose();a.uiUtil().getUserCancelErrCodeNMsg();c(a.ERROR.Code,"")}});e.show();return!0},VerifyKeyPair:function(b){function c(c,d,g,m,k,q){4&a.ESVS.Mode&&a.nimservice().GetSignDataP7(g,m,0,e,!0,null,function(c,d,e,h){0!=c?(a.ERROR.Code=c,a.ERROR.Message=d,f.errmsg=d,b(-1,f)):a.nimservice().VerifySignedData(null,e,function(b,c){0!=b?(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),f.signcert=a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_SIGN+":"+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_FAIL+"("+a.uiUtil().getErrorMessageLang().IDS_VERIFY_SIGN+")",q(0)):a.nimservice().ValidateCertificate(g,function(b,c,d,e){f.signcert=0==b?999==d?a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_SIGN+":"+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_OK:a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_SIGN+":"+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_FAIL+"("+e+")":a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_SIGN+":"+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_FAIL+"("+c+")";q(0)})});a.uiUtil().loadingBox(!1,"us-div-list-load")})}function d(c,d,g,k,p,q){4&a.ESVS.Mode&&a.nimservice().EnvelopData("kmcert",g,e,function(c,d,e){0==c?a.nimservice().DeenvelopData("kmcert",g,k,e,function(c,d,e){f.kmcert=0==c?a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_KM+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_OK:-2==c?a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_KM+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_NONE:a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_KM+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_FAIL+"("+d+")";q&&q.dispose();b(0,f)}):(f.kmcert=-2==c?a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_KM+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_NONE:a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_KM+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_FAIL+"("+d+")",q&&q.dispose(),b(0,f))})}if(!b)return!1;var e="1234",f={errmsg:"",signcert:"",kmcert:""};a.reInitialize();var g=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:null},onConfirm:function(a,b,e,f,k){c(a,b,e,f,k,function(c){d(a,b,e,f,k,g)})},onCancel:function(){g.dispose();a.uiUtil().getUserCancelErrCodeNMsg();f.errmsg=a.ERROR.Message;b(a.ERROR.Code,f)}});g.show();return!0},VerifyP7SignedFileWithFile:function(b,c,d,e,f){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!c||1==d&&!e)return null;a.reInitialize();if(4&a.ESVS.Mode&&a.nimservice()){var g=null;null!=b&&(g=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)));b=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c));e=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(e));a.nimservice().VerifySignedFile(g,2,b,d,e,function(b,c){if(0!=b)a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),f(b,null);else if(1==d){var e=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(c));f(b,e)}else f(b,a.usWebToolkit.util.decode64(c));a.uiUtil().loadingBox(!1,"us-div-list-load")})}}},VerifyP7SignedDataWithFile:function(b,c,d,e,f){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!c||1==d&&!e)return null;a.reInitialize();if(4&a.ESVS.Mode&&a.nimservice()){var g=null;null!=b&&(g=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)));b=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(e));a.nimservice().VerifySignedFile(g,0,c,d,b,function(b,c){if(0!=b)a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),f(b,null);else if(1==d){var e=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(c));f(b,e)}else f(b,a.usWebToolkit.util.decode64(c));a.uiUtil().loadingBox(!1,"us-div-list-load")})}}},RenewCertNSignedSubjectDn:function(b){function c(b,c,e,l,k,m,p,q){var r=!0;e!=a.CONST.__USFB_M_MOBILETOKEN.device&&(r=confirm(c));if(r){if(4<=a.ESVS.Mode)return a.nimservice()?(b=a.loadUI("certprocessing"),RenewingDialog=b({type:"CERT_RENEWAL",args:null,onConfirm:null,onCancel:null}),RenewingDialog.show(),a.nimservice().RenewCertificate(a.ESVS.CMPIP,a.ESVS.CMPPort,e,l,k,m,p,function(b,c){if(0==b)RenewingDialog.dispose(0,0,null,function(){d(0,q)});else if(c==a.uiUtil().getErrorMessageLang().IDS_NOALLOW_UPDATECERT){a.ERROR.Code=a.nimservice().GetLastErrorCode();a.ERROR.Message=a.nimservice().GetLastErrorMessage();var e=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(q.subjectName));a.nimservice().GetSignDataP7(k,p,0,e,!0,null,function(c,e,f){RenewingDialog.dispose(b,a.ERROR.Code,a.ERROR.Message,function(){d(b,q,f);a.uiUtil().loadingBox(!1,"us-div-list-load")})})}else a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),RenewingDialog.dispose(b,a.ERROR.Code,a.ERROR.Message,function(){d(b,q)})})):d(-1,"",""),!1;e=new Date(b);e.setHours(0);e.setMinutes(0);e.setSeconds(0);e.setDate(e.getDate()-90);l=new Date;l.setHours(0);l.setMinutes(0);l.setSeconds(0);l.getTime()>=e.getTime()?a.plugin().valid?(a.plugin().SetCAInfo(a.ESVS.CMPIP,a.ESVS.CMPPort),b=a.loadUI("certprocessing"),RenewingDialog=b({type:"CERT_RENEWAL",args:null,onConfirm:null,onCancel:null}),RenewingDialog.show(),setTimeout(function(){var b=a.plugin().UpdateCertificate();0!=b?(a.ERROR.Code=a.plugin().GetLastErrorCode(),a.ERROR.Message=a.plugin().GetLastErrorMessage(),RenewingDialog.dispose(b,a.ERROR.Code,a.ERROR.Message)):RenewingDialog.dispose(b,0,null);d(b);a.plugin().ClearAllUserCertList()},1E3)):d(-1,"",""):d(-1,e,b)}}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(b&&!document.getElementById("us-div-cert-select")){var d=b;a.reInitialize();var e=a.loadUI("certselect")({type:"CERT_RENEWAL_SIGN",args:{dn:null},onConfirm:function(d,g,h,l,k,m,p){e.dispose();a.CONST.__USFB_M_HSMKEY.device!=h&&a.CONST.__USFB_M_SMARTCARD.device!=h&&a.CONST.__USFB_M_MOBILETOKEN.device!=h?a.uiUtil().CheckPwdPattern(m)?c(d,g,h,l,k,m,m,p):(PWDialog=a.loadUI("newpassword")({type:null,args:{pw:m},onConfirm:function(a){PWDialog.dispose();c(d,g,h,l,k,a,m,p)},onCancel:function(){PWDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();b(a.ERROR.Code)}}),PWDialog.show()):c(d,g,h,l,k,m,m,p)},onCancel:function(){a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();e.dispose();a.uiUtil().getUserCancelErrCodeNMsg();d(a.ERROR.Code,"","")}});e.show();return!0}},SetOptions:function(b,c){a.options[b]=c},MakeTaxXMLDSIG:function(b,c,d){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b||!d||document.getElementById("us-div-cert-select"))return!1;a.reInitialize();var e=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7_XML",args:{dn:c},onConfirm:function(c,g,h,l,n,m){var p=null;if("undefined"!==typeof h&&"undefined"!==typeof l){if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!=n)if(a.nimservice()){var q,r,s,u;q=h;r=l;var x=0;"sha256WithRSAEncryption"!=g.signAlgo&&(x=1);var w=F({eval:!0,intergrity:!1,name:"xml_template_"+k.Language,url:"unisignweb/rsrc/lang/xml_template_"+k.Language+".js"});c=w.KEY_REPLACE+"\n";c+=b.substr(b.indexOf(w.KEY_START),b.length);var y=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c));a.nimservice().HashData(0,y,"sha256",function(c,f){0==c?(alert(f),s=w.XMLSignatureTemplate[x].replace("$$DV$$",f),u=w.XMLSignedInfoTemplate[x].replace("$$DV$$",f),y=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(u)),a.nimservice().GetSignDataP7(q,r,0,y,!0,null,function(c,f,g,h){0!=c?(a.ERROR.Code=c,a.ERROR.Message=f,d("")):(s=s.replace("$$Sign$$",g),s=s.replace("$$Cert$$",m),c=b.substr(0,b.indexOf(w.KEY_START)),c+=s,c+=b.substr(b.indexOf(w.KEY_START),b.length),d(c));a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){e.dispose()},10)})):(a.ERROR.Code=c,d(c,""))})}else d(""),setTimeout(function(){e.dispose()},10);else{try{var z=window.console||{log:function(){}};t&&(z.log("b64 cert : ",a.PFUC[h].signcert),z.log("b64 pri : ",a.PFUC[h].signpri));var A=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[h].signcert),C=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[h].signpri),D=a.usWebToolkit.pkcs7.createSignedData();D.sign(b,A,C,l,null,null);p=a.usWebToolkit.pkcs7.messageToBase64(D);d(p,n)}catch(E){a.ERROR.Code=E.code,a.ERROR.Message=E.message,a.uiUtil().errMsgBox(c,a.ERROR.Code),d("")}setTimeout(function(){e.dispose()},10)}h=l=A=C=null}else a.plugin().valid?((p=a.plugin().MakeSignedData(b))?d(p,n):(a.ERROR.Code=a.plugin().GetLastErrorCode(),a.ERROR.Message=a.plugin().GetLastErrorMessage(),a.uiUtil().errMsgBox(c,a.ERROR.Code),d("")),a.ESVS.Embedded||a.plugin().ClearAllUserCertList()):d(""),setTimeout(function(){e.dispose()},10)},onCancel:function(){1&a.ESVS.Mode&&a.plugin()&&a.plugin().valid&&a.plugin().ClearAllUserCertList();a.uiUtil().getUserCancelErrCodeNMsg();d("");e.dispose()}});e.show();return!0}}}}alert("Failed to initialize Unisign Core.")};