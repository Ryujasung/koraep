var __certview=function(a){var C=function(l){function v(a){if(!a)return alert("UI load error."),!1;var b=document.createElement("div");document.body.insertBefore(b,document.body.firstChild);b.innerHTML=a;return!0}function s(a){a=parseInt(a);var b=document.getElementById("us-view-simple"),c=document.getElementById("us-view-detail"),f=document.getElementById("us-view-certpath"),h=document.getElementById("us-view-cert-cps-btn"),g=document.getElementById("us-view-cert-confirm-btn"),e=document.getElementById("us-view-cls-img-btn");0===a?(b.style.display="block",c.style.display="none",f.style.display="none",h.style.display="inline",w.clearList(),h.setAttribute("tabindex",m+3,0),g.setAttribute("tabindex",m+4,0),e.setAttribute("tabindex",m+5,0)):1===a?(b.style.display="none",c.style.display="block",f.style.display="none",h.style.display="none",w.redrawList(B.list,B.list.length),h.removeAttribute("tabindex"),g.setAttribute("tabindex",m+4,0),e.setAttribute("tabindex",m+5,0)):2===a&&(b.style.display="none",c.style.display="none",f.style.display="block",h.style.display="none",g.setAttribute("tabindex",m+5,0),e.setAttribute("tabindex",m+6,0))}function p(a,b){var c=a||window.event,c=c.target||c.srcElement,f=b.getElementsByTagName("a"),h=document.getElementById("us-view-tab-simple"),g=document.getElementById("us-view-tab-detail"),e=document.getElementById("us-view-tab-certpath");for(n in f)if(c==f[n]){isNaN(n)&&("us-view-tab-simple"==n?n=0:"us-view-tab-detail"==n?n=1:"us-view-tab-certpath"==n&&(n=2));0==n?(h.className="us-view-tab-tag active",g.className="us-view-tab-tag",e.className="us-view-tab-tag"):1==n?(h.className="us-view-tab-tag",g.className="us-view-tab-tag active",e.className="us-view-tab-tag"):2==n&&(h.className="us-view-tab-tag",g.className="us-view-tab-tag",e.className="us-view-tab-tag active");s(n);break}}function u(d,b,c,f){var h=null;a.usWebToolkit.x509Certificate.parser(f,c);f=a.usWebToolkit.x509Certificate.getVersion();var h=a.usWebToolkit.x509Certificate.getSerialNumber(),g=a.usWebToolkit.x509Certificate.getSignAlgo(),e=a.usWebToolkit.x509Certificate.getIssuerName(),k=a.certUtil().getLocalDateNTime(a.usWebToolkit.x509Certificate.getNotBefore()),x=a.certUtil().getLocalDateNTime(a.usWebToolkit.x509Certificate.getNotAfter()),p=a.usWebToolkit.x509Certificate.getSubjectName(),z=a.usWebToolkit.x509Certificate.getPublickey(),l=a.usWebToolkit.x509Certificate.getAuthorityKeyIndentifier(),r=a.usWebToolkit.x509Certificate.getSubjectKeyIdentifier(),q=a.usWebToolkit.x509Certificate.getKeyUsage(),E=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),F=a.usWebToolkit.x509Certificate.getSubjectAltName(),G=a.usWebToolkit.x509Certificate.getAuthorityInfoAccess(),s=a.usWebToolkit.x509Certificate.getcRLDistributionPoints(),t="";try{t=a.usWebToolkit.x509Certificate.getCertificatePoliciesCPS()}catch(u){}var A="";try{A=a.usWebToolkit.x509Certificate.getCertificatePoliciesUserNotice()}catch(y){}var v=a.usWebToolkit.x509Certificate.getSignature();c=[];c[0]=f;c[1]=h;c[2]=g;c[3]=e;c[4]=k;c[5]=x;c[6]=p;c[7]=z;c[8]=l;c[9]=r;c[10]=q;c[11]=E;c[12]=F;c[13]=G;c[14]=s;c[15]=t;c[16]=A;c[17]=v;f=[];for(h=0;h<c.length;h++)g=[],g[0]=b[h].field,g[1]=c[h],f[h]=g;B=h={list:f};D=a.loadUI("gridlist");w=D({type:"detailslist",tblid:"us-view-tbl-list",tbltitleid:"us-view-tbl-list-th",titlelistid:"us-view-grid-head-div",titlerowid:"us-view-list-title-row",titleelementid:"us-view-list-title-element",titledividerid:null,titlelistcn:"us-layout-view-grid-head-div",titlerowcn:"us-layout-view-grid-head-row",titleelementcn:"us-layout-view-grid-row-title-element",titledividercn:null,tblbodyid:"us-view-tbl-list-td",datalistid:"us-view-grid-body-div",datarowid:"us-view-list-body-row",dataelementid:"us-view-list-data-element",datalistcn:"us-layout-view-grid-body-div",datarowcn:"us-layout-view-grid-body-row",dataelementcn:"us-layout-view-grid-row-data-element",dataselectcn:"us-layout-view-grid-row-data-selected-element",textboxid:"us-view-detail-text-box"});w.drawTitle(d,d.length,m+3,!1)}function t(d,b,c,f,h){if(!d||0>=b||!c||!f)return!1;var g=document.getElementById("us-view-cert-status-img"),e=document.getElementById("us-view-cert-status-msg"),k=-1,x=0,m=null;if(2==a.ESVS.Mode){b=null;try{var z=a.usWebToolkit.pki.createCaStore();b=a.PFSH.GetCACerts();for(var p in b)caCert=b[p],z.addCertificate(a.usWebToolkit.pki.certificateFromBase64(caCert));var l=a.usWebToolkit.pki.certificateFromBase64(c);a.usWebToolkit.pki.verifyCertificateChain(z,l,function(b,d,c){null!=g&&null!=e&&(!0===b?(k=0,g.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_valid.png",0),e.appendChild(document.createTextNode(f.IDS_CERT_STATUS_VALID)),r=!0):(k=-1,g.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_invalid.png",0),null!=c&&void 0!=c&&0<=c.indexOf("Certificate is not valid yet or has expired")?e.appendChild(document.createTextNode(f.IDS_CERT_STATUS_EXPIRED)):e.appendChild(document.createTextNode(c)),r=!1),h(k))})}catch(q){y.log("***** [Plugin Free] VerifyCertBasicAndChain exception *****"),x=q.code,m=q.message,y.log("e.code : ",q.code,"e.message : ",q.message,"e.detail : ",q.detail),a.uiUtil().errMsgBox(q.message,q.code)}}else 4&a.ESVS.Mode?a.nimservice()?a.nimservice().ValidateCertificate(b,function(b,c,d,k){null!=g&&null!=e&&(0==b?999==d?(g.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_valid.png",0),e.appendChild(document.createTextNode(f.IDS_CERT_STATUS_VALID)),r=!0):(g.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_invalid.png",0),e.appendChild(document.createTextNode(k)),r=!1):(g.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_invalid.png",0),e.appendChild(document.createTextNode(c)),r=!1),h(0))}):(a.uiUtil().msgBox(__lang.IDS_MSGBOX_NIM_ERROR_UNLOAD),rv=-1,h(-1)):a.plugin().valid?(y.log("*** [Plugin] Call VerifyCertBasicAndChain Func ***"),k=a.plugin().VerifyCertBasicAndChain(b),0!==k&&(y.log("*** [Plugin] VerifyCertBasicAndChain return error ***"),x=a.plugin().GetLastErrorCode(),m=a.plugin().GetLastErrorMessage(),y.log("Err Code : ",x,"\nErr Msg : ",m))):a.uiUtil().msgBox(f.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD);if(!(4&a.ESVS.Mode||2&a.ESVS.Mode))if(0===k)g.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_valid.png",0),e.appendChild(document.createTextNode(f.IDS_CERT_STATUS_VALID)),r=!0;else switch(r=!1,g.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_invalid.png",0),x){case 3005:e.appendChild(document.createTextNode(f.IDS_CERT_STATUS_EXPIRED));break;default:e.appendChild(document.createTextNode(f.IDS_CERT_STATUS_INVALID))}(function(){a.usWebToolkit.x509Certificate.parser(c,d);document.getElementById("us-view-cert-subject-name-data").appendChild(document.createTextNode(a.certUtil().getCN(a.usWebToolkit.x509Certificate.getSubjectName())));var b=document.getElementById("us-view-cert-issuer-name-data"),e=a.certUtil().getCN(a.usWebToolkit.x509Certificate.getIssuerName());if(""==e||"undefined"==e)e=a.certUtil().getO(a.usWebToolkit.x509Certificate.getIssuerName());b.appendChild(document.createTextNode(e));document.getElementById("us-view-cert-validity-date-from").appendChild(document.createTextNode(a.certUtil().getLocalDate(a.usWebToolkit.x509Certificate.getNotBefore())));document.getElementById("us-view-cert-validity-date-to").appendChild(document.createTextNode(a.certUtil().getLocalDate(a.usWebToolkit.x509Certificate.getNotAfter())));b=document.getElementById("us-view-cert-purpose");e=null;try{e=a.usWebToolkit.x509Certificate.getCertificatePoliciesUserNotice()}catch(f){}null!=e&&b.appendChild(document.createTextNode(e));document.getElementById("us-view-cert-cps-btn").onclick=function(){var b=a.usWebToolkit.x509Certificate.getCertificatePoliciesCPS();"firefox"==a.browserName?window.open(b,"cps_url","scrollbars=1"):window.open(b);this.focus()}})();return!0}function A(a){if(null==a||0==a.length)return"";for(var b=a.length,c="",f=0,h=b;f<b;f++,h--)0==h%4&&h!=b&&(c+=" "),c+=a.charAt(f);return c.toUpperCase()}function C(d,b,c,f,h){function g(a,b){var c=document.getElementById(a);c&&c.appendChild(document.createTextNode(b))}function e(a,b){var c=document.createElement("li");!0==a?c.setAttribute("class","valid"):!1==a?c.setAttribute("class","invalid"):null!=a?c.setAttribute("class",a):c.appendChild(document.createTextNode(b));return c}if(4&a.ESVS.Mode)if(a.nimservice()){var k=document.getElementById("us-view-certpath-info-tree");a.nimservice().GetCACertificates(b,function(b,m,p){if(null!=k){if(0==b)try{var l=a.usWebToolkit.md.sha256.create();l.start();l.update(a.usWebToolkit.util.decode64(p));var t=l.digest().toHex();a.usWebToolkit.x509Certificate.parser(p,d);k.appendChild(e(!0));k.appendChild(e(null,a.usWebToolkit.x509Certificate.getSubjectName()));g("us-view-certpath-version",f.IDS_CERT_PATH_ROOTCA_VERSION);g("us-view-certpath-version-data",a.usWebToolkit.x509Certificate.getVersion());g("us-view-certpath-date",f.IDS_CERT_PATH_ROOTCA_VALIDDATE);g("us-view-certpath-date-from",a.certUtil().getLocalDateNTime(a.usWebToolkit.x509Certificate.getNotBefore()));g("us-view-certpath-date-to",a.certUtil().getLocalDateNTime(a.usWebToolkit.x509Certificate.getNotAfter()));a.usWebToolkit.x509Certificate.parser(m,d);k.appendChild(e("dot"));k.appendChild(e(!0));k.appendChild(e(null,a.usWebToolkit.x509Certificate.getSubjectName()));a.usWebToolkit.x509Certificate.parser(c,d);k.appendChild(e("dot2"));k.appendChild(e(r));k.appendChild(e(null,a.usWebToolkit.x509Certificate.getSubjectName()));var q=A(t);if(null==q||0==q.length)q="  ";g("us-view-certpath-hash",f.IDS_CERT_PATH_NOTICE);g("us-view-certpath-hash-data",q);g("us-view-certpath-tail",f.IDS_CERT_PATH_ROOTHASH_URL);g("us-view-certpath-tail",f.IDS_CERT_PATH_ROOTHASH_URL2);g("us-view-certpath-tail",f.IDS_CERT_PATH_ROOTHASH_URL3);document.getElementById("us-view-certpath-tail").onclick=function(){window.open(f.IDS_CERT_PATH_ROOTHASH_LINK,"ca_hash","scrollbars=1;width=650;height=460;")}}catch(s){a.usWebToolkit.x509Certificate.parser(c,d),k&&k.appendChild(e(r)),k&&k.appendChild(e(null,a.usWebToolkit.x509Certificate.getSubjectName()))}else a.usWebToolkit.x509Certificate.parser(c,d),k&&k.appendChild(e(r)),k&&k.appendChild(e(null,a.usWebToolkit.x509Certificate.getSubjectName()));h()}})}else a.uiUtil().msgBox(f.IDS_MSGBOX_NIM_ERROR_UNLOAD)}var H=function(){var d;d=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");d.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/layout/certview.html?version="+a.ver,!1);d.send(null);return d.responseText},I=function(){var d;d=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");d.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/certview_"+a.ESVS.Language+".js?version="+a.ver,!1);d.send(null);return d.responseText},D=null,w=null,B=null,r=!0,m=a.ESVS.TabIndex,y=window.console||{log:function(){}};return function(){var d=eval(H),b=eval(eval(I)()),c=l.args.type,f=l.args.idx,h=l.args.cert;v(d());var g=document.getElementById("us-view-lbl-title");g.appendChild(document.createTextNode(b.IDS_CERT_VIEW));g.setAttribute("tabindex",m,0);d=document.getElementById("us-view-tab");d.onclick=function(a){p(a?a:event,this)};d.onkeydown=function(a){if((a=a?a:event)&&this){var b=a||window.event;13==(b.which||b.keyCode)&&p(a,this)}};d=document.getElementById("us-view-tab-simple");d.setAttribute("tabindex",m+1,0);d.appendChild(document.createTextNode(b.IDS_CERT_SIMPLE_VIEW));document.getElementById("us-view-simple").setAttribute("tabindex",m+2,0);d=document.getElementById("us-view-tab-detail");d.appendChild(document.createTextNode(b.IDS_CERT_DETAIL_VIEW));d.setAttribute("tabindex",m+3,0);d=document.getElementById("us-view-tab-certpath");d.appendChild(document.createTextNode(b.IDS_CERT_PATH_VIEW));d.setAttribute("tabindex",m+4,0);document.getElementById("us-view-cert-info").appendChild(document.createTextNode(b.IDS_CERT_INFO));document.getElementById("us-view-cert-subject-name").appendChild(document.createTextNode(b.IDS_CERT_SUBJECT_NAME));document.getElementById("us-view-cert-issuer-name").appendChild(document.createTextNode(b.IDS_CERT_ISSUER_NAME));document.getElementById("us-view-cert-validity-date").appendChild(document.createTextNode(b.IDS_CERT_VALIDITY_DATE));d=document.getElementById("us-view-cert-cps-btn");d.setAttribute("value",b.IDS_CERT_SUPPLEMENT_INFO,0);d.setAttribute("title",b.IDS_CERT_SUPPLEMENT_INFO+b.IDS_BUTTON,0);d.style.display="none";d=document.getElementById("us-view-cert-confirm-btn");d.setAttribute("value",b.IDS_CERT_CONFIRM,0);d.setAttribute("title",b.IDS_CERT_CONFIRM+b.IDS_BUTTON,0);d.onclick=function(){w.restoreOnMouseEvent();l.onCancel()};d=document.getElementById("us-view-cls-img-btn");d.setAttribute("title",b.IDS_CERT_VIEW_CLOSE,0);d.onclick=function(){w.restoreOnMouseEvent();l.onCancel()};d.onfocus=function(){g.focus()};document.getElementById("us-view-cls-btn-img").setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/x-btn.png",0);u([{title:b.IDS_CERT_FIELD},{title:b.IDS_CERT_VALUE}],[{field:b.IDS_CERT_VERSION},{field:b.IDS_CERT_SERIAL_NUMBER},{field:b.IDS_CERT_SIGN_ALGOLISM},{field:b.IDS_CERT_ISSUER},{field:b.IDS_CERT_VALIDATE_FROM},{field:b.IDS_CERT_VALIDATE_TO},{field:b.IDS_CERT_SUBJECT},{field:b.IDS_CERT_PUBLIC_KEY},{field:b.IDS_CERT_AUTHORITY_KEY_IDENTIFIER},{field:b.IDS_CERT_SUBJECT_KEY_IDENTIFIER},{field:b.IDS_CERT_KEY_USAGE},{field:b.IDS_CERT_POLICY},{field:b.IDS_CERT_SUBJECT_ALT_NAME},{field:b.IDS_CERT_AUTHORITY_INFO_ACCESS},{field:b.IDS_CERT_CRL_DISTRIBUTE_POINTS},{field:b.IDS_CERT_CPS},{field:b.IDS_CERT_PURPOSE},{field:b.IDS_CERT_SIGNATURE}],c,h);4&a.ESVS.Mode?t(c,f,h,b,function(a){C(c,f,h,b,function(a){})}):2&a.ESVS.Mode?t(c,f,h,b,function(a){document.getElementById("us-view-tab3").style.display="none"}):(t(c,f,h,b),document.getElementById("us-view-tab3").style.display="none");s(0);return document.getElementById("us-div-cert-view")}()};return function(l){var v=a.uiLayerLevel,s=a.uiUtil().getOverlay(v),p=C({type:l.type,args:l.args,onConfirm:l.onConfirm,onCancel:l.onCancel});p.style.zIndex=v+1;a.ESVS.TargetObj.insertBefore(s,a.ESVS.TargetObj.firstChild);var u=window.onresize;return{show:function(){draggable(p,document.getElementById("us-div-view-title"));s.style.display="block";a.uiUtil().offsetResize(p);window.onresize=function(){a.uiUtil().offsetResize(p);u&&u()};a.uiLayerLevel+=10;a.ESVS.TabIndex+=30;setTimeout(function(){var a=p.getElementsByTagName("p");if(0<a.length)for(var l=0;l<a.length;l++)"us-view-lbl-title"==a[l].id&&a[l].focus()},10)},hide:function(){s.style.display="none";p.style.display="none"},dispose:function(){window.onresize=function(){u&&u()};p.parentNode.parentNode.removeChild(p.parentNode);s.parentNode.removeChild(s);a.uiLayerLevel-=10;a.ESVS.TabIndex-=30}}}};