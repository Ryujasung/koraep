var __certmanage=function(a){var N=function(q){function w(){if(!a.certsList)return null;for(var c=null,c=a.certsList,b=c.list.length,e=[],d=0;d<b;d++){a.usWebToolkit.x509Certificate.parser(c.list[d].cert,"Base64");var f=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),l=a.usWebToolkit.x509Certificate.getSubjectName(),h=a.usWebToolkit.x509Certificate.getNotAfter(),k=a.usWebToolkit.x509Certificate.getNotAfter(),m=c.list[d].index,s=a.certUtil().getIssuerName(f);"undefined"==s&&(s=a.certUtil().getO(l));var z=[""];z[1]=a.certUtil().getCertType(f);z[2]=a.certUtil().getCN(l);z[3]=s;z[4]=a.certUtil().getLocalDate(h);z[5]=m;z[6]=a.certUtil().getExpirationStateValue(k);e.push(z)}return c={list:e}}function t(c,b,e,d,f,l,h){function k(){var a=w();"draw"==c?a?g.drawList(l,l.length,a.list,a.list.length,J,h):g.drawList(l,l.length,null,0,J,h):"redraw"==c&&(a?g.redrawList(a.list,a.list.length):g.redrawList(null,0))}if(a.CONST.__USFB_M_DISK.device>b||0>e||!d)return-1;var m=0;r=e;a.certsList&&(a.certsList=null);a.nimservice()?a.nimservice().GetAllMediaList(0,function(c,d){0==c?a.nimservice().GetAllUserCertListNum(b,e,"",a.ESVS.Policy,function(c,d){m=d;if(0==c)0<m?a.nimservice().GetAllUserCert(d,function(c,b){0==c?a.certsList={list:b}:a.uiUtil().errMsgBox(a.nimservice().GetLastErrorMessage(),c);k()}):(k(),a.uiUtil().loadingBox(!1,"us-div-list-load"));else{if(b==a.CONST.__USFB_M_MOBILE.device&&(11003==c||11004==c))return document.getElementById("us-cert-manage-cls-btn").click(),"firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"),!1;if(-1===m)c=-1;else{var e=a.nimservice().GetLastErrorCode(),f=a.nimservice().GetLastErrorMessage();p.log("***** GetCerts *****");p.log("Err Code : ",e,"\nErr Msg : ",f);a.uiUtil().errMsgBox(f,c);c=e}k();done=1;a.uiUtil().loadingBox(!1,"us-div-list-load")}}):(c=-1,k(),done=1,a.uiUtil().loadingBox(!1,"us-div-list-load"))}):a.uiUtil().msgBox(__text.IDS_MSGBOX_NIM_ERROR_UNLOAD)}function u(c,b,e,d){if(a.CONST.__USFB_M_DISK.device>c||0>b||!e)return-1;var f=0,l=0;r=b;a.certsList&&(a.certsList=null);if(a.CONST.__PF_M_LS.device===c){if(!a.PFSH)return-1;try{a.PFSH.SelectStorage(1)}catch(h){p.log("***** Plugin Free SelectStorage error *****"),p.log("e.code : ",h.code,"e.message : ",h.message,"e.detail : ",h.detail)}try{a.PFSH.LoadAllCerts(document.domain)}catch(k){301E5===k.code?(a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain)):(p.log("***** Plugin Free LoadAllCerts error *****"),p.log("e.code : ",k.code,"e.message : ",k.message,"e.detail : ",k.detail))}c=null;try{c=a.PFSH.GetUserCerts(document.domain),a.PFUC=c}catch(m){p.log("***** Plugin Free GetCerts error *****"),p.log("e.code : ",m.code,"e.message : ",m.message,"e.detail : ",m.detail),a.uiUtil().errMsgBox(m.message,m.code)}null!=c&&void 0!=c&&void 0!=c.length&&(f=c.length-1);p.log("***** Plugin Free *****");p.log("user certificate counts : ",f);if(0<f){b=[];for(e=0;e<f;e++){d=e+1;var g={};g.index=d;g.cert=c[d].signcert;b[e]=g}a.certsList={list:b}}else a.certsList=null,l=0}else if(a.CONST.__PF_M_LS.device!==c&&1&a.ESVS.Mode)if(a.plugin().valid)if("GPKI"==a.ESVS.PKI?a.plugin().SetGPKI():a.ESVS.PKI&&"NPKI"!=a.ESVS.PKI&&a.plugin().SetPCA(a.ESVS.PKI),f=a.CONST.__USFB_M_SMARTCARD.device===c?a.plugin().GetAllUserCertListNum(c,b,d):a.plugin().GetAllUserCertListNum(c,b,""),0<f){b=[];for(e=0;e<f;e++)d=e+1,g={},g.index=d,g.cert=a.plugin().GetUserSignCertFromCertList(d),b[e]=g;a.certsList={list:b}}else 0===f?l=0:(f=a.plugin().GetLastErrorCode(),l=a.plugin().GetLastErrorMessage(),p.log("***** GetCerts *****"),p.log("Err Code : ",f,"\nErr Msg : ",l),l=f),a.certsList=null;else return a.uiUtil().msgBox(e.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD),-1;return l}function D(c,b){if(!c||!b)return!1;if(!a.certsList)return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var e=a.loadUI("certview")({type:null,args:{type:"Base64",idx:parseInt(g.selectedIndex()),cert:a.certsList.list[parseInt(g.selectedIndex())-1].cert},onConfirm:function(){e.dispose();c.focus()},onCancel:function(){e.dispose();c.focus()}});e.show();a.uiUtil().loadingBox(!1,"us-div-list-load");return!0}function O(c,b){if(!c||!b)return!1;if(!a.certsList)return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;a.uiUtil().loadingBox(!0,"us-div-list-load",5);Dialog=a.loadUI("storageselect")({type:"CERT_COPY",args:{sourceDevice:n,sourceDrive:r},onConfirm:function(c,d){Dialog.dispose();if(a.nimservice())a.nimservice().CopyCert(n,r,c,d,g.selectedIndex(),!1,function(c,d){0==c?a.uiUtil().msgBox(b.IDS_MSGBOX_CERT_COPY_SUCCESS):a.uiUtil().errMsgBox(d,c);a.uiUtil().loadingBox(!1,"us-div-list-load")});else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),a.uiUtil().loadingBox(!1,"us-div-list-load"),!1},onCancel:function(){Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");c.focus()}});Dialog.show();return!0}function P(c,b){if(!c||!b)return!1;if(!a.certsList)return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;4<=a.ESVS.Mode?a.nimservice()?a.nimservice().ChangePassword(n,r,parseInt(g.selectedIndex()),function(c,d){0==c?(t("redraw",n,r,b,""),a.uiUtil().msgBox(b.IDS_MSGBOX_CERT_CHANGE_PW_SUCCESS)):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().errMsgBox(d,c))}):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD)):(Dialog=a.loadUI("changepassword")({type:null,args:null,onConfirm:function(e,d){if(null==e||0>=e.length||null==d||0>=d.length)return a.uiUtil().msgBox(b.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),!1;var f=parseInt(g.selectedIndex());if(1>f)return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;if(a.CONST.__PF_M_LS.device===n)try{var l=a.PFUC[f],h,k;h=k=null;var m=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(l.signpri),s=a.usWebToolkit.pkcs8.checkUserCertPassword(m,e);if(!1===s){var m=null,z={code:-1,message:b.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD};throw z;}h=a.usWebToolkit.pkcs8.changePassword(m,e,d,"Base64");m=null;if("undefined"!==typeof l.kmcert){m=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(l.kmpri);s=a.usWebToolkit.pkcs8.checkUserCertPassword(m,e);if(!1===s)throw m=null,z={code:-1,message:b.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD},z;k=a.usWebToolkit.pkcs8.changePassword(m,e,d,"Base64")}m=null;try{f={};f.signcert=l.signcert;f.signpri=h;null!==k&&(f.kmcert=l.kmcert,f.kmpri=k);a.PFSH.SaveUserCert(l.ca,f,document.domain,!1);l=f=null;u(n,r,b,"");var L=w();L?g.redrawList(L.list,L.list.length):g.redrawList(null,0);a.uiUtil().msgBox(b.IDS_MSGBOX_CERT_CHANGE_PW_SUCCESS)}catch(y){switch(p.log("***** SANDBOX.PFSH.SaveUserCert *****"),p.log("e.code : ",y.code,"e.message : ",y.message,"e.detail : ",y.detail),y.code){case 1E7:0<=y.detail.indexOf("115010")?a.uiUtil().msgBox(b.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(b.IDS_MSGBOX_CERT_CHANGE_PW_ERROR,y.detail);break;default:a.uiUtil().errMsgBox(b.IDS_MSGBOX_CERT_CHANGE_PW_ERROR,y.code);break}}finally{}}catch(K){p.log("***** ChangePW error *****"),p.log("Err Code : ",K.code,"\nErr Msg : ",K.message),a.uiUtil().errMsgBox(K.message,K.code)}finally{}else a.plugin().valid?(l=a.plugin().CheckUserCertPassword(f,e),0===l?(l=a.plugin().ChangeUserCertPassword(f,e,d),0===l?a.uiUtil().msgBox(b.IDS_MSGBOX_CERT_CHANGE_PW_SUCCESS):(f=a.plugin().GetLastErrorCode(),a.uiUtil().errMsgBox(b.IDS_MSGBOX_CERT_CHANGE_PW_ERROR,f))):a.uiUtil().msgBox(b.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD)):a.uiUtil().msgBox(b.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD);e=d="";Dialog.dispose();setTimeout(function(){c.focus()},10)},onCancel:function(){Dialog.dispose();setTimeout(function(){c.focus()},10)}}),Dialog.show());return!0}function Q(c,b){function e(c,b){if(1>c||null==b||0>=b.length)return!1;if(a.CONST.__PF_M_LS.device===n)try{a.PFSH.DeleteUserCertByIndex(c,document.domain)}catch(e){return p.log("***** Plugin Free DeleteToDevice error *****"),p.log("e.code : ",e.code,"e.message : ",e.message,"e.detail : ",e.detail),a.uiUtil().errMsgBox(d.IDS_MSGBOX_CERT_DELETE_ERROR,e.code),!1}finally{}else{var f=a.plugin().DeleteCert(c,b);if(0!==f){switch(f){case 4823E4:a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SEC_TOKEN_PIN);break;case 4825E4:a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_SEC_TOKEN_PIN_LOCKED);break;case 49000004:a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 49000005:a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;default:f=a.plugin().GetLastErrorCode(),a.uiUtil().errMsgBox(d.IDS_MSGBOX_CERT_DELETE_ERROR,f)}return!1}}a.certsList&&(a.certsList=null);u(n,r,d,"");(f=w())?g.redrawList(f.list,f.list.length):g.redrawList(null,0);a.uiUtil().msgBox(d.IDS_MSGBOX_CERT_DELETE_SUCCESS);return!0}if(!c||!b)return!1;var d=b;if(!a.certsList)return a.uiUtil().msgBox(d.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;if(confirm(d.IDS_CONFIRMBOX_WARNING_DELETE_CERT))if(4<=a.ESVS.Mode)a.nimservice()?a.nimservice().DeleteCertificate(n,r,parseInt(g.selectedIndex()),function(c,b){0==c?(t("redraw",n,r,d,""),a.uiUtil().msgBox(d.IDS_MSGBOX_CERT_DELETE_SUCCESS)):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().errMsgBox(b,c))}):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(d.IDS_MSGBOX_NIM_ERROR_UNLOAD));else{var f=null,f=a.CONST.__USFB_M_HSMKEY.device===n?a.loadUI("pin"):a.loadUI("password");Dialog=f({type:null,args:null,onConfirm:function(b){var f=parseInt(g.selectedIndex());if(1&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==n)if(a.plugin().valid){var k=0;a.CONST.__USFB_M_HSMKEY.device!==n&&(k=a.plugin().CheckUserCertPassword(f,b));0===k?e(f,b):a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD)}else a.uiUtil().msgBox(d.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD);else{if(!a.PFUC)return b="",p.log("[error] SANDBOX.PFUC is null"),!1;try{var k=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[f].signpri),m=a.usWebToolkit.pkcs8.checkUserCertPassword(k,b),k="";!1===m?a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD):e(f,b)}catch(s){p.log("***** CheckUserCertPassword error *****"),p.log("Err Code : ",s.code,"\nErr Msg : ",s.message),a.uiUtil().errMsgBox(s.message,s.code)}finally{}}b="";Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){c.focus()},10)},onCancel:function(){Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){c.focus()},10)}});Dialog.show()}else setTimeout(function(){c.focus()},10);return!0}function R(c,b){if(null==c||0>=c.length||null==b)return!1;if(0<c.length&&-1<c.indexOf(".")){var e=c.split("."),e=e[e.length-1].toLowerCase();if("pfx"!=e&&"p12"!=e)return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_NOT_PFX),!1}else return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1;return!0}function S(c){if(null==c)return!1;if(4<=a.ESVS.Mode)a.nimservice()?(SSDialog=a.loadUI("storageselect")({type:"CERT_IMPORT",args:null,onConfirm:function(b,d){SSDialog.dispose();a.nimservice().ImportCert(b,d,function(e,k){if(0==e){if(n==b&&r==d)t("redraw",n,r,c,"");else{var m=w();m?g.redrawList(m.list,m.list.length):g.redrawList(null,0)}a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_IMPORT_SUCCESS)}else a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().errMsgBox(k,e)})},onCancel:function(){a.uiUtil().loadingBox(!1,"us-div-list-load");SSDialog.dispose()}}),SSDialog.show()):a.uiUtil().msgBox(c.IDS_MSGBOX_NIM_ERROR_UNLOAD);else if(a.uiUtil().isItPortableDevice())a.uiUtil().ImportFromBackupStore();else{var b=document.getElementById("us-cert-manage-file-search-hidden");if("safari"==a.browserName&&6>parseFloat(a.browserVersion))return a.uiUtil().msgBox(c.IDS_MSGBOX_SEARCH_CERT_GUIDE_FOR_SAFARI),!1;if("opera"==a.browserName||"safari"==a.browserName||"msie"==a.browserName&&8===parseInt(a.browserVersion))b.style.display="block";b.value="";if(""!=b.value){var e=b.onchange,d=b.parentNode;d.removeChild(b);b=document.createElement("input");b.setAttribute("type","file",0);b.setAttribute("accept","application/x-pkcs12",0);b.setAttribute("id","us-cert-manage-file-search-hidden",0);b.className="us-layout-cert-manage-file-search-hidden";b.onchange=e;d.appendChild(b)}b.click()}return!0}function N(c,b){function e(c,b,e,f){if(0===c)a.uiUtil().msgBox(d.IDS_MSGBOX_CERT_IMPORT_SUCCESS),n===b&&r===e&&(a.CONST.__USFB_M_SMARTCARD.device===n&&0===r?u(n,r,d,f):u(n,r,d,""),(c=w())?g.redrawList(c.list,c.list.length):g.redrawList(null,0));else switch(c){case 4823E4:a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SEC_TOKEN_PIN);break;case 4825E4:a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_SEC_TOKEN_PIN_LOCKED);break;case 4843E4:a.uiUtil().msgBox(d.IDS_MSGBOX_HSM_ERROR_CERT_ALREADY_EXISTS);break;case 4844E4:a.uiUtil().msgBox(d.IDS_MSGBOX_HSM_ERROR_MEMORY_TOO_SMALL);break;case 4846E4:a.uiUtil().msgBox(d.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_KEY_LENGTH);break;case 49000004:a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 49000005:a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;case 4123E4:c=a.plugin().GetLastErrorMessage();c=a.certUtil().getLocalDate(c);p.log("latestCertExpLocalDate : ",c);c=d.IDS_MSGBOX_CERT_COPY_ERROR_NEWEST_CERT+"\n\n"+d.IDS_NEWEST_CERT_EXPIRATION_DATE+c;a.uiUtil().msgBox(c);break;default:switch(e=0,e=a.CONST.__PF_M_LS.device===b?c:a.plugin().GetLastErrorCode(),e){case 3509:a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);break;default:a.uiUtil().errMsgBox(d.IDS_MSGBOX_CERT_IMPORT_ERROR,e)}}}if(!c||!b)return!1;var d=b,f=null,l=null,h=document.getElementById("us-cert-manage-get-cert-btn");if("opera"==a.browserName||"safari"==a.browserName)c.style.display="none";if(window.FileReader){var k=c.files;if(0<k.length){var m=k[0];if(!0==R(m.name,d)){var s=new FileReader;s.readAsBinaryString?(s.readAsBinaryString(m),s.addEventListener("load",function(){var c=s.result,b=c.length;if(m.size===b)l=a.usWebToolkit.util.encode64(c,b);else return a.uiUtil().msgBox(d.IDS_MSGBOX_FILE_ERROR_READ),!1})):(s.readAsArrayBuffer(m),s.addEventListener("load",function(){var c=s.result,b=null;try{var e=String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(c)));try{b=decodeURIComponent(escape(e))}catch(f){if(f instanceof URIError)b=e;else throw f;}}catch(h){return a.uiUtil().msgBox(d.IDS_MSGBOX_FILE_ERROR_READ),!1}c=b.length;if(m.size===c)l=a.usWebToolkit.util.encode64(b,c);else return a.uiUtil().msgBox(d.IDS_MSGBOX_FILE_ERROR_READ),!1}))}else return setTimeout(function(){h.focus()},10),!1}else return setTimeout(function(){h.focus()},10),!1}else{if("msie"==a.browserName&&8===parseInt(a.browserVersion))k=document.getElementById("us-div-cert-manage"),k.onselectstart=function(){return!0},c.select(),f=document.selection.createRange().text,c.style.display="none",k.onselectstart=function(){return!1};else if("msie"==a.browserName&&9===parseInt(a.browserVersion)){if(f=c.value,-1<f.indexOf("fakepath"))return a.uiUtil().msgBox(d.IDS_MSGBOX_SEARCH_CERT_GUIDE_FOR_IE9),setTimeout(function(){h.focus()},10),!1}else f=c.value,p.log("file full path : ",f);if(!1==R(f,d))return setTimeout(function(){h.focus()},10),!1}Dialog=a.loadUI("password")({type:null,args:null,onConfirm:function(c){Dialog.dispose();SSDialog=a.loadUI("storageselect")({type:"CERT_IMPORT",args:null,onConfirm:function(b,m){if(a.CONST.__USFB_M_HSMKEY.device===b||a.CONST.__USFB_M_SMARTCARD.device===b){SSDialog.dispose();var g=null,g=a.CONST.__USFB_M_SMARTCARD.device===b?"PIN_SAVE_TOKEN":"PIN_SECURITY_TOKEN";PINDialog=a.loadUI("pin")({type:g,args:null,onConfirm:function(g){if(a.plugin().valid){var k=0,k=null!=f?a.plugin().ImportPfxCert_HSM(f,c,b,m,g):a.plugin().ImportPfxCertString_HSM(l,c,b,m,g);e(k,b,m,g)}else a.uiUtil().msgBox(d.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD);c=g="";PINDialog.dispose();setTimeout(function(){h.focus()},10)},onCancel:function(){c="";PINDialog.dispose();setTimeout(function(){h.focus()},10)}});PINDialog.show()}else{if(a.CONST.__PF_M_LS.device===b){if(!a.PFSH)return a.uiUtil().msgBox("unsupport html5 storage"),!1;g=0;try{var k=a.PFSH.SetP12OnMemory(l,c),n=k.aluc[k.index];a.usWebToolkit.x509Certificate.parser(n.signcert,"Base64");var s=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),r=a.certUtil().getIssuerEnName(s);a.PFSH.SaveUserCert(r,n,document.domain,!0)}catch(q){switch(p.log("***** SANDBOX.PFSH.SaveUserCert *****"),p.log("e.code : ",q.code,"e.message : ",q.message,"e.detail : ",q.detail),g=q.code,q.code){case 1E7:0<=q.detail.indexOf("115010")?a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(d.IDS_MSGBOX_CERT_IMPORT_ERROR,q.detail);break;default:a.uiUtil().errMsgBox(d.IDS_MSGBOX_CERT_IMPORT_ERROR,q.code)}}e(g,b,m,"")}else a.plugin().valid?(g=0,g=null!=f?a.plugin().ImportPfxCert(f,c,b,m):a.plugin().ImportPfxCertString(l,c,b,m),e(g,b,m,"")):a.uiUtil().msgBox(d.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD);c="";SSDialog.dispose();setTimeout(function(){h.focus()},10)}},onCancel:function(){c="";SSDialog.dispose();setTimeout(function(){h.focus()},10)}});SSDialog.show()},onCancel:function(){Dialog.dispose();setTimeout(function(){h.focus()},10)}});Dialog.show();return!0}function T(c,b){if(!c||!b)return!1;if(!a.certsList)return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var e=null,d=document.getElementById("us-cert-manage-put-cert-out-btn");4==a.ESVS.Mode||6==a.ESVS.Mode?a.nimservice()&&null!=a.nimservice()?a.nimservice().ExportCert(n,r,parseInt(g.selectedIndex()),"0",function(c,d){0==c?a.uiUtil().msgBox(b.IDS_MSGBOX_CERT_EXPORT_SUCCESS):a.uiUtil().errMsgBox(d,c);a.uiUtil().loadingBox(!1,"us-div-list-load")}):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD)):2&a.ESVS.Mode?(Dialog=a.loadUI("password")({type:null,args:null,onConfirm:function(c){var l=parseInt(g.selectedIndex());if(1&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==n)if(a.plugin().valid)if(0===a.plugin().CheckUserCertPassword(l,c))if((e=a.plugin().ExportPfxCertToTmpfile(l,c))&&0<e.length)a.uiUtil().msgBox(b.IDS_MSGBOX_CERT_EXPORT_SUCCESS+"\n\n"+e);else switch(c=a.plugin().GetLastErrorCode(),c){case 4013E4:a.uiUtil().msgBox(b.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_LOW_PERFORM_MEDIA);break;default:a.uiUtil().errMsgBox(b.IDS_MSGBOX_CERT_EXPORT_ERROR,c)}else a.uiUtil().msgBox(b.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);else a.uiUtil().msgBox(b.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD);else{if(!a.PFUC)return c="",p.log("[error] SANDBOX.PFUC is null"),!1;try{var h=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[l].signpri),k=a.usWebToolkit.pkcs8.checkUserCertPassword(h,c),h="";p.log("ExportPFX : bRv=",k);if(!1===k)a.uiUtil().msgBox(b.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);else if(a.uiUtil().isItPortableDevice()){var m=a.PFSH.GetP12ForBuToMo(l,"hex");p.log("ExportPFX To Mobile : jsonRv.key=",m.key);p.log("ExportPFX To Mobile : jsonRv.p12=",m.p12);a.uiUtil().ExportToBackupStore(m.p12,m.key);m=null}else{var m=a.PFSH.GetP12ForBuToPc(l,c),s=m.p12,q=m.dn,r=a.certUtil().getCN(q)+".p12";p.log("ExportPFX : fileName=",r);a.fileUtil().save(r,s);s=q=m=null}}catch(y){p.log("***** CheckUserCertPassword error *****"),p.log("Err Code : ",y.code,"\nErr Msg : ",y.message),a.uiUtil().errMsgBox(y.message,y.code)}finally{}}c="";Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){d.focus()},10)},onCancel:function(){Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){d.focus()},10)}}),Dialog.show()):a.uiUtil().msgBox(b.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD);return!0}function aa(c){if(!c)return!1;var b=a.loadUI("swinfo")({type:null,args:null,onConfirm:function(){b.dispose();setTimeout(function(){c.focus()},10)},onCancel:function(){b.dispose();setTimeout(function(){c.focus()},10)}});b.show();return!0}function E(){var a=document.getElementById("us-cert-manage-cert-copy-btn");a.readOnly=!1;a.disabled=!1}function U(){var a=document.getElementById("us-cert-manage-cert-copy-btn");a.readOnly=!0;a.disabled=!0}function F(){var a=document.getElementById("us-cert-manage-pw-change-btn");a.readOnly=!1;a.disabled=!1}function V(){var a=document.getElementById("us-cert-manage-pw-change-btn");a.readOnly=!0;a.disabled=!0}function B(){var a=document.getElementById("us-cert-manage-put-cert-out-btn");a.readOnly=!1;a.disabled=!1}function W(){var a=document.getElementById("us-cert-manage-put-cert-out-btn");a.readOnly=!0;a.disabled=!0}function G(){var a=document.getElementById("us-cert-manage-cert-delete-btn");a.readOnly=!1;a.disabled=!1}function C(c){c==a.CONST.__PF_M_LS.device?(U(),F(),a.uiUtil().isItSupportingPFCertBackUp()?B():W()):c==a.CONST.__USFB_M_HDD.device?(E(),F(),B(),G()):c==a.CONST.__USFB_M_DISK.device?(E(),F(),B(),G()):c==a.CONST.__USFB_M_HSMKEY.device?(U(),V(),W(),G()):c==a.CONST.__USFB_M_SMARTCARD.device?(E(),F(),B(),G()):c==a.CONST.__USFB_M_MOBILE.device?(E(),V(),B(),c=document.getElementById("us-cert-manage-cert-delete-btn"),c.readOnly=!0,c.disabled=!0):(E(),F(),B(),G())}function M(c,b,e,d){if(a.CONST.__USFB_M_DISK.device>c||!b||!e||!d)return!1;var f=a.loadUI("driveselect")({type:"DEVICE_REMOVABLE_DISK",args:b,onConfirm:function(b){0<b&&(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==n?t("redraw",c,b,d,""):(b=u(c,b,d,""),0!=b?(a.uiUtil().errMsgBox(d.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b),g.redrawList(null,0)):(b=w())?g.redrawList(b.list,b.list.length):g.redrawList(null,0)));a.ESVS.Embedded?setTimeout(function(){f.dispose()},10):f.dispose();setTimeout(function(){e.focus()},10)},onCancel:function(){a.uiUtil().loadingBox(!1,"us-div-list-load");f.dispose();setTimeout(function(){e.focus()},10)}});f.show();return!0}function X(c,b,e,d){if(a.CONST.__USFB_M_DISK.device>c||!b||!e||!d)return!1;var f=a.loadUI("sectokenselect")({type:c,args:b,onConfirm:function(b){if(0<b)if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==n)t("redraw",c,b,d,"");else if(b=u(c,b,d,""),0!=b){switch(b){case 4812E4:case 4813E4:a.uiUtil().msgBox(d.IDS_MSGBOX_HSM_ERROR_CONNECTION);break;default:a.uiUtil().errMsgBox(d.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b)}g.redrawList(null,0)}else(b=w())?g.redrawList(b.list,b.list.length):g.redrawList(null,0);a.ESVS.Embedded?setTimeout(function(){f.dispose()},10):f.dispose();setTimeout(function(){e.focus()},10)},onCancel:function(){f.dispose();setTimeout(function(){e.focus()},10)}});f.show();return!0}function ba(c,b){if(!c||!b)return!1;var e=null;n=a.CONST.__USFB_M_DISK.device;r=0;a.certsList&&(a.certsList=null);g.redrawList(null,-1);if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==n)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_DISK.device,function(d){if(0<d){for(var f=[],h=0;h<d;h++){var l=h+1,g={};g.index=l;g.name=a.nimservice().GetDiskDriveName(l);f[h]=g}e={list:f}}else return-1===d&&(d=a.nimservice().GetLastErrorCode(),f=a.nimservice().GetLastErrorMessage(),p.log("***** GetCertsFromRemovable *****"),p.log("Err Code : ",d,"\nErr Msg : ",f)),a.certsList=null,!1;M(a.CONST.__USFB_M_DISK.device,e,c,b)});else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;else{if(a.plugin().valid){var d=a.plugin().GetDiskListNum();if(0<d){for(var f=[],l=0;l<d;l++){var h=l+1,k={};k.index=h;k.name=a.plugin().GetDiskDriveName(h);f[l]=k}e={list:f}}else return-1===d&&(d=a.plugin().GetLastErrorCode(),f=a.plugin().GetLastErrorMessage(),p.log("***** GetCertsFromRemovable *****"),p.log("Err Code : ",d,"\nErr Msg : ",f)),a.certsList=null,!1}else return a.uiUtil().msgBox(b.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD),!1;M(a.CONST.__USFB_M_DISK.device,e,c,b)}return!0}function ca(c,b){if(!c||!b)return!1;var e=null;n=a.CONST.__USFB_M_HSMKEY.device;r=0;C(n);a.certsList&&(a.certsList=null);g.redrawList(null,-1);if(1&a.ESVS.Mode)if(a.plugin().valid){var d=[],f=a.plugin().GetHSMInstallListNum();if(0<f)for(var l=0;l<f;l++){var h=l+1,k={},m=a.plugin().GetHSMInstallDriverName(h).split("|");k.index=h;k.name=m[0];k.driver=m[1];k.passage=m[2];k.validity=m[3];d[l]=k}e={list:d}}else return a.uiUtil().msgBox(b.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD),!1;else if(4&a.ESVS.Mode)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_HSMKEY.device,function(d){if(0<d){for(var f=[],h=0;h<d;h++){var m=h+1,g={},l=a.nimservice().GetSecureTokenName(m).split("|");g.index=m;g.name=l[0];g.driver=l[1];g.passage=l[2];f[h]=g}e={list:f}}else a.nimservice().GetLastErrorCode();X(a.CONST.__USFB_M_HSMKEY.device,e,c,b)});else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;4&a.ESVS.Mode||X(a.CONST.__USFB_M_HSMKEY.device,e,c,b);return!0}function da(c,b){if(!c||!b)return!1;n=a.CONST.__USFB_M_SMARTCARD.device;r=0;C(n);a.certsList&&(a.certsList=null);g.redrawList(null,-1);if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==n)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_SMARTCARD.device,function(e){if(0<e){for(var d=[],f=0;f<e;f++){var g=f+1,h={};h.index=g;h.name=a.nimservice().GetSmartCardName(g);d[f]=h}driveList={list:d}}else return-1===e&&(e=a.nimservice().GetLastErrorCode(),d=a.nimservice().GetLastErrorMessage(),p.log("***** GetCertsFromRemovable *****"),p.log("Err Code : ",e,"\nErr Msg : ",d)),a.certsList=null,!1;M(a.CONST.__USFB_M_SMARTCARD.device,driveList,c,b)});else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function ea(c,b){if(!c||!b)return!1;n=a.CONST.__USFB_M_MOBILE.device;r=0;C(n);a.certsList&&(a.certsList=null);g.redrawList(null,-1);if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==n)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_MOBILE.device,function(c){if(0<c)t("redraw",a.CONST.__USFB_M_MOBILE.device,0,b,"");else return document.getElementById("us-cls-btn").click(),"firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"),!1});else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function H(c,b){if(!c||!b)return!1;a.uiUtil().MsgBox(b.IDS_MSGBOX_NOT_SUPPORTED_MEDIA);return!0}function fa(c,b){if(!c||!b)return!1;C(n);Y=a.loadUI("gridlist");g=Y({type:"certslist",tblid:"us-cert-manage-tbl-list",tbltitleid:"us-cert-manage-tbl-list-th",titlelistid:"us-cert-manage-grid-head-div",titlerowid:"us-cert-manage-list-title-row",titleelementid:"us-cert-manage-list-title-element",titledividerid:"us-cert-manage-list-title-divider",titlelistcn:"us-layout-grid-head-div",titlerowcn:"us-layout-grid-head-row",titleelementcn:"us-layout-grid-row-title-element",titledividercn:"us-layout-grid-row-title-divider",tblbodyid:"us-cert-manage-tbl-list-td",datalistid:"us-cert-manage-grid-body-div",datarowid:"us-cert-manage-list-body-row",dataelementid:"us-cert-manage-list-data-element",datalistcn:"us-layout-grid-body-div",datarowcn:"us-layout-grid-body-row",dataelementcn:"us-layout-grid-row-data-element",dataselectcn:"us-layout-grid-row-data-selected-element"});var e=!0;"opera"==a.browserName&&(e=!1);g.drawList(c,c.length,null,0,J,e);4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==n?t("redraw",n,0,b,"",c,e):(e=u(n,0,b,""),0!=e?a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,e):(e=w())?g.redrawList(e.list,e.list.length):g.redrawList(null,0));return!0}function A(c){if(!c)return!1;I(c,Z,"close");for(var b=a.ESVS.Media.list.split("|"),e=0;e<b.length;e++){var d=a.CONST.medias[b[e]];if(void 0!=d&&null!=d){var f=document.getElementById("us-cert-manage-btn-"+d.name);void 0!=f&&null!=f&&"us-layout-storage-btn-none"!=f.className&&(c===f?(f.className="us-layout-storage-btn-on",setTimeout(function(){f.focus()},10)):f.className="us-layout-storage-btn-off")}}return!0}function ga(c){if(null==c||void 0==c)return!1;var b=!a.uiUtil().isItSupportingThisStorage(c);!1==b&&null!=a.ESVS.Media&&null!=a.ESVS.Media.list&&0>a.ESVS.Media.list.indexOf(c.name)&&(b=!0);if(b)return!1;var b=document.getElementById("us-cert-manage-storage-btn-list"),e=document.createElement("li");e.setAttribute("id","us-cert-manage-storage-btn-li-"+c.name,0);e.setAttribute("mediaIndex",c.mediaIndex,0);7==c.mediaIndex&&(e.className="line-first");"hidden"===c.visibility?(e.style.display="none",e.style.visibility="hidden"):(e.style.display="block",e.style.visibility="visible");var d=document.createElement("button");d.setAttribute("type","button",0);d.setAttribute("id","us-cert-manage-btn-"+c.name,0);d.setAttribute("title",c.label,0);d.setAttribute("tabindex",c.tabIndex,0);c.disabled?(d.onclick=function(){a.uiUtil().msgBox(Z.IDS_MSGBOX_NOT_SUPPORTED_MEDIA)},d.className="us-layout-storage-btn-none"):(d.onclick=c.onclick,c.device===n?(d.className="us-layout-storage-btn-on",setTimeout(function(){d.focus()},10)):d.className="us-layout-storage-btn-off");e.appendChild(d);if("harddisk"!==c.name&&"webstorage"!==c.name){var f=document.createElement("span");f.className="us-drive-select";d.appendChild(f)}f=document.createElement("span");f.className="us-img-storage";var g=document.createElement("img");g.setAttribute("id","us-cert-manage-img-"+c.name,0);g.setAttribute("alt",c.label,0);c.disabled?g.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+"_d.png",0):g.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+".png",0);f.appendChild(g);d.appendChild(f);f=document.createElement("span");f.setAttribute("id","us-cert-manage-lbl-"+c.name,0);f.className="us-layout-lbl-storage";f.appendChild(document.createTextNode(c.label));d.appendChild(f);e.appendChild(d);b.appendChild(e);return!0}function I(c,b,e){if("no_more"==e)a.uiUtil().msgBox(b.IDS_MSGBOX_NOT_MORE_MEDIA);else{c=document.getElementById("us-cert-manage-storage-wrap");"open"==e?(c.className="us-layout-storage-more-wrap",c=document.getElementById("us-cert-manage-storage-more-btn"),c.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_HIDDEN+b.IDS_BUTTON,0),c.onclick=function(){I(this,b,"close")},c=document.getElementById("us-cert-manage-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_HIDDEN,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_close.png",0)):(c.className="us-layout-storage-wrap",c=document.getElementById("us-cert-manage-storage-more-btn"),c.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),c.onclick=function(){I(this,b,"open")},c=document.getElementById("us-cert-manage-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0));c=a.ESVS.Media.list.split("|");for(var d=0;d<c.length;d++){var f=a.CONST.medias[c[d]];if(void 0!=f&&null!=f){var g=document.getElementById("us-cert-manage-storage-btn-li-"+f.name);if(void 0!=g&&null!=g){var h=g.getAttribute("mediaIndex");"open"==e?(g.style.display="block",g.style.visibility="visible"):6<h?(g.style.display="none",g.style.visibility="hidden"):(g.style.display="block",g.style.visibility="visible");if(1==h){var k=document.getElementById("us-cert-manage-btn-"+f.name);setTimeout(function(){k.focus()},10);break}}}}}return!0}function x(a){var b=document.querySelector(".us-layout-storage-btn-on span img").alt,e=document.querySelector(".us-layout-storage-btn-on span img").src,d=document.getElementById("us-cert-manage-img-current-storage");d.setAttribute("alt",b,0);d.setAttribute("src",e,0);d=document.getElementById("us-cert-manage-lbl-current-storage");d.innerHTML=b;0>g.selectedIndex()&&(document.getElementById("us-layout-cert-manage-detail-box-subject").innerHTML="<b style='color: red;'>"+a.IDS_DETAIL_BOX_NOT_SELECTED+"</b>",document.getElementById("us-layout-cert-manage-detail-box-expire-data").innerHTML="")}var ha=function(){var c;c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/layout/certmanage.html?version="+a.ver,!1);c.send(null);return c.responseText},$=function(){var c;c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/certmanage_"+a.ESVS.Language+".js?version="+a.ver,!1);c.send(null);return c.responseText},Z=eval(eval($)()),Y=null,g=null,v=a.ESVS.TabIndex,J=0,n=a.CONST.__USFB_M_HDD.device,r=0;null!=a.ESVS.Media&&null!=a.ESVS.Media.defaultdevice?n=a.uiUtil().getMediaDevice(a.ESVS.Media.defaultdevice):2==a.ESVS.Mode&&(n=a.CONST.__PF_M_LS.device);var p=window.console||{log:function(){}};return function(){var c=eval(ha),b=eval(eval($)());a.ESVS.TargetObj.innerHTML=c();var e=document.getElementById("us-cert-manage-lbl-title");e.appendChild(document.createTextNode(b.IDS_CERT_MANAGEMENT));e.setAttribute("tabindex",v++,0);c=document.getElementById("us-cert-manage-cls-img-btn");c.setAttribute("title",b.IDS_CLOSE_CERT_MANAGEMENT_CLOSE,0);c.onclick=function(){g.restoreOnMouseEvent();q.onCancel()};document.getElementById("us-cert-manage-cls-btn-img").setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_close_btn.png",0);document.getElementById("us-cursor-disabled").setAttribute("title",b.IDS_SENSE_READER_INTRO,0);c=document.getElementById("us-cert-manage-logo-img");c.setAttribute("alt",b.IDS_LOGO,0);c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/main_cert_logo.png",0);c.setAttribute("tabindex",v++,0);document.getElementById("us-cert-manage-legend-storage").appendChild(document.createTextNode(b.IDS_STORAGE_SELECT));for(var c=0,d=a.ESVS.Media.list.split("|"),f=null,l=0;l<d.length;l++){var h=a.CONST.medias[d[l]];if(void 0!=h&&null!=h){switch(h.device){case a.CONST.__USFB_M_DISK.device:h.label=b.IDS_STORAGE_REMOVABLE;h.disabled=2==a.ESVS.Mode;h.onclick=function(){ba(this,b);A(this);x(b)};break;case a.CONST.__USFB_M_HSMKEY.device:h.label=b.IDS_STORAGE_SECTOKEN;h.disabled=!q.args||1!=q.args.type&&2!=q.args.type&&4!=q.args.type?!("win"==a.osName&&2!=a.ESVS.Mode):!0;h.onclick=function(){ca(this,b);A(this);x(b)};break;case a.CONST.__USFB_M_SMARTCARD.device:h.label=b.IDS_STORAGE_SAVETOKEN;h.disabled=!("win"==a.osName&&2!=a.ESVS.Mode);h.onclick=function(){da(this,b);A(this);x(b)};break;case a.CONST.__USFB_M_MOBILE.device:h.label=b.IDS_STORAGE_MOBILEPHONE;h.disabled=!q.args||2!=q.args.type&&5!=q.args.type?2==a.ESVS.Mode:!0;h.onclick=function(){ea(this,b);A(this);x(b)};break;case a.CONST.__USFB_M_HDD.device:h.label=b.IDS_STORAGE_HARDDISK;h.disabled=2==a.ESVS.Mode;h.onclick=function(){if(this&&b)if(n=a.CONST.__USFB_M_HDD.device,r=0,C(n),a.certsList&&(a.certsList=null),g.redrawList(null,-1),4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==n)t("redraw",a.CONST.__USFB_M_HDD.device,0,b,"");else{var c=u(a.CONST.__USFB_M_HDD.device,0,b,"");0!=c?(a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),g.redrawList(null,0)):(c=w())?g.redrawList(c.list,c.list.length):g.redrawList(null,0)}A(this);x(b)};break;case a.CONST.__USFB_M_MOBILETOKEN.device:h.label=b.IDS_STORAGE_MOBILETOKEN;h.disabled=!0;h.readOnly=!0;h.onclick=function(){this&&b&&(n=a.CONST.__USFB_M_MOBILEOTKEN.device,r=0,a.certsList&&(a.certsList=null),g.redrawList(null,-1),4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==n&&t("redraw",a.CONST.__USFB_M_MOBILETOKEN.device,0,b,""));A(this);x(b)};break;case a.CONST.__PF_M_LS.device:h.label=b.IDS_STORAGE_LS;h.disabled=1==a.ESVS.Mode;h.onclick=function(){if(this&&b){n=a.CONST.__PF_M_LS.device;r=0;C(n);a.certsList&&(a.certsList=null);g.redrawList(null,-1);var c=u(a.CONST.__PF_M_LS.device,0,b,"");0!=c?(a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),g.redrawList(null,0)):(c=w())?g.redrawList(c.list,c.list.length):g.redrawList(null,0)}A(this);x(b)};break;case a.CONST.__PF_M_TOUCHSIGN.device:h.label=b.IDS_STORAGE_TOUCHSIGN;h.disabled=!0;h.onclick=function(){H(this,b);x(b)};break;case a.CONST.__PF_M_SMARTSIGN.device:h.label=b.IDS_STORAGE_SMARTSIGN;h.disabled=!0;h.onclick=function(){H(this,b);x(b)};break;case a.CONST.__PF_M_WEBSECTOKEN.device:h.label=b.IDS_STORAGE_WEBSECTOKEN;h.disabled=!0;h.onclick=function(){H(this,b);x(b)};break;case a.CONST.__PF_M_WEBSOFTTOKEN.device:h.label=b.IDS_STORAGE_WEBSOFTTOKEN;h.disabled=!0;h.onclick=function(){H(this,b);x(b)};break;default:h.label=b.IDS_STORAGE_ETC,h.disabled=!0,h.onclick=function(){H(this,b);x(b)}}h.tabIndex=v;h.mediaIndex=c+1;h.visibility=6<h.mediaIndex?"hidden":"visible";ga(h)&&(v++,c++);null==f&&(f=h)}}d=document.getElementById("us-cert-manage-storage-more-btn");null!=d&&void 0!=d&&(d.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),6<c?(d.style.display="block",d.style.visibility="visible",d.setAttribute("tabindex",v++,0),d.onclick=function(){I(this,b,"open")}):(d.setAttribute("disabled","disabled",0),d.style.display="none",d.style.visibility="hidden",d.onclick=function(){I(this,b,"no_more")}),c=document.getElementById("us-cert-manage-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0));document.getElementById("us-cert-manage-tbl-list").style.summary=b.IDS_CERT_LIST_TABLE_SUMMARY;document.getElementById("us-cert-manage-tbl-list-caption").appendChild(document.createTextNode(b.IDS_CERT_LIST_CAPTION));c=[{title:b.IDS_CERT_STATUS},{title:b.IDS_CERT_CLASSIFY},{title:b.IDS_CERT_USER},{title:b.IDS_CERT_ISSUER},{title:b.IDS_CERT_EXPIRATION_DAY}];J=v++;fa(c,b);document.getElementById("us-cert-manage-file-search-hidden").onchange=function(){N(this,b)};null!=q.args?(document.getElementById("us-div-cert-manage-btns").style.display="none",document.getElementById("us-fieldset-cert-manage-title").appendChild(document.createTextNode(b.IDS_DETAIL_BOX_TITLE)),-1<g.selectedIndex()?(c=parseInt(g.selectedIndex()),a.usWebToolkit.x509Certificate.parser(a.certsList.list[c-1].cert,"Base64"),document.getElementById("us-layout-cert-manage-detail-box-subject").innerHTML="<b>"+a.certUtil().getCN(a.usWebToolkit.x509Certificate.getSubjectName())+"</b>",document.getElementById("us-layout-cert-manage-detail-box-expire-data").innerHTML=a.certUtil().getLocalDate(a.usWebToolkit.x509Certificate.getNotBefore())+" ~ "+a.certUtil().getLocalDate(a.usWebToolkit.x509Certificate.getNotAfter())):document.getElementById("us-layout-cert-manage-detail-box-subject").innerHTML="<b style='color: red;'>"+b.IDS_DETAIL_BOX_NOT_SELECTED+"</b>",document.getElementById("us-layout-cert-manage-detail-box-expire-lbl").innerHTML=b.IDS_DETAIL_BOX_EXPIRE_DATE+" : ",c=document.getElementById("us-cert-manage-detail-view-btn"),c.setAttribute("tabindex",v++,0),c.value=b.IDS_DETAIL_BOX_BTN_VIEW,c.title=b.IDS_DETAIL_BOX_BTN_VIEW,c.onclick=function(){D(this,b)},c=document.getElementById("us-cert-manage-sw-info-btn"),c.setAttribute("tabindex",v++,0),c.setAttribute("class","btn-action"),c.value=b.IDS_DETAIL_BOX_BTN_ACTIONS[q.args.type],c.title=b.IDS_DETAIL_BOX_BTN_ACTIONS[q.args.type],c.onclick=function(){switch(q.args.type){case 1:O(this,b);break;case 2:P(this,b);break;case 3:S(b);break;case 4:T(this,b);break;case 5:Q(this,b)}},x(b)):(document.getElementById("us-div-cert-manage-detail").style.display="none",c=document.getElementById("us-cert-manage-cert-view-btn"),c.setAttribute("value",b.IDS_CERT_VIEW,0),c.setAttribute("title",b.IDS_CERT_VIEW+b.IDS_BUTTON,0),c.setAttribute("tabindex",v++,0),c.onclick=function(){D(this,b)},c=document.getElementById("us-cert-manage-pw-change-btn"),c.setAttribute("value",b.IDS_PW_CHANGE,0),c.setAttribute("title",b.IDS_PW_CHANGE+b.IDS_BUTTON,0),c.setAttribute("tabindex",v++,0),c.onclick=function(){P(this,b)},c=document.getElementById("us-cert-manage-cert-copy-btn"),c.setAttribute("value",b.IDS_CERT_COPY,0),c.setAttribute("title",b.IDS_CERT_COPY+b.IDS_BUTTON,0),c.setAttribute("tabindex",v++,0),c.onclick=function(){O(this,b)},c=document.getElementById("us-cert-manage-cert-delete-btn"),c.setAttribute("value",b.IDS_CERT_DELETE,0),c.setAttribute("title",b.IDS_CERT_DELETE+b.IDS_BUTTON,0),c.setAttribute("tabindex",v++,0),c.onclick=function(){Q(this,b)},c=document.getElementById("us-cert-manage-get-cert-btn"),c.setAttribute("value",b.IDS_CERT_GET,0),c.setAttribute("title",b.IDS_CERT_GET+b.IDS_BUTTON,0),c.setAttribute("tabindex",v++,0),c.onclick=function(){S(b)},c=document.getElementById("us-cert-manage-put-cert-out-btn"),c.setAttribute("value",b.IDS_CERT_PUT_OUT,0),c.setAttribute("title",b.IDS_CERT_PUT_OUT+b.IDS_BUTTON,0),c.setAttribute("tabindex",v++,0),c.onclick=function(){T(this,b)},c=document.getElementById("us-cert-manage-sw-info-btn"),c.setAttribute("value",b.IDS_SW_INFO,0),c.setAttribute("title",b.IDS_SW_INFO+b.IDS_BUTTON,0),c.setAttribute("tabindex",v++,0),c.onclick=function(){aa(this)});document.getElementById("us-cert-manage-lbl-notice").appendChild(document.createTextNode(b.IDS_NOTICE));var k=document.getElementById("us-cert-manage-cls-btn");k.setAttribute("value",b.IDS_CANCEL,0);k.setAttribute("title",b.IDS_CANCEL+b.IDS_BUTTON,0);k.setAttribute("tabindex",v++,0);k.onclick=function(){g.restoreOnMouseEvent();q.onCancel()};k.onkeydown=function(a){a=a||window.event;var b=a.which||a.keyCode;9==b&&a.shiftKey&&(k.onblur=function(){setTimeout(function(){document.getElementById("us-cert-manage-sw-info-btn").focus()},10)});9!=b||a.shiftKey||(k.onblur=function(){setTimeout(function(){e.focus()},10)})};e.onkeydown=function(a){a=a||window.event;9==(a.which||a.keyCode)&&a.shiftKey&&(e.onblur=function(){setTimeout(function(){k.focus()},10)})};return document.getElementById("us-div-cert-manage")}()};return function(q){var w=a.uiLayerLevel,t=a.uiUtil().getOverlay(w),u=N({type:q.type,args:q.args,onConfirm:q.onConfirm,onCancel:q.onCancel});u.style.zIndex=w+1;document.body.insertBefore(t,document.body.firstChild);var D=window.onresize;return{show:function(){draggable(u,document.getElementById("us-div-cert-manage-title"));t.style.display="block";a.uiUtil().offsetResize(u);window.onresize=function(){a.uiUtil().offsetResize(u)};a.uiLayerLevel+=10;a.ESVS.TabIndex+=30;setTimeout(function(){a:for(var q=a.ESVS.Media.list.split("|"),u=0;u<q.length;u++){var t=a.CONST.medias[q[u]];if(void 0!=t&&null!=t&&(t=document.getElementById("us-cert-manage-btn-"+t.name),"us-layout-storage-btn-on"==t.className)){t.focus();break a}}},10)},hide:function(){t.style.display="none";u.style.display="none"},dispose:function(){window.onresize=function(){D&&D()};u.parentNode.removeChild(u);t.parentNode.removeChild(t);a.uiLayerLevel-=10;a.ESVS.TabIndex-=30}}}};