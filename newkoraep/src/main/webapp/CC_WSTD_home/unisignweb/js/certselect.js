var __certselect=function(a){var H=function(g){function n(){if(!a.certsList)return null;var c=null,c=a.certsList,b=c.list.length,e=[],f=g.args.dn,h=null;null!=a.ESVS.Policy&&(-1!=a.ESVS.Policy.indexOf("|")?h=a.ESVS.Policy.split("|"):(h=[],h[0]=a.ESVS.Policy));var d=null;null!=a.ESVS.Organization&&(-1!=a.ESVS.Organization.indexOf("|")?d=a.ESVS.Organization.split("|"):(d=[],d[0]=a.ESVS.Organization));for(var C=0;C<b;C++){a.usWebToolkit.x509Certificate.parser(c.list[C].cert,"Base64");var m=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),k=a.usWebToolkit.x509Certificate.getSubjectName(),w=a.usWebToolkit.x509Certificate.getNotAfter(),I=a.usWebToolkit.x509Certificate.getNotAfter(),Q=c.list[C].index,l=a.certUtil().getIssuerName(m);"undefined"==l&&(l=a.certUtil().getO(k));if(null==f||"DIGITAL_SIGNATURE_P1"!=g.type&&"DIGITAL_SIGNATURE_P7"!=g.type&&"DIGITAL_SIGNATURE_P7_EXT"!=g.type||k.toLowerCase()==f.toLowerCase()){if(null!=a.ESVS.Policy){for(var s=0;s<h.length&&h[s]!=m;s++);if(h.length<=s)continue}if(null!=a.ESVS.Organization&&("CERT_RENEWAL"==g.type||"CERT_REVOCATION"==g.type||"CERT_SOE"==g.type||"CERT_RENEWAL_SIGN"==g.type)){for(s=0;s<d.length&&d[s].toLowerCase()!=a.certUtil().getO(k).toLowerCase();s++);if(d.length<=s)continue}if(a.ESVS.ShowExpiredCerts||"DIGITAL_SIGNATURE_P1"!=g.type&&"DIGITAL_SIGNATURE_P7"!=g.type&&"DIGITAL_SIGNATURE_P7_EXT"!=g.type||2!==a.certUtil().getExpirationStateValue(I))s=[""],s[1]=a.certUtil().getCertType(m),s[2]=a.certUtil().getCN(k),s[3]=l,s[4]=a.certUtil().getLocalDate(w),s[5]=Q,s[6]=a.certUtil().getExpirationStateValue(I),e.push(s)}}return c={list:e}}function q(c,b,e,f,h,d,g){function m(){var a=n();"draw"==c?a?k.drawList(d,d.length,a.list,a.list.length,D,g):k.drawList(d,d.length,null,0,D,g):"redraw"==c&&(a?k.redrawList(a.list,a.list.length):k.redrawList(null,0))}if(a.CONST.__USFB_M_DISK.device>b||0>e||!f)return-1;var l=0;t=e;a.certsList&&(a.certsList=null);a.nimservice()?a.nimservice().GetAllMediaList(0,function(c,d){0==c?a.nimservice().GetAllUserCertListNum(b,e,"",a.ESVS.Policy,function(c,e){l=e;if(0==c)0<l?a.nimservice().GetAllUserCert(e,function(b,c){0==b?a.certsList={list:c}:a.uiUtil().errMsgBox(a.nimservice().GetLastErrorMessage(),b);a.uiUtil().loadingBox(!1,"us-div-list-load");m()}):(m(),a.uiUtil().loadingBox(!1,"us-div-list-load"));else{if(b==a.CONST.__USFB_M_MOBILE.device&&(11003==c||11004==c))return document.getElementById("us-cls-btn").click(),"firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"),!1;if(-1===l)c=-1;else{var d=a.nimservice().GetLastErrorCode(),f=a.nimservice().GetLastErrorMessage();p.log("***** GetCerts *****");p.log("Err Code : ",d,"\nErr Msg : ",f);a.uiUtil().errMsgBox(f,c);c=d}m();done=1;a.uiUtil().loadingBox(!1,"us-div-list-load")}}):(c=-1,m(),done=1,a.uiUtil().loadingBox(!1,"us-div-list-load"))}):(m(),a.uiUtil().msgBox(f.IDS_MSGBOX_NIM_ERROR_UNLOAD))}function v(c,b,e,f){if(a.CONST.__USFB_M_DISK.device>c||0>b||!e)return-1;var h=0,d=0;t=b;a.certsList&&(a.certsList=null);if(a.CONST.__PF_M_LS.device===c&&2&a.ESVS.Mode){if(!a.PFSH)return-1;try{a.PFSH.SelectStorage(1)}catch(g){p.log("***** Plugin Free SelectStorage error *****"),p.log("e.code : ",g.code,"e.message : ",g.message,"e.detail : ",g.detail)}try{a.PFSH.LoadAllCerts(document.domain)}catch(m){301E5===m.code?(a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain)):(p.log("***** Plugin Free LoadAllCerts error *****"),p.log("e.code : ",m.code,"e.message : ",m.message,"e.detail : ",m.detail))}c=null;try{c=a.PFSH.GetUserCerts(document.domain),a.PFUC=c}catch(l){p.log("***** Plugin Free GetUserCerts error *****"),p.log("e.code : ",l.code,"e.message : ",l.message,"e.detail : ",l.detail)}c&&(h=c.length-1);p.log("***** Plugin Free *****");p.log("user certificate counts : ",h);if(0<h){b=[];for(e=0;e<h;e++){f=e+1;var k={};k.index=f;k.cert=c[f].signcert;b[e]=k}a.certsList={list:b}}else a.certsList=null,d=0}else if(a.CONST.__PF_M_LS.device!==c&&1&a.ESVS.Mode)if(a.plugin().valid)if("GPKI"==a.ESVS.PKI?a.plugin().SetGPKI():a.ESVS.PKI&&"NPKI"!=a.ESVS.PKI&&a.plugin().SetPCA(a.ESVS.PKI),h=a.CONST.__USFB_M_SMARTCARD.device===c?a.plugin().GetAllUserCertListNum(c,b,f):a.plugin().GetAllUserCertListNum(c,b,""),0<h){b=[];for(e=0;e<h;e++)f=e+1,k={},k.index=f,k.cert=a.plugin().GetUserSignCertFromCertList(f),b[e]=k;a.certsList={list:b}}else 0===h?d=0:(h=a.plugin().GetLastErrorCode(),d=a.plugin().GetLastErrorMessage(),p.log("***** GetCerts *****"),p.log("Err Code : ",h,"\nErr Msg : ",d),d=h),a.certsList=null;else return a.uiUtil().msgBox(e.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD),-1;return d}function R(c,b){if(!c||!b)return!1;if(!a.certsList||0>k.selectedIndex())return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var e=a.loadUI("certverify")({type:null,args:{idx:parseInt(k.selectedIndex())},onConfirm:function(){e.dispose();c.focus()},onCancel:function(){e.dispose();c.focus()}});e.show();a.uiUtil().loadingBox(!1,"us-div-list-load");return!0}function S(c,b){if(!c||!b)return!1;if(!a.certsList||0>k.selectedIndex())return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var e=a.loadUI("certview")({type:null,args:{type:"Base64",idx:parseInt(k.selectedIndex()),cert:a.certsList.list[parseInt(k.selectedIndex())-1].cert},onConfirm:function(){e.dispose();c.focus()},onCancel:function(){e.dispose();c.focus()}});e.show();a.uiUtil().loadingBox(!1,"us-div-list-load");return!0}function x(c,b,e,f){if(a.CONST.__USFB_M_DISK.device>c||!b||!e||!f)return!1;var h=a.loadUI("driveselect")({type:"DEVICE_REMOVABLE_DISK",args:b,onConfirm:function(b){0<b&&(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==l?q("redraw",c,b,f,""):(b=v(c,b,f,""),0!=b?(a.uiUtil().errMsgBox(f.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b),k.redrawList(null,0)):(b=n())?k.redrawList(b.list,b.list.length):k.redrawList(null,0)));a.ESVS.Embedded?setTimeout(function(){h.dispose()},10):h.dispose();e.focus();a.uiUtil().loadingBox(!1,"us-div-list-load")},onCancel:function(){a.uiUtil().loadingBox(!1,"us-div-list-load");h.dispose();e.focus()}});h.show();return!0}function J(c,b,e,f){if(a.CONST.__USFB_M_DISK.device>c||!b||!e||!f)return!1;var h=a.loadUI("sectokenselect")({type:c,args:b,onConfirm:function(b){if(0<b)if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==l)q("redraw",c,b,f,"");else if(b=v(c,b,f,""),0!=b){switch(b){case 4812E4:case 4813E4:a.uiUtil().msgBox(f.IDS_MSGBOX_HSM_ERROR_CONNECTION);break;default:a.uiUtil().errMsgBox(f.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b)}k.redrawList(null,0)}else(b=n())?k.redrawList(b.list,b.list.length):k.redrawList(null,0);a.ESVS.Embedded?setTimeout(function(){h.dispose()},10):h.dispose();e.focus()},onCancel:function(){h.dispose();e.focus()}});h.show();return!0}function H(c,b,e,f){if(a.CONST.__USFB_M_DISK.device>c||!b||!e||!f)return!1;var h=a.loadUI("driveselect")({type:"DEVICE_SAVE_TOKEN",args:b,onConfirm:function(b){h.dispose();if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==l)q("redraw",c,b,f,"");else if(a.plugin().valid){var g=a.plugin().CheckSmartCard();0===g?(PINDialog=a.loadUI("pin")({type:"PIN_SAVE_TOKEN",args:null,onConfirm:function(b){g=a.plugin().CheckPinNumberSCard(b);if(0!=g){switch(g){case 49000004:a.uiUtil().msgBox(f.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 49000005:a.uiUtil().msgBox(f.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;default:a.uiUtil().errMsgBox(f.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN,d)}k.redrawList(null,0)}else{var d=v(c,0,f,b);0!=d?(a.uiUtil().errMsgBox(f.IDS_MSGBOX_COMMON_ERROR_GET_CERT,d),k.redrawList(null,0)):(b=n())?k.redrawList(b.list,b.list.length):k.redrawList(null,0)}a.ESVS.Embedded?setTimeout(function(){PINDialog.dispose()},10):PINDialog.dispose();setTimeout(function(){e.focus()},10)},onCancel:function(){PINDialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){e.focus()},10)}}),PINDialog.show()):(a.uiUtil().msgBox(f.IDS_MSGBOX_SMART_CARD_UNCONNECTED),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){e.focus()},10))}else a.uiUtil().msgBox(f.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){e.focus()},10)},onCancel:function(){h.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");e.focus()}});h.show();return!0}function T(c,b){if(!c||!b)return!1;var e=null;l=a.CONST.__USFB_M_DISK.device;t=0;a.certsList&&(a.certsList=null);k.redrawList(null,-1);z(b);u();if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==l)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_DISK.device,function(f){if(0<f){for(var d=[],h=0;h<f;h++){var g=h+1,k={};k.index=g;k.name=a.nimservice().GetDiskDriveName(g);d[h]=k}e={list:d}}else return-1===f&&(f=a.nimservice().GetLastErrorCode(),d=a.nimservice().GetLastErrorMessage(),p.log("***** GetCertsFromRemovable *****"),p.log("Err Code : ",f,"\nErr Msg : ",d)),a.uiUtil().loadingBox(!1,"us-div-list-load"),a.certsList=null,!1;x(a.CONST.__USFB_M_DISK.device,e,c,b)});else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;else{if(a.plugin().valid){var f=a.plugin().GetDiskListNum();if(0<f){for(var h=[],d=0;d<f;d++){var g=d+1,m={};m.index=g;m.name=a.plugin().GetDiskDriveName(g);h[d]=m}e={list:h}}else return-1===f&&(f=a.plugin().GetLastErrorCode(),h=a.plugin().GetLastErrorMessage(),p.log("***** GetCertsFromRemovable *****"),p.log("Err Code : ",f,"\nErr Msg : ",h)),a.uiUtil().loadingBox(!1,"us-div-list-load"),a.certsList=null,!1}else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(b.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD),!1;x(a.CONST.__USFB_M_DISK.device,e,c,b)}return!0}function U(c,b){if(!c||!b)return!1;var e=null;l=a.CONST.__USFB_M_HSMKEY.device;t=0;a.certsList&&(a.certsList=null);k.redrawList(null,-1);V(b);u();if(1&a.ESVS.Mode)if(a.plugin().valid){var f=[],h=a.plugin().GetHSMInstallListNum();if(0<h)for(var d=0;d<h;d++){var g=d+1,m={},n=a.plugin().GetHSMInstallDriverName(g).split("|");m.index=g;m.name=n[0];m.driver=n[1];m.passage=n[2];m.validity=n[3];f[d]=m}else-1===h&&(h=a.plugin().GetLastErrorCode(),d=a.plugin().GetLastErrorMessage(),p.log("***** GetCertsFromSecToken *****"),p.log("Err Code : ",h,"\nErr Msg : ",d));e={list:f}}else return a.uiUtil().msgBox(b.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD),!1;else if(4&a.ESVS.Mode)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_HSMKEY.device,function(f){if(0<f){for(var d=[],h=0;h<f;h++){var g=h+1,k={},l=a.nimservice().GetSecureTokenName(g).split("|");k.index=g;k.name=l[0];k.driver=l[1];k.passage=l[2];d[h]=k}e={list:d}}else a.nimservice().GetLastErrorCode();J(a.CONST.__USFB_M_HSMKEY.device,e,c,b)});else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;4&a.ESVS.Mode||J(a.CONST.__USFB_M_HSMKEY.device,e,c,b);return!0}function W(c,b){if(!c||!b)return!1;var e=null;l=a.CONST.__USFB_M_SMARTCARD.device;t=0;a.certsList&&(a.certsList=null);k.redrawList(null,-1);z(b);u();if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==l)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_SMARTCARD.device,function(f){if(0<f){for(var h=[],d=0;d<f;d++){var g=d+1,k={};k.index=g;k.name=a.nimservice().GetSmartCardName(g);h[d]=k}e={list:h}}else return-1===f&&(f=a.nimservice().GetLastErrorCode(),h=a.nimservice().GetLastErrorMessage(),p.log("***** GetCertsFromSaveToken *****"),p.log("Err Code : ",f,"\nErr Msg : ",h)),a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-list-load"),!1;H(a.CONST.__USFB_M_SMARTCARD.device,e,c,b)});else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),a.uiUtil().loadingBox(!1,"us-div-list-load"),!1;return!0}function K(c,b){if(!c||!b)return!1;l=a.CONST.__USFB_M_MOBILETOKEN.device;t=0;a.certsList&&(a.certsList=null);k.redrawList(null,-1);z(b);u();if(4&a.ESVS.Mode)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_MOBILETOKEN.device,function(b){0<b?document.getElementById("us-confirm-btn").click():(document.getElementById("us-cls-btn").click(),"firefox"==a.browserName?window.open("http://ids.smartcert.kr","usim_url","scrollbars=1, op=100px, left=100px, height=500px, width=380px"):window.open("http://ids.smartcert.kr","usim_url","top=100px, left=100px, height=500px, width=380px"))});else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function X(c,b){if(!c||!b)return!1;var e=[function(){K(c,b)},function(){Y(c,b)}],f=a.loadUI("mobileselect")({type:null,args:null,onConfirm:function(a){e[a]();f.dispose()},onCancel:function(){f.dispose()}});f.show();return!0}function Y(c,b){if(!c||!b)return!1;l=a.CONST.__USFB_M_MOBILE.device;t=0;a.certsList&&(a.certsList=null);k.redrawList(null,-1);z(b);u();if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==l)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_MOBILE.device,function(c){if(0<c)q("redraw",a.CONST.__USFB_M_MOBILE.device,0,b,"");else return document.getElementById("us-cls-btn").click(),"firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"),!1});else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function A(c,b){if(!c||!b)return!1;a.uiUtil().MsgBox(b.IDS_MSGBOX_NOT_SUPPORTED_MEDIA);return!0}function z(a){if(!a)return!1;var b=document.getElementById("us-lbl-pw");b.removeChild(b.lastChild);b.appendChild(document.createTextNode(a.IDS_PASSWORD));document.getElementById("us-lbl-pw2").innerHTML=E.IDS_PASSWORD_DESCRIPTION;return!0}function V(a){if(!a)return!1;var b=document.getElementById("us-lbl-pw");b.removeChild(b.lastChild);b.appendChild(document.createTextNode(a.IDS_PIN));document.getElementById("us-lbl-pw2").innerHTML="";return!0}function L(a){if(null==a||0>=a.length)return!1;var b=document.getElementById("us-pw-text");b.value=a;b.readOnly=!0;return b.disabled=!0}function u(){var a=document.getElementById("us-pw-text");a.value="";a.readOnly=!1;a.disabled=!1}function F(c,b,e){function f(){a.certsList&&(a.certsList=null);k.redrawList(null,-1);u();b=""}if(4&a.ESVS.Mode){if(null==e)return!1}else if(null==b||0>=b.length||null==e)return!1;a.certsList&&(a.certsList=null);if(0<c){var h=[],d={},g=null;if(4&a.ESVS.Mode)d.index=c,a.nimservice().GetSelectUserCert(c,function(b,c){if(0==b){d.cert=c;h[0]=d;a.certsList={list:h};if(g=n())return k.redrawList(g.list,g.list.length),!0;f();return!1}f();return!1});else{d.index=c;d.cert=a.plugin().GetUserSignCertFromCertList(c);h[0]=d;a.certsList={list:h};if(g=n())return k.redrawList(g.list,g.list.length),L(b),b="",!0;f();return!1}}else{c=a.plugin().GetLastErrorCode();var l=a.plugin().GetLastErrorMessage();p.log("***** GetCertFromPFX *****");p.log("Err Code : ",c,"\nErr Msg : ",l);switch(c){case 4301E4:a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED);break;default:a.uiUtil().errMsgBox(e.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c)}f();return!1}}function Z(c,b,e){if(null==c||0>=c.length||null==b||0>=b.length||null==e)return!1;a.plugin().valid?(c=a.plugin().GetPfxCertList(c,b),F(c,b,e)):a.uiUtil().msgBox(e.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD)}function $(c,b,e){if(null==c||0>=c.length||null==b||0>=b.length||null==e)return!1;var f=!1;if(1&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==l)a.plugin().valid?(f=a.plugin().GetPfxCertListString(c,b),f=F(f,b,e)):a.uiUtil().msgBox(e.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD);else a:if(c&&b&&e){var f=0,h={};try{var d=a.PFSH.SetP12OnMemory(c,b),f=d.index;a.PFUC=h=d.aluc}catch(g){p.log("***** Plugin Free SetP12OnMemory error *****");p.log("e.code : ",g.code,"e.message : ",g.message,"e.detail : ",g.detail);switch(g.code){case 1E7:0<=g.detail.indexOf("115010")?a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(e.IDS_MSGBOX_COMMON_ERROR_GET_CERT,g.detail);break;default:a.uiUtil().errMsgBox(e.IDS_MSGBOX_COMMON_ERROR_GET_CERT,g.code)}f=!1;break a}a.certsList&&(a.certsList=null);e=[];c={};d=null;c.index=f;c.cert=h[f].signcert;e[0]=c;a.certsList={list:e};(d=n())?(k.redrawList(d.list,d.list.length),L(b),f=!0):(a.certsList=null,k.redrawList(null,-1),u(),f=!1)}else f=!1;return f}function M(c,b){if(null==c||0>=c.length||null==b)return!1;if(0<c.length&&-1<c.indexOf(".")){var e=c.split("."),e=e[e.length-1].toLowerCase();if("pfx"!=e&&"p12"!=e)return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_NOT_PFX),!1}else return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1;return!0}function aa(c){if(null==c)return!1;if(4&a.ESVS.Mode)if(l=a.CONST.__USFB_M_ETC.device,t=0,a.nimservice())a.nimservice().GetCertListWithP12(a.CONST.__USFB_M_ETC.device,0,"","",function(b,e){if(0==b)b=F(1,"",c,function(a){b=a;return 0==b?!0:!1});else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().errMsgBox(e,b),!1});else return pw="",a.uiUtil().msgBox(c.IDS_MSGBOX_NIM_ERROR_UNLOAD),rv;else{var b=document.getElementById("us-file-search-hidden");if("safari"==a.browserName&&6>parseFloat(a.browserVersion))return a.uiUtil().msgBox(c.IDS_MSGBOX_SEARCH_CERT_GUIDE_FOR_SAFARI),!1;if("opera"==a.browserName||"safari"==a.browserName||"msie"==a.browserName&&8===parseInt(a.browserVersion))b.style.display="block";b.value="";if(""!=b.value){var e=b.onchange,f=b.parentNode;f.removeChild(b);b=document.createElement("input");b.setAttribute("type","file",0);b.setAttribute("accept","application/x-pkcs12",0);b.setAttribute("id","us-file-search-hidden",0);b.className="us-layout-file-search-hidden";b.onchange=e;f.appendChild(b)}b.click();return!0}}function ba(c,b){if(!c||!b)return!1;l=a.CONST.__USFB_M_ETC.device;t=0;var e=null,f=null,g=document.getElementById("us-confirm-btn"),d=document.getElementById("us-cert-search-btn");if("opera"==a.browserName||"safari"==a.browserName)c.style.display="none";if(window.FileReader){var k=c.files;if(0<k.length){var m=k[0];if(!0==M(m.name,b)){var n=new FileReader;n.readAsBinaryString?(n.readAsBinaryString(m),n.addEventListener("load",function(){var c=n.result,e=c.length;if(m.size===e)f=a.usWebToolkit.util.encode64(c,e);else return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1})):(n.readAsArrayBuffer(m),n.addEventListener("load",function(){var c=n.result,e=null;try{var d=String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(c)));try{e=decodeURIComponent(escape(d))}catch(g){if(g instanceof URIError)e=d;else throw g;}}catch(h){return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1}c=e.length;if(m.size===c)f=a.usWebToolkit.util.encode64(e,c);else return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1}))}else return setTimeout(function(){d.focus()},10),!1}else return setTimeout(function(){d.focus()},10),!1}else{if("msie"==a.browserName&&8===parseInt(a.browserVersion))k=document.getElementById("us-div-cert-select"),k.onselectstart=function(){return!0},c.select(),e=c.value,c.style.display="none",k.onselectstart=function(){return!1};else if("msie"==a.browserName&&9===parseInt(a.browserVersion)){if(e=c.value,-1<e.indexOf("fakepath"))return a.uiUtil().msgBox(b.IDS_MSGBOX_SEARCH_CERT_GUIDE_FOR_IE9),setTimeout(function(){d.focus()},10),!1}else e=c.value,p.log("file full path : ",e);if(!1==M(e,b))return setTimeout(function(){d.focus()},10),!1}Dialog=a.loadUI("password")({type:null,args:null,onConfirm:function(a){var c=!1,c=null!=e?Z(e,a,b):$(f,a,b);a="";Dialog.dispose();!0===c?setTimeout(function(){g.focus()},10):setTimeout(function(){d.focus()},10)},onCancel:function(){Dialog.dispose();setTimeout(function(){d.focus()},10)}});Dialog.show();return!0}function ca(c){function b(){N++;N>=a.ESVS.LimitNumOfTimesToTryToInputPW?a.ESVS.Embedded?(f.value="",setTimeout(function(){f.focus()},10)):(a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_OVER_NUMBER_OF_ALLOWED_BEFORE+a.ESVS.LimitNumOfTimesToTryToInputPW+e.IDS_MSGBOX_PW_ERROR_OVER_NUMBER_OF_ALLOWED_AFTER),G()):(f.value="",setTimeout(function(){f.focus()},10))}k.restoreOnMouseEvent();if(!c)return!1;var e=c,f=document.getElementById("us-pw-text");if(a.CONST.__USFB_M_MOBILETOKEN.device!=l&&(!a.certsList||0>k.selectedIndex()))return a.uiUtil().msgBox(e.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),f.value="",setTimeout(function(){f.focus()},10),!1;if(1&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==l){if(!f.value)return a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),setTimeout(function(){f.focus()},10),!1;if(a.plugin().valid){var h=parseInt(k.selectedIndex()),d=0;l===a.CONST.__USFB_M_HSMKEY.device&&0<t||(d=a.plugin().CheckUserCertPassword(h,f.value));if(0!=d)a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED),b();else{d=a.plugin().SetCurrentUserCert(h,f.value);if(0!=d){h=a.plugin().GetLastErrorCode();d=a.plugin().GetLastErrorMessage();p.log("***** SetCurrentUserCert *****");p.log("Err Code : ",h,"\nErr Msg : ",d);switch(h){case 4823E4:a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SEC_TOKEN_PIN);b();break;case 4825E4:a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_SEC_TOKEN_PIN_LOCKED);b();break;default:a.uiUtil().errMsgBox("Fail to set the certificate",h)}return!1}"VID_VERIFICATION"!=g.type&&(f.value="");if("DIGITAL_SIGNATURE_P1"==g.type){d=a.certsList.list[h-1].cert;if(!d||0>=d.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),!1;a.usWebToolkit.x509Certificate.parser(d,"Base64");h=a.usWebToolkit.x509Certificate.getSubjectName();if(!h||0>=h.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-2),!1;g.onConfirm(d,h,e.IDS_MSGBOX_SIGN_ERROR)}else if("DIGITAL_SIGNATURE_P7"==g.type){d=a.certsList.list[h-1].cert;if(!d||0>=d.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),!1;d=a.certUtil().getTheCertAttributes(d,"Base64");g.onConfirm(e.IDS_MSGBOX_SIGN_ERROR,d)}else if("DIGITAL_SIGNATURE_P7_EXT"==g.type||"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==g.type)g.onConfirm(e.IDS_MSGBOX_SIGN_ERROR,h);else if("CERT_RENEWAL"==g.type){d=a.certsList.list[h-1].cert;if(!d||0>=d.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-1),!1;a.usWebToolkit.x509Certificate.parser(d,"Base64");h=a.usWebToolkit.x509Certificate.getNotAfter();if(!h||0>=h.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-2),!1;g.onConfirm(h,c.IDS_CONFIRMBOX_CERT_RENEWAL)}else if("CERT_REVOCATION"==g.type)g.onConfirm(e.IDS_CONFIRMBOX_CERT_REVOCATION);else if("CERT_SOE"==g.type)g.onConfirm(e.IDS_CONFIRMBOX_CERT_SOE);else if("VID_VERIFICATION"==g.type)g.onConfirm(h,f.value,e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,e.IDS_MSGBOX_VID_ERROR_VERIFICATION),f.value="";else g.onConfirm();a.ESVS.Embedded&&u();return!0}}else f.value="",a.uiUtil().msgBox(e.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD)}else if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==l){if(!a.nimservice())return!1;var n=function(){var b=parseInt(k.selectedIndex());if("DIGITAL_SIGNATURE_P7"===g.type){var d=a.nimservice().GetCert(b);if(!d||0>=d.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),!1;var h=a.certUtil().getTheCertAttributes(d,"Base64");g.onConfirm(e.IDS_MSGBOX_SIGN_ERROR,h,b,f.value,l)}else if("DIGITAL_SIGNATURE_P7_XML"===g.type){d=a.nimservice().GetCert(b);if(!d||0>=d.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),!1;h=a.certUtil().getTheCertAttributes(d,"Base64");g.onConfirm(e.IDS_MSGBOX_SIGN_ERROR,h,b,f.value,l,d)}else if("DIGITAL_SIGNATURE_P1"===g.type){d=a.nimservice().GetCert(b);if(!d||0>=d.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),!1;a.usWebToolkit.x509Certificate.parser(d,"Base64");h=a.usWebToolkit.x509Certificate.getSubjectName();if(!h||0>=h.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-2),!1;g.onConfirm(d,h,e.IDS_MSGBOX_SIGN_ERROR,b,f.value,l)}else if("CERT_RENEWAL"==g.type){d=a.certsList.list[b-1].cert;if(!d||0>=d.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-1),!1;a.usWebToolkit.x509Certificate.parser(d,"Base64");var m=a.usWebToolkit.x509Certificate.getNotAfter();if(!m||0>=m.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-2),!1;g.onConfirm(m,c.IDS_CONFIRMBOX_CERT_RENEWAL,l,t,b)}else if("CERT_REVOCATION"==g.type)g.onConfirm(e.IDS_CONFIRMBOX_CERT_REVOCATION,b,f.value,l,t);else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"===g.type){m={signErr:e.IDS_MSGBOX_SIGN_ERROR,verifySuc:e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:e.IDS_MSGBOX_VID_ERROR_VERIFICATION};d=a.certsList.list[b-1].cert;if(!d||0>=d.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),!1;h=a.certUtil().getTheCertAttributes(d,"Base64");g.onConfirm(b,f.value,m,h,l);f.value=""}else if("DIGITAL_SIGNATURE_P7_FILE"===g.type){d=a.certsList.list[b-1].cert;if(!d||0>=d.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),!1;h=a.certUtil().getTheCertAttributes(d,"Base64");g.onConfirm(b,f.value,e.IDS_MSGBOX_SIGN_ERROR,e.IDS_CONFIRMBOX_FILE_ALREADY_EXIT,h,l)}else if("ENCRYPT_P7"==g.type)g.onConfirm(b,f.value,e.IDS_MSGBOX_ENCRYPT_ERROR);else if("VID_VERIFICATION"===g.type)g.onConfirm(b,f.value,e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,e.IDS_MSGBOX_VID_ERROR_VERIFICATION,"NIM");else if("CERT_RENEWAL_SIGN"==g.type){d=a.certsList.list[b-1].cert;if(!d||0>=d.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-1),!1;a.usWebToolkit.x509Certificate.parser(d,"Base64");m=a.usWebToolkit.x509Certificate.getNotAfter();if(!m||0>=m.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-2),!1;h=a.certUtil().getTheCertAttributes(d,"Base64");g.onConfirm(m,c.IDS_CONFIRMBOX_CERT_RENEWAL,l,t,b,f.value,h)}else g.onConfirm()};if(a.CONST.__USFB_M_MOBILETOKEN.device==l){if("DIGITAL_SIGNATURE_P7"===g.type)g.onConfirm(e.IDS_MSGBOX_SIGN_ERROR,null,-1,"",l);else if("DIGITAL_SIGNATURE_P1"===g.type)g.onConfirm(null,"",e.IDS_MSGBOX_SIGN_ERROR,-1,"",l);else if("CERT_RENEWAL"==g.type)g.onConfirm("",c.IDS_CONFIRMBOX_CERT_RENEWAL,l,t,-1);else if("CERT_REVOCATION"==g.type)g.onConfirm(e.IDS_CONFIRMBOX_CERT_REVOCATION,-1,"",l,t);else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"===g.type)g.onConfirm(-1,"",{signErr:e.IDS_MSGBOX_SIGN_ERROR,verifySuc:e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:e.IDS_MSGBOX_VID_ERROR_VERIFICATION},null,l);else if("DIGITAL_SIGNATURE_P7_FILE"===g.type)g.onConfirm(-1,"",e.IDS_MSGBOX_SIGN_ERROR,e.IDS_CONFIRMBOX_FILE_ALREADY_EXIT,null,l);else if("ENCRYPT_P7"==g.type)g.onConfirm(-1,f.value,e.IDS_MSGBOX_ENCRYPT_ERROR);else if("VID_VERIFICATION"===g.type)g.onConfirm(-1,"",e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,e.IDS_MSGBOX_VID_ERROR_VERIFICATION,"NIM");else g.onConfirm();f.value="";a.ESVS.Embedded&&u();return!0}h=parseInt(k.selectedIndex());if(l==a.CONST.__USFB_M_ETC.device||l==a.CONST.__USFB_M_HSMKEY.device||"DIGITAL_SIGNATURE_P1"!==g.type&&"DIGITAL_SIGNATURE_P7"!==g.type&&"DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"!==g.type&&"VID_VERIFICATION"!==g.type)return n(),f.value="",a.ESVS.Embedded&&u(),!0;if(!f.value)return a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),setTimeout(function(){f.focus()},10),!1;d=a.usWebToolkit.util.encode64("1234");a.nimservice().CheckPassword(h,f.value,d,function(c,d,h,g){if(0==c)return n(),f.value="",a.ESVS.Embedded&&u(),!0;a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED);b();a.uiUtil().loadingBox(!1,"us-div-list-load")})}else{if(!f.value)return a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),setTimeout(function(){f.focus()},10),!1;if(!a.PFUC)return!1;h=parseInt(k.selectedIndex());d=null;try{d=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[h].signpri)}catch(m){p.log("***** encryptedPrivateKeyFromBase64 error *****"),p.log("Err Code : ",m.code,"\nErr Msg : ",m.message)}var r=!1;try{r=a.usWebToolkit.pkcs8.checkUserCertPassword(d,f.value)}catch(q){p.log("***** CheckUserCertPassword error *****"),p.log("Err Code : ",q.code,"\nErr Msg : ",q.message)}finally{d=""}if(!1===r)a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED),b();else{if("DIGITAL_SIGNATURE_P7"===g.type){d=a.PFUC[h].signcert;if(!d||0>=d.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),!1;d=a.certUtil().getTheCertAttributes(d,"Base64");g.onConfirm(e.IDS_MSGBOX_SIGN_ERROR,d,h,f.value,l)}else if("CERT_REVOCATION"===g.type)g.onConfirm(e.IDS_CONFIRMBOX_CERT_REVOCATION,h,f.value);else if("VID_VERIFICATION"===g.type)g.onConfirm(h,f.value,e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,e.IDS_MSGBOX_VID_ERROR_VERIFICATION,"PFS");else g.onConfirm();f.value="";a.ESVS.Embedded&&u();return!0}}return!1}function y(c){if(!c)return!1;B(c,E,"close");for(var b=a.ESVS.Media.list.split("|"),e=0;e<b.length;e++){var f=a.CONST.medias[b[e]];void 0!=f&&null!=f&&(f=document.getElementById("us-btn-"+f.name),void 0!=f&&null!=f&&"us-layout-storage-btn-none"!=f.className&&(f.className=c===f?"us-layout-storage-btn-on":"us-layout-storage-btn-off"))}return!0}function da(c){if(null==c||void 0==c)return!1;var b=!a.uiUtil().isItSupportingThisStorage(c);!1==b&&null!=a.ESVS.Media&&null!=a.ESVS.Media.list&&0>a.ESVS.Media.list.indexOf(c.name)&&(b=!0);if(b)return!1;var b=document.getElementById("us-storage-btn-list"),e=document.createElement("li");e.setAttribute("id","us-storage-btn-li-"+c.name,0);e.setAttribute("mediaIndex",c.mediaIndex,0);7==c.mediaIndex&&(e.className="line-first");"hidden"===c.visibility?(e.style.display="none",e.style.visibility="hidden"):(e.style.display="block",e.style.visibility="visible");var f=document.createElement("button");f.setAttribute("type","button",0);f.setAttribute("id","us-btn-"+c.name,0);f.setAttribute("title",c.label,0);f.setAttribute("tabindex",c.tabIndex,0);c.disabled?(f.onclick=function(){a.uiUtil().msgBox(E.IDS_MSGBOX_NOT_SUPPORTED_MEDIA)},f.className="us-layout-storage-btn-none"):(f.onclick=c.onclick,f.className=c.device===l?"us-layout-storage-btn-on":"us-layout-storage-btn-off");e.appendChild(f);if("harddisk"!==c.name&&"webstorage"!==c.name){var h=document.createElement("span");h.className="us-drive-select";f.appendChild(h)}h=document.createElement("span");h.className="us-img-storage";var d=document.createElement("img");d.setAttribute("id","us-img-"+c.name,0);d.setAttribute("alt",c.label,0);c.disabled?d.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+"_d.png",0):d.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+".png",0);h.appendChild(d);f.appendChild(h);h=document.createElement("span");h.setAttribute("id","us-lbl-"+c.name,0);h.className="us-layout-lbl-storage";h.appendChild(document.createTextNode(c.label));f.appendChild(h);e.appendChild(f);b.appendChild(e);return!0}function B(c,b,e){if("no_more"==e)a.uiUtil().msgBox(b.IDS_MSGBOX_NOT_MORE_MEDIA);else{if(c=document.getElementById("us-storage-wrap"))"open"==e?(c.className="us-layout-storage-more-wrap",c=document.getElementById("us-storage-more-btn"),c.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_HIDDEN+b.IDS_BUTTON,0),c.onclick=function(){B(this,b,"close")},c=document.getElementById("us-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_HIDDEN,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_close.png",0)):(c.className="us-layout-storage-wrap",c=document.getElementById("us-storage-more-btn"),c.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),c.onclick=function(){B(this,b,"open")},c=document.getElementById("us-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0));c=a.ESVS.Media.list.split("|");for(var f=0;f<c.length;f++){var h=a.CONST.medias[c[f]];if(void 0!=h&&null!=h){var d=document.getElementById("us-storage-btn-li-"+h.name);if(void 0!=d&&null!=d){var g=d.getAttribute("mediaIndex");"open"==e?(d.style.display="block",d.style.visibility="visible"):6<g?(d.style.display="none",d.style.visibility="hidden"):(d.style.display="block",d.style.visibility="visible");1==g&&document.getElementById("us-btn-"+h.name)}}}}return!0}function G(){k.restoreOnMouseEvent();g.onCancel()}var ea=function(){var c;c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",a.ESVS.SRCPath+(a.ESVS.Embedded?"unisignweb/rsrc/layout/certselect_embedded.html?version="+a.ver:"unisignweb/rsrc/layout/certselect.html?version="+a.ver),!1);c.send(null);return c.responseText},O=function(){var c;c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/certselect_"+a.ESVS.Language+".js?version="+a.ver,!1);c.send(null);return c.responseText},E=eval(eval(O)()),P=null,k=null,N=0,r=a.ESVS.TabIndex,D=0,l=a.CONST.__USFB_M_HDD.device,t=0;null!=a.ESVS.Media&&null!=a.ESVS.Media.defaultdevice?l=a.uiUtil().getMediaDevice(a.ESVS.Media.defaultdevice):2==a.ESVS.Mode&&(l=a.CONST.__PF_M_LS.device);var p=window.console||{log:function(){}};return function(){var c=eval(ea),b=eval(eval(O)());a.ESVS.TargetObj.innerHTML=c();var e=document.getElementById("us-lbl-title");a.ESVS.Embedded?(c=document.getElementById("us-lbl-title"),c.appendChild(document.createTextNode(b.IDS_CERT_SELECTION+" "+b.IDS_CERT_SELECTION_PURPOSE_SIGN)),c.setAttribute("tabindex",r++,0),c=document.getElementById("us-cursor-disabled"),c.setAttribute("tabindex",r++,0)):(e.appendChild(document.createTextNode(b.IDS_CERT_SELECTION)),e.setAttribute("tabindex",r++,0),c=document.getElementById("us-cls-img-btn"),c.setAttribute("title",b.IDS_CLOSE_CERT_SELECTION_CLOSE,0),c.onclick=function(){G()},document.getElementById("us-cls-btn-img").setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_close_btn.png",0),c=document.getElementById("us-cursor-disabled"),c.setAttribute("title",b.IDS_SENSE_READER_INTRO,0),c=document.getElementById("us-logo-img"),c.setAttribute("alt",b.IDS_LOGO,0),null!=a.options.logo?c.setAttribute("src",a.options.logo,0):c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/main_cert_logo.png",0),c=document.getElementById("us-legend-storage"),c.appendChild(document.createTextNode(b.IDS_STORAGE_SELECT)));for(var c=0,f=a.ESVS.Media.list.split("|"),h=0;h<f.length;h++){var d=a.CONST.medias[f[h]];if(void 0!=d&&null!=d){switch(d.device){case a.CONST.__USFB_M_DISK.device:d.label=b.IDS_STORAGE_REMOVABLE;d.disabled=2==a.ESVS.Mode;d.onclick=function(){T(this,b);y(this)};break;case a.CONST.__USFB_M_HSMKEY.device:d.label=b.IDS_STORAGE_SECTOKEN;d.disabled=!("win"==a.osName&&2!=a.ESVS.Mode);d.onclick=function(){U(this,b);y(this)};break;case a.CONST.__USFB_M_SMARTCARD.device:d.label=b.IDS_STORAGE_SAVETOKEN;d.disabled=!("win"==a.osName&&2!=a.ESVS.Mode);d.onclick=function(){W(this,b);y(this)};break;case a.CONST.__USFB_M_MOBILE.device:d.label=b.IDS_STORAGE_MOBILEPHONE;d.disabled=2==a.ESVS.Mode;d.onclick=function(){X(this,b);y(this)};break;case a.CONST.__USFB_M_HDD.device:d.label=b.IDS_STORAGE_HARDDISK;d.disabled=2==a.ESVS.Mode;d.onclick=function(){if(this&&b)if(l=a.CONST.__USFB_M_HDD.device,t=0,a.certsList&&(a.certsList=null),k.redrawList(null,-1),z(b),u(),4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==l)q("redraw",a.CONST.__USFB_M_HDD.device,0,b,"");else{var c=v(a.CONST.__USFB_M_HDD.device,0,b,"");0!=c?(a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),k.redrawList(null,0)):(c=n())?k.redrawList(c.list,c.list.length):k.redrawList(null,0)}y(this)};break;case a.CONST.__USFB_M_MOBILETOKEN.device:d.label=b.IDS_STORAGE_MOBILETOKEN;d.disabled=2==a.ESVS.Mode;d.onclick=function(){K(this,b);y(this)};break;case a.CONST.__PF_M_LS.device:d.label=b.IDS_STORAGE_LS;d.disabled=1==a.ESVS.Mode;d.onclick=function(){if(this&&b)if(l=a.CONST.__PF_M_LS.device,t=0,a.certsList&&(a.certsList=null),k.redrawList(null,-1),z(b),u(),4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==l)q("redraw",a.CONST.__PF_M_LS.device,0,b,"");else{var c=v(a.CONST.__PF_M_LS.device,0,b,"");0!=c?(a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),k.redrawList(null,0)):(c=n())?k.redrawList(c.list,c.list.length):k.redrawList(null,0)}y(this)};break;case a.CONST.__PF_M_TOUCHSIGN.device:d.label=b.IDS_STORAGE_TOUCHSIGN;d.disabled=!0;d.onclick=function(){A(this,b)};break;case a.CONST.__PF_M_SMARTSIGN.device:d.label=b.IDS_STORAGE_SMARTSIGN;d.disabled=!0;d.onclick=function(){A(this,b)};break;case a.CONST.__PF_M_WEBSECTOKEN.device:d.label=b.IDS_STORAGE_WEBSECTOKEN;d.disabled=!0;d.onclick=function(){A(this,b)};break;case a.CONST.__PF_M_WEBSOFTTOKEN.device:d.label=b.IDS_STORAGE_WEBSOFTTOKEN;d.disabled=!0;d.onclick=function(){A(this,b)};break;default:d.label=b.IDS_STORAGE_ETC,d.disabled=!0,d.onclick=function(){A(this,b)}}d.tabIndex=r;d.mediaIndex=c+1;d.visibility=6<d.mediaIndex?"hidden":"visible";da(d)&&(r++,c++)}}f=document.getElementById("us-storage-more-btn");null!=f&&void 0!=f&&(f.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),6<c?(f.style.display="block",f.style.visibility="visible",f.setAttribute("tabindex",r++,0),f.onclick=function(){B(this,b,"open")}):(f.setAttribute("disabled","disabled",0),f.style.display="none",f.style.visibility="hidden",f.onclick=function(){B(this,b,"no_more")}),c=document.getElementById("us-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0));document.getElementById("us-tbl-list").style.summary=b.IDS_CERT_LIST_TABLE_SUMMARY;document.getElementById("us-tbl-list-caption").appendChild(document.createTextNode(b.IDS_CERT_LIST_CAPTION));var p=[{title:b.IDS_CERT_STATUS},{title:b.IDS_CERT_CLASSIFY},{title:b.IDS_CERT_USER},{title:b.IDS_CERT_ISSUER},{title:b.IDS_CERT_EXPIRATION_DAY}];D=r++;setTimeout(function(){if(p&&b){P=a.loadUI("gridlist");k=P({type:"certslist",tblid:"us-tbl-list",tbltitleid:"us-tbl-list-th",titlelistid:"us-grid-head-div",titlerowid:"us-list-title-row",titleelementid:"us-list-title-element",titledividerid:"us-list-title-divider",titlelistcn:"us-layout-grid-head-div",titlerowcn:"us-layout-grid-head-row",titleelementcn:"us-layout-grid-row-title-element",titledividercn:"us-layout-grid-row-title-divider",tblbodyid:"us-tbl-list-td",datalistid:"us-grid-body-div",datarowid:"us-list-body-row",dataelementid:"us-list-data-element",datalistcn:"us-layout-grid-body-div",datarowcn:"us-layout-grid-body-row",dataelementcn:"us-layout-grid-row-data-element",dataselectcn:"us-layout-grid-row-data-selected-element"});var c=!0;"opera"==a.browserName&&(c=!1);k.drawList(p,p.length,null,0,D,c);4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==l?q("redraw",l,0,b,"",p,c):(c=v(l,0,b,""),0!=c?a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c):(c=n())?k.redrawList(c.list,c.list.length):k.redrawList(null,0))}},100);document.getElementById("us-lbl-pw").appendChild(document.createTextNode(b.IDS_PASSWORD));document.getElementById("us-lbl-pw2").innerHTML=b.IDS_PASSWORD_DESCRIPTION;document.getElementById("us-file-search-hidden").onchange=function(){ba(this,b)};c=document.getElementById("us-cert-search-btn");c.setAttribute("value",b.IDS_CERT_SEARCH,0);c.setAttribute("title",b.IDS_CERT_SEARCH+b.IDS_BUTTON,0);c.onclick=function(){aa(b)};f=document.getElementById("us-pw-text");f.value="";f.onkeydown=function(a){if(a=a?a:event)a=a||window.event,13==(a.which||a.keyCode)&&document.getElementById("us-confirm-btn").click()};a.ESVS.Embedded||(4&a.ESVS.Mode&&("CERT_RENEWAL"==g.type||"CERT_REVOCATION"==g.type)?(document.getElementById("us-div-cert").style.display="none",document.getElementById("disabledpw").innerHTML='<input id="us-confirm-btn" class="us-normal-btn btn-confirm h35" type="button" />'):document.getElementById("enabledpw").innerHTML='<input id="us-confirm-btn" class="us-normal-btn btn-confirm h35" type="button" />');h=document.getElementById("us-confirm-btn");h.setAttribute("value",b.IDS_CONFIRM,0);h.setAttribute("title",b.IDS_CONFIRM+b.IDS_BUTTON,0);h.onclick=function(){ca(b)};var m=document.getElementById("us-cert-verify-btn");m&&(m.setAttribute("value",b.IDS_CERT_VERIFY,0),m.setAttribute("title",b.IDS_CERT_VERIFY+b.IDS_BUTTON,0),m.onclick=function(){R(this,b)});d=document.getElementById("us-cert-view-btn");d.setAttribute("value",b.IDS_CERT_VIEW,0);d.setAttribute("title",b.IDS_CERT_VIEW+b.IDS_BUTTON,0);d.onclick=function(){S(this,b)};var x=document.getElementById("us-cert-proposal-btn");x.setAttribute("value",b.IDS_CERT_PROPOSAL,0);x.setAttribute("title",b.IDS_CERT_PROPOSAL+b.IDS_BUTTON,0);x.onclick=function(){this&&("firefox"==a.browserName?window.open("https://raadmin.crosscert.com/customer/tk/Main.jsp?","crosscert_url","scrollbars=1"):window.open("https://raadmin.crosscert.com/customer/tk/Main.jsp?"),this.focus())};if(a.ESVS.Embedded)f.setAttribute("tabindex",r++,0),h.setAttribute("tabindex",r++,0),c.setAttribute("tabindex",r++,0),x.setAttribute("tabindex",r++,0),d.setAttribute("tabindex",r++,0),m&&m.setAttribute("tabindex",r++,0);else{f.setAttribute("tabindex",r++,0);"none"!=document.getElementById("us-div-cert").style.display&&h.setAttribute("tabindex",r++,0);c.setAttribute("tabindex",r++,0);x.setAttribute("tabindex",r++,0);d.setAttribute("tabindex",r++,0);m&&m.setAttribute("tabindex",r++,0);"none"==document.getElementById("us-div-cert").style.display&&h.setAttribute("tabindex",r++,0);var w=document.getElementById("us-cls-btn");w.setAttribute("value",b.IDS_CLOSE,0);w.setAttribute("title",b.IDS_CLOSE+b.IDS_BUTTON,0);w.setAttribute("tabindex",r++,0);w.onclick=function(){G()};w.onkeydown=function(a){a=a||window.event;var b=a.which||a.keyCode;9==b&&a.shiftKey&&(w.onblur=function(){setTimeout(function(){m.focus()},10)});9!=b||a.shiftKey||(w.onblur=function(){setTimeout(function(){e.focus()},10)})};e.onkeydown=function(a){a=a||window.event;var b=a.which||a.keyCode;9==b&&a.shiftKey&&(e.onblur=function(){setTimeout(function(){w.focus()},10)});if(9==b&&!a.shiftKey){var c=document.getElementById("us-btn-mobiletoken");e.onblur=function(){setTimeout(function(){c.focus()},10)}}};document.getElementById("us-lbl-notice").appendChild(document.createTextNode(b.IDS_NOTICE))}null!=a.options.popup&&(document.getElementById("us-div-cert-select").className=document.getElementById("us-div-cert-select").className+" popup");return document.getElementById("us-div-cert-select")}()};return function(g){var n=H({type:g.type,args:g.args,onConfirm:g.onConfirm,onCancel:g.onCancel});if(!a.ESVS.Embedded&&null==a.options.popup){g=a.uiLayerLevel;var q=a.uiUtil().getOverlay(g);n.style.zIndex=g+1;document.body.insertBefore(q,document.body.firstChild)}var v=window.onresize;return{show:function(){a.ESVS.Embedded?(n.style.left=a.uiUtil().getScrollLeft()+(a.uiUtil().getViewportWidth()-a.uiUtil().getNumSize(a.uiUtil().getStyle(n,"width","width")))/2+"px",n.style.display="block"):null==a.options.popup?(draggable(n,document.getElementById("us-div-title")),q.style.display="block",a.uiUtil().offsetResize(n)):a.uiUtil().offsetResize(n,a.options.popup);window.onresize=a.ESVS.Embedded?function(){n&&(n.style.left=a.uiUtil().getScrollLeft()+(a.uiUtil().getViewportWidth()-a.uiUtil().getNumSize(a.uiUtil().getStyle(n,"width","width")))/2+"px");v&&v()}:function(){n&&a.uiUtil().offsetResize(n,a.options.popup);v&&v()};a.uiLayerLevel+=10;a.ESVS.TabIndex+=30;setTimeout(function(){a:for(var g=a.ESVS.Media.list.split("|"),n=0;n<g.length;n++){var q=a.CONST.medias[g[n]];if(void 0!=q&&null!=q&&(q=document.getElementById("us-btn-"+q.name),"us-layout-storage-btn-on"==q.className)){q.focus();break a}}},10)},hide:function(){a.ESVS.Embedded||(q.style.display="none",n.style.display="none")},dispose:function(){window.onresize=function(){v&&v()};if(!a.ESVS.Embedded&&null==a.options.popup){var g=n.parentNode;g&&g.removeChild(n);q.parentNode&&q.parentNode.removeChild(q);a.uiLayerLevel-=10;a.ESVS.TabIndex-=30}}}}};