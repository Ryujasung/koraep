(function(){function t(h){"undefined"===typeof BigInteger&&(BigInteger=h.jsbn.BigInteger);var a=h.asn1,m=h.jsustoolkitErrCode=h.jsustoolkitErrCode||{},g=h.pki=h.pki||{},p=g.oids,u=h.pkcs8=h.pkcs8||{},x=h.x509Certificate=h.x509Certificate||{},l={};l.cn=p.commonName;l.commonName="cn";l.c=p.countryName;l.countryName="c";l.l=p.localityName;l.localityName="l";l.s=p.stateOrProvinceName;l.stateOrProvinceName="s";l.o=p.organizationName;l.organizationName="o";l.ou=p.organizationalUnitName;l.organizationalUnitName="ou";l.e=p.emailAddress;l.emailAddress="e";l.street=p.street;l.street="street";l.serialNumber=p.serialName;l.serialName="serialNumber";l.dnQualifier=p.dnQualifier;l.dnQualifier="dnQualifier";l.dc=p.domailComponent;l.domailComponent="dc";var t={name:"SubjectPublicKeyInfo",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:a.Class.UNIVERSAL,type:a.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:a.Class.UNIVERSAL,type:a.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},v={name:"RSAPublicKey",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:a.Class.UNIVERSAL,type:a.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:a.Class.UNIVERSAL,type:a.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},D={name:"Certificate",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:a.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:a.Class.UNIVERSAL,type:a.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:a.Class.UNIVERSAL,type:a.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:a.Class.UNIVERSAL,type:a.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:a.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:a.Class.UNIVERSAL,type:a.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:a.Class.UNIVERSAL,type:a.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:a.Class.UNIVERSAL,type:a.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:a.Class.UNIVERSAL,type:a.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},t,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:a.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:a.Class.UNIVERSAL,type:a.Type.BITSTRING,constructed:!1,capture:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:a.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:a.Class.UNIVERSAL,type:a.Type.BITSTRING,constructed:!1,capture:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:a.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:a.Class.UNIVERSAL,type:a.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:a.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:a.Class.UNIVERSAL,type:a.Type.BITSTRING,constructed:!1,capture:"certSignature"}]},E={name:"RSAPrivateKey",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:a.Class.UNIVERSAL,type:a.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:a.Class.UNIVERSAL,type:a.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:a.Class.UNIVERSAL,type:a.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:a.Class.UNIVERSAL,type:a.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:a.Class.UNIVERSAL,type:a.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:a.Class.UNIVERSAL,type:a.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:a.Class.UNIVERSAL,type:a.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:a.Class.UNIVERSAL,type:a.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:a.Class.UNIVERSAL,type:a.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},F={name:"rsapss",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:a.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:a.Class.UNIVERSAL,type:a.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:a.Class.UNIVERSAL,type:a.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:a.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:a.Class.UNIVERSAL,type:a.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:a.Class.UNIVERSAL,type:a.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:a.Class.UNIVERSAL,type:a.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:a.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:a.Class.UNIVERSAL,type:a.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:a.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:a.Class.UNIVERSAL,type:a.Class.INTEGER,constructed:!1,capture:"trailer"}]}]};g.RDNAttributesAsArray=function(b,c){if(null==b||"undefined"==typeof b)throw{code:"112001",message:m["112001"]};for(var d=[],e,n,f,g=0;g<b.value.length;++g){e=b.value[g];for(var k=0;k<e.value.length;++k)f={},n=e.value[k],f.type=a.derToOid(n.value[0].value),f.value=n.value[1].value,f.valueTagClass=n.value[1].type,f.type in p&&(f.name=p[f.type],f.name in l&&(f.shortName=l[f.name])),c&&(c.update(f.type),c.update(f.value)),d.push(f)}return d};var A=function(a,c){c.constructor==String&&(c={shortName:c});for(var d=null,e,n=0;null===d&&n<a.attributes.length;++n)e=a.attributes[n],c.type&&c.type===e.type?d=e:c.name&&c.name===e.name?d=e:c.shortName&&c.shortName===e.shortName&&(d=e);return d},G=/-----BEGIN [^-]+-----([A-Za-z0-9+/=\s]+)-----END [^-]+-----/;g.pemToDer=function(a){if(null==a||"undefined"==typeof a)throw{code:"112002",message:m["112002"]};var c=null;if(a=G.exec(a))c=h.util.createBuffer(h.util.decode64(a[1]));else throw"Invalid PEM format";return c};g.base64ToDer=function(a){if(null==a||"undefined"==typeof a)throw{code:"112003",message:m["112003"]};var c=null;return c=h.util.createBuffer(h.util.decode64(a))};var y=function(b,c){var d=null,d=g.pemToDer(b),d=a.fromDer(d);return d=c(d)},z=function(b,c){var d=null,d=g.base64ToDer(b),d=a.fromDer(d);return d=c(d)},r=function(a){a=h.util.bytesToHex(h.util.hexToBytes(a.toString(16)));"8"<=a[0]&&(a="00"+a);return h.util.hexToBytes(a)},B=function(b,c,d){var e={};if(b!==p["RSASSA-PSS"])return e;d&&(e={hash:{algorithmOid:p.sha1},mgf:{algorithmOid:p.mgf1,hash:{algorithmOid:p.sha1}},saltLength:20});b={};d=[];if(!a.validate(c,F,b,d))throw{code:"112004",message:m["112004"]+"("+d+")"};void 0!==b.hashOid&&(e.hash=e.hash||{},e.hash.algorithmOid=a.derToOid(b.hashOid));void 0!==b.maskGenOid&&(e.mgf=e.mgf||{},e.mgf.algorithmOid=a.derToOid(b.maskGenOid),e.mgf.hash=e.mgf.hash||{},e.mgf.hash.algorithmOid=a.derToOid(b.maskGenHashOid));void 0!==b.saltLength&&(e.saltLength=b.saltLength.charCodeAt(0));return e};g.certificateFromPem=function(a,c){if(null==a||"undefined"==typeof a)throw{code:"112005",message:m["112005"]};return y(a,function(a){return g.certificateFromAsn1(a,c)})};g.certificateFromBase64=function(a,c){if(null==a||"undefined"==typeof a)throw{code:"112006",message:m["112006"]};return z(a,function(a){return g.certificateFromAsn1(a,c)})};g.certificateToPem=function(b,c){if(null==b||"undefined"==typeof b)throw{code:"112007",message:m["112007"]};var d=a.toDer(g.certificateToAsn1(b)),d=h.util.encode64(d.getBytes(),c||64);return"-----BEGIN CERTIFICATE-----\r\n"+d+"\r\n-----END CERTIFICATE-----"};g.certificateToBase64=function(b){if(null==b||"undefined"==typeof b)throw{code:"112008",message:m["112008"]};b=a.toDer(g.certificateToAsn1(b));return h.util.encode64(b.getBytes())};g.publicKeyFromPem=function(a){if(null==a||"undefined"==typeof a)throw{code:"112009",message:m["112009"]};return y(a,g.publicKeyFromAsn1)};g.publicKeyToPem=function(b,c){if(null==b||"undefined"==typeof b)throw{code:"112010",message:m["112010"]};var d=a.toDer(g.publicKeyToAsn1(b)),d=h.util.encode64(d.getBytes(),c||64);return"-----BEGIN PUBLIC KEY-----\r\n"+d+"\r\n-----END PUBLIC KEY-----"};g.privateKeyFromPem=function(a){if(null==a||"undefined"==typeof a)throw{code:"112011",message:m["112011"]};return y(a,g.privateKeyFromAsn1)};g.privateKeyToPem=function(b,c){if(null==b||"undefined"==typeof b)throw{code:"112012",message:m["112012"]};var d=a.toDer(g.privateKeyToAsn1(b)),d=h.util.encode64(d.getBytes(),c||64);return"-----BEGIN RSA PRIVATE KEY-----\r\n"+d+"\r\n-----END RSA PRIVATE KEY-----"};g.publicKeyFromBase64=function(a){if(null==pem||"undefined"==typeof pem)throw{code:"112013",message:m["112013"]};return z(pem,g.publicKeyFromAsn1)};g.publicKeyToBase64=function(b){if(null==b||"undefined"==typeof b)throw{code:"112014",message:m["112014"]};b=a.toDer(g.publicKeyToAsn1(b));return h.util.encode64(b.getBytes())};g.privateKeyFromBase64=function(a){if(null==a||"undefined"==typeof a)throw{code:"112015",message:m["112013"]};return z(a,g.privateKeyFromAsn1)};g.privateKeyToBase64=function(b){if(null==b||"undefined"==typeof b)throw{code:"112016",message:m["112016"]};b=a.toDer(g.privateKeyToAsn1(b));return h.util.encode64(b.getBytes())};g.createCertificate=function(){var b={version:2,serialNumber:"00",signatureOid:null,signature:null,siginfo:{}};b.siginfo.algorithmOid=null;b.validity={};b.validity.notBefore=new Date;b.validity.notAfter=new Date;b.issuer={};b.issuer.getField=function(a){return A(b.issuer,a)};b.issuer.addField=function(a){c([a]);b.issuer.attributes.push(a)};b.issuer.attributes=[];b.issuer.hash=null;b.subject={};b.subject.getField=function(a){return A(b.subject,a)};b.subject.addField=function(a){c([a]);b.subject.attributes.push(a)};b.subject.attributes=[];b.subject.hash=null;b.extensions=[];b.publicKey=null;b.md=null;var c=function(a){for(var b,c=0;c<a.length;++c){b=a[c];"undefined"===typeof b.name&&(b.type&&b.type in g.oids?b.name=g.oids[b.type]:b.shortName&&b.shortName in l&&(b.name=g.oids[l[b.shortName]]));if("undefined"===typeof b.type)if(b.name&&b.name in g.oids)b.type=g.oids[b.name];else throw{code:"112017",message:m["112017"]+"("+b+")"};"undefined"===typeof b.shortName&&b.name&&b.name in l&&(b.shortName=l[b.name]);if("undefined"===typeof b.value)throw{code:"112018",message:m["112018"]+"("+b+")"};}};b.setSubject=function(a,e){if(null==a||"undefined"==typeof a)throw{code:"112019",message:m["112019"]};c(a);b.subject.attributes=a;delete b.subject.uniqueId;e&&(b.subject.uniqueId=e);b.subject.hash=null};b.setIssuer=function(a,e){if(null==a||"undefined"==typeof a)throw{code:"112020",message:m["112020"]};c(a);b.issuer.attributes=a;delete b.issuer.uniqueId;e&&(b.issuer.uniqueId=e);b.issuer.hash=null};b.setExtensions=function(d){if(null==d||"undefined"==typeof d)throw{code:"112021",message:m["112021"]};for(var e,c=0;c<d.length;++c){e=d[c];"undefined"===typeof e.name&&e.id&&e.id in g.oids&&(e.name=g.oids[e.id]);if("undefined"===typeof e.id)if(e.name&&e.name in g.oids)e.id=g.oids[e.name];else throw{code:"112022",message:m["112022"]+"("+e.name+")"};if("undefined"===typeof e.value){if("keyUsage"===e.name){var f=0,q=0,k=0;e.digitalSignature&&(q|=128,f=7);e.nonRepudiation&&(q|=64,f=6);e.keyEncipherment&&(q|=32,f=5);e.dataEncipherment&&(q|=16,f=4);e.keyAgreement&&(q|=8,f=3);e.keyCertSign&&(q|=4,f=2);e.cRLSign&&(q|=2,f=1);e.encipherOnly&&(q|=1,f=0);e.decipherOnly&&(k|=128,f=7);f=String.fromCharCode(f);0!==k?f+=String.fromCharCode(q)+String.fromCharCode(k):0!==q&&(f+=String.fromCharCode(q));e.value=a.create(a.Class.UNIVERSAL,a.Type.BITSTRING,!1,f)}else if("basicConstraints"===e.name)e.value=a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[]),e.cA&&e.value.value.push(a.create(a.Class.UNIVERSAL,a.Type.BOOLEAN,!1,String.fromCharCode(255))),e.pathLenConstraint&&(f=e.pathLenConstraint,q=h.util.createBuffer(),q.putInt(f,f.toString(2).length),e.value.value.push(a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,q.getBytes())));else if("subjectAltName"===e.name||"issuerAltName"===e.name)for(e.value=a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[]),k=0;k<e.altNames.length;++k)q=e.altNames[k],f=q.value,8===q.type&&(f=a.oidToDer(f)),e.value.value.push(a.create(a.Class.CONTEXT_SPECIFIC,q.type,!1,f));if("undefined"===typeof e.value)throw{code:"112023",message:m["112023"]};}}b.extensions=d};b.getExtension=function(a){if(null==a||"undefined"==typeof a)throw{code:"112024",message:m["112024"]};a.constructor==String&&(a={name:a});for(var e=null,c,f=0;null===e&&f<b.extensions.length;++f)c=b.extensions[f],a.id&&c.id===a.id?e=c:a.name&&c.name===a.name&&(e=c);return e};b.sign=function(d){if(null==d||"undefined"==typeof d)throw{code:"112025",message:m["112025"]};b.signatureOid=p.sha1WithRSAEncryption;b.siginfo.algorithmOid=p.sha1WithRSAEncryption;b.md=h.md.sha1.create();b.tbsCertificate=g.getTBSCertificate(b);var e=a.toDer(b.tbsCertificate);b.md.update(e.getBytes());b.signature=d.sign(b.md)};b.verify=function(d){if(null==d||"undefined"==typeof d)throw{code:"112026",message:m["112026"]};var e=!1,c=d.md;if(null===c){if(b.signatureOid in p)switch(p[b.signatureOid]){case "sha1WithRSAEncryption":c=h.md.sha1.create();break;case "kcdsaWithSHA1":b.md=h.md.sha1.create();break;case "md5WithRSAEncryption":c=h.md.md5.create();break;case "sha256WithRSAEncryption":c=h.md.sha256.create();break;case "RSASSA-PSS":c=h.md.sha256.create()}if(null===c)throw{code:"112027",message:m["112027"]+"("+b.signatureOid+")"};var f=d.tbsCertificate||g.getTBSCertificate(d),f=a.toDer(f);c.update(f.getBytes())}if(null!==c){e=void 0;switch(d.signatureOid){case p.sha1WithRSAEncryption:e=void 0;break;case p["RSASSA-PSS"]:e=p[d.signatureParameters.mgf.hash.algorithmOid];if(void 0===e||void 0===h.md[e])throw{code:"112028",message:m["112028"]+"(oid:"+d.signatureParameters.mgf.hash.algorithmOid+")"};f=p[d.signatureParameters.mgf.algorithmOid];if(void 0===f||void 0===h.mgf[f])throw{code:"112029",message:m["112029"]+"(oid:"+d.signatureParameters.mgf.algorithmOid+")"};f=h.mgf[f].create(h.md[e].create());e=p[d.signatureParameters.hash.algorithmOid];if(void 0===e||void 0===h.md[e])throw{code:"112030",message:m["112030"]+"(oid:"+d.signatureParameters.hash.algorithmOid+")"};e=h.pss.create(h.md[e].create(),f,d.signatureParameters.saltLength)}e=b.publicKey.verify(c.digest().getBytes(),d.signature,e)}return e};b.isIssuer=function(a){if(null==a||"undefined"==typeof a)throw{code:"112031",message:m["112031"]};var e=!1,c=b.issuer;a=a.subject;if(c.hash&&a.hash)e=c.hash===a.hash;else if(c.attributes.length===a.attributes.length)for(var e=!0,f,g,k=0;e&&k<c.attributes.length;++k)if(f=c.attributes[k],g=a.attributes[k],f.type!==g.type||f.value!==g.value)e=!1;return e};return b};g.certificateFromAsn1=function(b,c){if(null==b||"undefined"==typeof b)throw{code:"112032",message:m["112032"]};var d={},e=[];if(!a.validate(b,D,d,e))throw{code:"112033",message:m["112033"]+e};var e=a.derToOid(d.publicKeyOid),n=g.createCertificate();n.version=d.certVersion?d.certVersion.charCodeAt(0):0;var f=h.util.createBuffer(d.certSerialNumber);n.serialNumber=f.toHex();n.signatureOid=h.asn1.derToOid(d.certSignatureOid);n.signatureParameters=B(n.signatureOid,d.certSignatureParams,!0);n.siginfo.algorithmOid=h.asn1.derToOid(d.certinfoSignatureOid);n.siginfo.parameters=B(n.siginfo.algorithmOid,d.certinfoSignatureParams,!1);f=h.util.createBuffer(d.certSignature);++f.read;n.signature=f.getBytes();f=[];void 0!==d.certValidity1UTCTime&&f.push(a.utcTimeToDate(d.certValidity1UTCTime));void 0!==d.certValidity2GeneralizedTime&&f.push(a.generalizedTimeToDate(d.certValidity2GeneralizedTime));void 0!==d.certValidity3UTCTime&&f.push(a.utcTimeToDate(d.certValidity3UTCTime));void 0!==d.certValidity4GeneralizedTime&&f.push(a.generalizedTimeToDate(d.certValidity4GeneralizedTime));if(2<f.length)throw{code:"112035",message:m["112035"]};if(2>f.length)throw{code:"112036",message:m["112036"]};n.validity.notBefore=f[0];n.validity.notAfter=f[1];n.publicKeyOid=h.asn1.derToOid(d.publicKeyOid);n.tbsCertificate=d.tbsCertificate;if(c){n.md=null;if(n.signatureOid in p)switch(e=p[n.signatureOid],e){case "sha1WithRSAEncryption":n.md=h.md.sha1.create();break;case "kcdsaWithSHA1":n.md=h.md.sha1.create();break;case "md5WithRSAEncryption":n.md=h.md.md5.create();break;case "sha256WithRSAEncryption":n.md=h.md.sha256.create();break;case "RSASSA-PSS":n.md=h.md.sha256.create()}if(null===n.md)throw{code:"112037",message:m["112037"]+"(signatureOid:"+n.signatureOid+")"};f=a.toDer(n.tbsCertificate);n.md.update(f.getBytes())}f=h.md.sha1.create();n.issuer.attributes=g.RDNAttributesAsArray(d.certIssuer,f);d.certIssuerUniqueId&&(n.issuer.uniqueId=d.certIssuerUniqueId);n.issuer.hash=f.digest().toHex();f=h.md.sha1.create();n.subject.attributes=g.RDNAttributesAsArray(d.certSubject,f);d.certSubjectUniqueId&&(n.subject.uniqueId=d.certSubjectUniqueId);n.subject.hash=f.digest().toHex();if(d.certExtensions){for(var f=d.certExtensions,q=[],k,l,r,t=0;t<f.value.length;++t){r=f.value[t];for(var u=0;u<r.value.length;++u){l=r.value[u];k={};k.id=a.derToOid(l.value[0].value);k.critical=!1;l.value[1].type===a.Type.BOOLEAN?(k.critical=0!==l.value[1].value.charCodeAt(0),k.value=l.value[2].value):k.value=l.value[1].value;if(k.id in p)if(k.name=p[k.id],"keyUsage"===k.name){l=a.fromDer(k.value);var s=0,w=0;1<l.value.length&&(s=l.value.charCodeAt(1),w=2<l.value.length?l.value.charCodeAt(2):0);k.digitalSignature=128==(s&128);k.nonRepudiation=64==(s&64);k.keyEncipherment=32==(s&32);k.dataEncipherment=16==(s&16);k.keyAgreement=8==(s&8);k.keyCertSign=4==(s&4);k.cRLSign=2==(s&2);k.encipherOnly=1==(s&1);k.decipherOnly=128==(w&128)}else if("basicConstraints"===k.name)l=a.fromDer(k.value),k.cA=0<l.value.length?0!==l.value[0].value.charCodeAt(0):!1,1<l.value.length&&(l=h.util.createBuffer(l.value[1].value),k.pathLenConstraint=l.getInt(l.length()<<3));else if("subjectAltName"===k.name||"issuerAltName"===k.name)for(k.altNames=[],l=a.fromDer(k.value),w=0;w<l.value.length;++w){var s=l.value[w],v={type:s.type,value:s.value};k.altNames.push(v);switch(s.type){case 8:v.oid=a.derToOid(s.value)}}q.push(k)}}n.extensions=q}else n.extensions=[];e==g.oids.RSAEncryption?(n.publicKey=g.publicKeyFromAsn1(d.subjectPublicKeyInfo),n.rsaPublicKey=g.rsaPublicKeyToAsn1(n.publicKey)):n.publicKey=d.subjectPublicKeyInfo.value[1];return n};_dnToAsn1=function(b){var c=a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[]),d;b=b.attributes;for(var e=0;e<b.length;++e){d=b[e];var g=d.value,f=a.Type.PRINTABLESTRING;"valueTagClass"in d&&(f=d.valueTagClass);d=a.create(a.Class.UNIVERSAL,a.Type.SET,!0,[a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(d.type).getBytes()),a.create(a.Class.UNIVERSAL,f,!1,g)])]);c.value.push(d)}return c};_extensionsToAsn1=function(b){var c=a.create(a.Class.CONTEXT_SPECIFIC,3,!0,[]),d=a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[]);c.value.push(d);for(var e,g,f=0;f<b.length;++f){e=b[f];g=a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[]);d.value.push(g);g.value.push(a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(e.id).getBytes()));e.critical&&g.value.push(a.create(a.Class.UNIVERSAL,a.Type.BOOLEAN,!1,String.fromCharCode(255)));var h=e.value;e.value.constructor!=String&&(h=a.toDer(h).getBytes());g.value.push(a.create(a.Class.UNIVERSAL,a.Type.OCTETSTRING,!1,h))}return c};var C=function(b,c){switch(b){case p["RSASSA-PSS"]:var d=[];void 0!==c.hash.algorithmOid&&d.push(a.create(a.Class.CONTEXT_SPECIFIC,0,!0,[a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(c.hash.algorithmOid).getBytes()),a.create(a.Class.UNIVERSAL,a.Type.NULL,!1,"")])]));void 0!==c.mgf.algorithmOid&&d.push(a.create(a.Class.CONTEXT_SPECIFIC,1,!0,[a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(c.mgf.algorithmOid).getBytes()),a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(c.mgf.hash.algorithmOid).getBytes()),a.create(a.Class.UNIVERSAL,a.Type.NULL,!1,"")])])]));void 0!==c.saltLength&&d.push(a.create(a.Class.CONTEXT_SPECIFIC,2,!0,[a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,String.fromCharCode(c.saltLength))]));return a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,d);default:return a.create(a.Class.UNIVERSAL,a.Type.NULL,!1,"")}};g.getTBSCertificate=function(b){var c=a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.CONTEXT_SPECIFIC,0,!0,[a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,String.fromCharCode(b.version))]),a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,h.util.hexToBytes(b.serialNumber)),a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(b.siginfo.algorithmOid).getBytes()),C(b.siginfo.algorithmOid,b.siginfo.parameters)]),_dnToAsn1(b.issuer),a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.UTCTIME,!1,a.dateToUtcTime(b.validity.notBefore)),a.create(a.Class.UNIVERSAL,a.Type.UTCTIME,!1,a.dateToUtcTime(b.validity.notAfter))]),_dnToAsn1(b.subject),g.publicKeyToAsn1(b.publicKey)]);b.issuer.uniqueId&&c.value.push(a.create(a.Class.CONTEXT_SPECIFIC,1,!0,[a.create(a.Class.UNIVERSAL,a.Type.BITSTRING,!1,String.fromCharCode(0)+b.issuer.uniqueId)]));b.subject.uniqueId&&c.value.push(a.create(a.Class.CONTEXT_SPECIFIC,2,!0,[a.create(a.Class.UNIVERSAL,a.Type.BITSTRING,!1,String.fromCharCode(0)+b.subject.uniqueId)]));0<b.extensions.length&&c.value.push(_extensionsToAsn1(b.extensions));return c};g.distinguishedNameToAsn1=function(a){if(null==a||"undefined"==typeof a)throw{code:"112038",message:m["112038"]};return _dnToAsn1(a)};g.certificateToAsn1=function(b){if(null==b||"undefined"==typeof b)throw{code:"112039",message:m["112039"]};var c=b.tbsCertificate||g.getTBSCertificate(b);return a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[c,a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(b.signatureOid).getBytes()),C(b.signatureOid,b.signatureParameters)]),a.create(a.Class.UNIVERSAL,a.Type.BITSTRING,!1,String.fromCharCode(0)+b.signature)])};g.createCaStore=function(b){var c={certs:{},getIssuer:function(b){if(null==b||"undefined"==typeof b)throw{code:"112040",message:m["112040"]};var d=null;new x.certUtil;if(b.issuer.hash in c.certs){d=c.certs[b.issuer.hash];b=h.asn1.fromDer(b.getExtension("authorityKeyIdentifier").value);var f=h.asn1.fromDer(d.getExtension("subjectKeyIdentifier").value).value;if(b.value[0].value!=f)return null;if(b.value[1]){var f=h.util.bytesToHex(a.toDer(b.value[1].value[0].value[0]).getBytes()),l=h.util.bytesToHex(a.toDer(g.distinguishedNameToAsn1(d.issuer)).getBytes());if(f!=l)return null}if(b.value[2]&&h.util.bytesToHex(b.value[2].value)!=d.serialNumber)return null}return d},addCertificate:function(a){if(null==a||"undefined"==typeof a)throw{code:"112041",message:m["112041"]};a.constructor==String&&(a=h.pki.certificateFromPem(a));if(a.subject.hash in c.certs){var b=c.certs[a.subject.hash];b.constructor!=Array&&(b=[b]);b.push(a)}else c.certs[a.subject.hash]=a}};if(b)for(var d=0;d<b.length;++d)c.addCertificate(b[d]);return c};g.certificateError={bad_certificate:"crosscert.pki.BadCertificate",unsupported_certificate:"crosscert.pki.UnsupportedCertificate",certificate_revoked:"crosscert.pki.CertificateRevoked",certificate_expired:"crosscert.pki.CertificateExpired",certificate_unknown:"crosscert.pki.CertificateUnknown",unknown_ca:"crosscert.pki.UnknownCertificateAuthority"};_verifyValidity=function(a,c){new x.certUtil;return a<c.validity.notBefore||a>c.validity.notAfter?!1:!0};g.verifyCertificateChain=function(a,c,d){var e=new Date,m=!1;new x.certUtil;if(_verifyValidity(e,c)){var f=[],l=a.getIssuer(c);if(null===l)error={message:"no parent issuer, so certificate not trusted.",error:g.certificateError.unknown_ca},d(!1,f.length,error.message);else{for(f.push(c);l.issuer.hash!=l.subject.hash;){var k=l;if(_verifyValidity(e,k)){l=a.getIssuer(k);if(null===l){error={message:"no parent issuer, so certificate not trusted.",error:g.certificateError.unknown_ca};break}f.push(k)}else error={message:"Certificate is not valid yet or has expired.",error:g.certificateError.certificate_expired,notBefore:c.validity.notBefore,notAfter:c.validity.notAfter,now:e},d(!1,f.length,error.message)}_verifyValidity(e,l)?f.push(l):(error={message:"Certificate is not valid yet or has expired.",error:g.certificateError.certificate_expired,notBefore:c.validity.notBefore,notAfter:c.validity.notAfter,now:e},d(!1,f.length,error.message));a=[];for(c=f.length-1;0<=c;c--){e=f[c];l=e.getExtension("basicConstraints");k=e.getExtension("keyUsage");null==k||null!=l&&k.keyCertSign||k.digitalSignature||d(!1,f.length,"\ud655\uc7a5\ud0a4 \uc0ac\uc6a9 \ubaa9\uc801  \uac80\uc99d : false");if(c!=f.length-1){l=e.getExtension("certificatePolicies");k={valid_policy:"any-policy",qualifier_set:"empty",criticality_indicator:!1,expected_policy_set:"any-policy",node:[]};if(null!=l&&null!=k){var p=h.asn1.fromDer(l.value);p.value[1]?(k.valid_policy=h.asn1.derToOid(p.value[1].value[0].value),k.qualifier_set=p.value[1].value[1].value):(k.valid_policy=h.asn1.derToOid(p.value[0].value[0].value),k.qualifier_set=p.value[0].value[1].value);k.criticality_indicator=l.critical;"2.5.29.32.0"==k.valid_policy?(k.expected_policy_set=k.valid_policy,a.push(k)):"2.5.29.32.0"==a[a.length-1].expected_policy_set?(k.expected_policy_set=k.valid_policy,a[a.length-1].node.push(k)):(k.expected_policy_set=k.valid_policy,a.push(k))}else a=null;null==a&&d(!1,f.length,"\uc720\ud6a8\ud55c \uc815\ucc45 \ud2b8\ub9ac\uac00 null\uc784. \uac80\uc99d \uc2e4\ud328")}if(c==f.length-1)try{m=e.verify(e)}catch(r){error={message:"Certificate signature is invalid.",error:g.certificateError.bad_certificate},d(!1,f.length,error.message)}else try{m=f[c+1].verify(e)}catch(t){error={message:"Certificate signature is invalid.",error:g.certificateError.bad_certificate},d(!1,f.length,error.message)}}d(m,f.length,f)}}else error={message:"Certificate is not valid yet or has expired.",error:g.certificateError.certificate_expired,notBefore:c.validity.notBefore,notAfter:c.validity.notAfter,now:e},d(!1,0,error.message)};g.publicKeyFromAsn1=function(b){var c={},d=[];if(!a.validate(b,t,c,d))throw{code:"112042",message:m["112042"],errors:d};if(a.derToOid(c.publicKeyOid)==g.oids.RSAEncryption){d=[];if(!a.validate(c.rsaPublicKey,v,c,d))throw{code:"112044",message:m["112044"],errors:d};b=h.util.createBuffer(c.publicKeyModulus).toHex();c=h.util.createBuffer(c.publicKeyExponent).toHex();return g.setRsaPublicKey(new BigInteger(b,16),new BigInteger(c,16))}return a.create(a.Class.UNIVERSAL,a.Type.BITSTRING,!1,String.fromCharCode(0)+c.subjectPublicKeyInfo.value[1].value)};g.publicKeyToAsn1=function(b){if(null==b||"undefined"==typeof b)throw{code:"112045",message:m["112045"]};return a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(g.oids.RSAEncryption).getBytes()),a.create(a.Class.UNIVERSAL,a.Type.NULL,!1,"")]),a.create(a.Class.UNIVERSAL,a.Type.BITSTRING,!1,[a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,r(b.n)),a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,r(b.e))])])])};g.rsaPublicKeyToAsn1=function(b){if(null==b||"undefined"==typeof b)throw{code:"112046",message:m["112046"]};return a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,r(b.n)),a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,r(b.e))])};g.privateKeyFromAsn1=function(b){if(null==b||"undefined"==typeof b)throw{code:"112047",message:m["112047"]};var c={},d=[];a.validate(b,u.privateKeyValidator,c,d)&&(b=a.fromDer(h.util.createBuffer(c.privateKey)));c={};d=[];if(!a.validate(b,E,c,d))throw{code:"112048",message:m["112048"],errors:d};var e,l,f,p,k;b=h.util.createBuffer(c.privateKeyModulus).toHex();d=h.util.createBuffer(c.privateKeyPublicExponent).toHex();e=h.util.createBuffer(c.privateKeyPrivateExponent).toHex();l=h.util.createBuffer(c.privateKeyPrime1).toHex();f=h.util.createBuffer(c.privateKeyPrime2).toHex();p=h.util.createBuffer(c.privateKeyExponent1).toHex();k=h.util.createBuffer(c.privateKeyExponent2).toHex();c=h.util.createBuffer(c.privateKeyCoefficient).toHex();return g.setRsaPrivateKey(new BigInteger(b,16),new BigInteger(d,16),new BigInteger(e,16),new BigInteger(l,16),new BigInteger(f,16),new BigInteger(p,16),new BigInteger(k,16),new BigInteger(c,16))};g.privateKeyToAsn1=function(b){if(null==b||"undefined"==typeof b)throw{code:"112049",message:m["112049"]};return a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,String.fromCharCode(0)),a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,r(b.n)),a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,r(b.e)),a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,r(b.d)),a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,r(b.p)),a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,r(b.q)),a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,r(b.dP)),a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,r(b.dQ)),a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,r(b.qInv))])};g.setRsaPublicKey=g.rsa.setPublicKey;g.setRsaPrivateKey=g.rsa.setPrivateKey}var v="./aes ./asn1 ./jsbn ./md ./oids ./random ./rsa ./util ./jsustoolkitErrCode".split(" "),u=null;"function"!==typeof define&&("object"===typeof module&&module.exports?u=function(h,a){a(require,module)}:(crosscert=window.crosscert=window.crosscert||{},t(crosscert)));(u||"function"===typeof define)&&(u||define)(["require","module"].concat(v),function(h,a){a.exports=function(a){var g=v.map(function(a){return h(a)}).concat(t);a=a||{};a.defined=a.defined||{};if(a.defined.pki)return a.pki;a.defined.pki=!0;for(var p=0;p<g.length;++p)g[p](a);return a.pki}})})();