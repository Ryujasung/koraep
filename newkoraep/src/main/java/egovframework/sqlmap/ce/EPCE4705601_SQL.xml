<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.mapper.ce.ep.EPCE4705601Mapper">
<!-- 입고정정 -->
	
	<!-- 입고정정   조회  -->
	<select id="epce4705601_select4" parameterType="map"  resultType="hashmap">
		<if test='excelYn == null or excelYn == "" '>
			SELECT 
						 *
			 FROM (  
			</if>
					SELECT
								ROW_NUMBER()OVER(ORDER BY E.SEL_ORD, E.BIZRNM, F.BIZRNM, F.BRCH_NM DESC) AS PNO
								,WRHS_DOC_NO
								,RTN_DOC_NO
								,WRHS_CRCT_DOC_NO_RE
								,WRHS_CRCT_DOC_NO
								,WRHS_CRCT_STAT_CD
								,WRHS_CFM_DT
                                ,WRHS_CFM_DT_ORI
								,WRHS_CRCT_STAT_CD_NM
								,MNUL_EXCA_SE_NM
								,E.BIZRNM AS WHSDL_BIZRNM
				                ,PI_DECRYPT(E.BIZRNO) AS WHSDL_BIZRNO
				                ,EPCN_BRCH_NM(WHSDL_BRCH_ID, WHSDL_BRCH_NO, WHSDL_BIZRID, WHSDL_BIZRNO) as WHSDL_BRCH_NM
				                ,F.BIZRNM AS MFC_BIZRNM
				                ,F.BRCH_NM AS MFC_BRCH_NM
								,CRCT_QTY_TOT
			                    ,CRCT_GTN_TOT
			                    ,CRCT_FEE_TOT
			                    ,CRCT_WHSL_FEE_STAX_TOT
			                    ,CRCT_AMT
			                    ,CRCT_QTY_TOT2
			                    ,CRCT_GTN_TOT2
			                    ,CRCT_FEE_TOT2
			                    ,CRCT_WHSL_FEE_STAX_TOT2
			                    ,CRCT_AMT2
			                    ,EXCA_STD_CD
							    ,CRCT_RTN_DT
							    ,CRCT_WRHS_CFM_DT
							    ,MNUL_EXCA_SE
							    ,E.BIZR_TP_CD
							    ,WHSDL_BIZRID
								,WHSDL_BIZRNO AS WHSDL_BIZRNO_ORI
								,WHSDL_BRCH_ID
								,WHSDL_BRCH_NO
								,MFC_BIZRID
								,MFC_BIZRNO
								,MFC_BRCH_ID
								,MFC_BRCH_NO
								,RTN_QTY_TOT

					  FROM (
					  
						<![CDATA[
						 		SELECT
										   NVL(A.WRHS_DOC_NO, B.WRHS_DOC_NO) as WRHS_DOC_NO
										  , A.RTN_DOC_NO
										  , B.WRHS_CRCT_DOC_NO as WRHS_CRCT_DOC_NO_RE
										  , D.WRHS_CRCT_DOC_NO
										  , B.WRHS_CRCT_STAT_CD
                                          , A.WRHS_CFM_DT AS WRHS_CFM_DT_ORI
										  , NVL2(A.WRHS_CFM_DT, '<a href="javascript:dtl_link(1);" target="_self" class="gridLink">'||TO_CHAR(TO_DATE(A.WRHS_CFM_DT, 'yyyymmdd'),'yyyy-mm-dd')||'</a>', TO_CHAR(TO_DATE(A.WRHS_CFM_DT, 'yyyymmdd'),'yyyy-mm-dd')) AS WRHS_CFM_DT 
										  , '<a href="javascript:dtl_link(2);" target="_self" class="gridLink">'||EPCN_ETC_NM(B.WRHS_CRCT_STAT_CD , 'C002')||'</a>'  AS WRHS_CRCT_STAT_CD_NM 		
										  , EPCN_ETC_NM(B.MNUL_EXCA_SE , 'C042') AS MNUL_EXCA_SE_NM
						                  ,D.CRCT_QTY_TOT
						                  ,D.CRCT_GTN_TOT
						                  ,D.CRCT_WHSL_FEE_TOT + D.CRCT_RTL_FEE_TOT AS CRCT_FEE_TOT
						                  ,D.CRCT_WHSL_FEE_STAX_TOT
						                  ,D.CRCT_GTN_TOT + D.CRCT_WHSL_FEE_TOT + D.CRCT_RTL_FEE_TOT + D.CRCT_WHSL_FEE_STAX_TOT AS CRCT_AMT
						                  ,B.CRCT_QTY_TOT AS CRCT_QTY_TOT2
						                  ,B.CRCT_GTN_TOT AS CRCT_GTN_TOT2
						                  ,B.CRCT_WHSL_FEE_TOT + B.CRCT_RTL_FEE_TOT AS CRCT_FEE_TOT2
						                  ,B.CRCT_WHSL_FEE_STAX_TOT AS CRCT_WHSL_FEE_STAX_TOT2
						                  ,B.CRCT_GTN_TOT + B.CRCT_WHSL_FEE_TOT + B.CRCT_RTL_FEE_TOT + B.CRCT_WHSL_FEE_STAX_TOT AS CRCT_AMT2
						                  ,B.EXCA_STD_CD
										  ,B.CRCT_RTN_DT
										  ,B.CRCT_WRHS_CFM_DT
										  ,B.MNUL_EXCA_SE
										  ,NVL(A.MFC_BIZRID, MNUL_MFC_BIZRID) AS MFC_BIZRID
										  ,NVL(A.MFC_BIZRNO, MNUL_MFC_BIZRNO) AS MFC_BIZRNO
										  ,NVL(A.MFC_BRCH_ID, MNUL_MFC_BRCH_ID) AS MFC_BRCH_ID
										  ,NVL(A.MFC_BRCH_NO, MNUL_MFC_BRCH_NO) AS MFC_BRCH_NO
										  ,NVL(A.WHSDL_BIZRID, MNUL_WHSDL_BIZRID) AS WHSDL_BIZRID
										  ,NVL(A.WHSDL_BIZRNO, MNUL_WHSDL_BIZRNO) AS WHSDL_BIZRNO
										  ,NVL(A.WHSDL_BRCH_ID, MNUL_WHSDL_BRCH_ID) AS WHSDL_BRCH_ID
										  ,NVL(A.WHSDL_BRCH_NO, MNUL_WHSDL_BRCH_NO) AS WHSDL_BRCH_NO
										  
										  ,A.RTN_QTY_TOT

								]]>
								 
								 FROM 	  
								 		    (
						                      SELECT     
							                             WRHS_CRCT_DOC_NO
							                             ,WRHS_CRCT_STAT_CD
							                             ,WRHS_DOC_NO
							                             ,EXCA_STD_CD
							                             ,WRHS_CRCT_REG_DT
							                             ,CRCT_RTN_DT
							                             ,CRCT_WRHS_CFM_DT
							                             ,SUM(CRCT_QTY) AS CRCT_QTY_TOT
							                             ,SUM(CRCT_GTN)   AS CRCT_GTN_TOT
							                             ,SUM(CRCT_WHSL_FEE) AS CRCT_WHSL_FEE_TOT
							                             ,SUM(CRCT_WHSL_FEE_STAX) AS CRCT_WHSL_FEE_STAX_TOT
							                             ,SUM(CRCT_RTL_FEE) AS CRCT_RTL_FEE_TOT
							                             ,LK_WRHS_CRCT_DOC_NO
							                             ,MNUL_EXCA_SE
							                             ,MNUL_WHSDL_BIZRID
														 ,MNUL_WHSDL_BIZRNO
														 ,MNUL_WHSDL_BRCH_ID
														 ,MNUL_WHSDL_BRCH_NO
														 ,MNUL_MFC_BIZRID
														 ,MNUL_MFC_BIZRNO
														 ,MNUL_MFC_BRCH_ID
														 ,MNUL_MFC_BRCH_NO
						                       FROM EXCA_WRHS_CRCT
						                     WHERE 1=1
						                         AND EXCA_STD_CD = #{EXCA_STD_CD}
						                         AND MNUL_EXCA_SE IN ('M', 'R') /* 수기정산구분  M:수기등록  R:재정산등록 */
						                     GROUP BY WRHS_CRCT_DOC_NO, WRHS_DOC_NO, WRHS_CRCT_STAT_CD, EXCA_STD_CD, WRHS_CRCT_REG_DT, CRCT_RTN_DT, CRCT_WRHS_CFM_DT
						                     				,LK_WRHS_CRCT_DOC_NO, MNUL_EXCA_SE
						                     				,MNUL_WHSDL_BIZRID
															,MNUL_WHSDL_BIZRNO
															,MNUL_WHSDL_BRCH_ID
															,MNUL_WHSDL_BRCH_NO
															,MNUL_MFC_BIZRID
															,MNUL_MFC_BIZRNO
															,MNUL_MFC_BRCH_ID
															,MNUL_MFC_BRCH_NO
						                   )B
						                   ,(
						                      SELECT     
							                             WRHS_CRCT_DOC_NO
							                             ,WRHS_CRCT_STAT_CD
							                             ,WRHS_DOC_NO
							                             ,CRCT_RTN_DT
							                             ,CRCT_WRHS_CFM_DT
							                             ,SUM(CRCT_QTY) AS CRCT_QTY_TOT
							                             ,SUM(CRCT_GTN)   AS CRCT_GTN_TOT
							                             ,SUM(CRCT_WHSL_FEE) AS CRCT_WHSL_FEE_TOT
							                             ,SUM(CRCT_WHSL_FEE_STAX) AS CRCT_WHSL_FEE_STAX_TOT
							                             ,SUM(CRCT_RTL_FEE) AS CRCT_RTL_FEE_TOT
							                             ,LK_WRHS_CRCT_DOC_NO
						                       FROM EXCA_WRHS_CRCT
						                     WHERE 1=1
						                         AND NVL(MNUL_EXCA_SE,'C') NOT IN ('M', 'R') /* 수기정산구분  M:수기등록  R:재정산등록 */
						                     GROUP BY WRHS_CRCT_DOC_NO, WRHS_DOC_NO, WRHS_CRCT_STAT_CD, EXCA_STD_CD, WRHS_CRCT_REG_DT, CRCT_RTN_DT, CRCT_WRHS_CFM_DT
						                     				,LK_WRHS_CRCT_DOC_NO
						                    ) D
						                    ,(
							                     SELECT A.*
							                     			,G.FH_RTN_QTY_TOT + G.FB_RTN_QTY_TOT + G.DRCT_RTN_QTY_TOT AS RTN_QTY_TOT
							                       FROM EPCM_CFM_MST A
										                    ,EPCM_RTN_MST G
										         WHERE 1=1     
										             AND A.WRHS_DOC_NO = G.WRHS_DOC_NO            
						                    ) A
						          WHERE 1=1
						              AND B.LK_WRHS_CRCT_DOC_NO = D.WRHS_CRCT_DOC_NO(+)
						              AND B.WRHS_DOC_NO = A.WRHS_DOC_NO(+)
		
								<if test="WRHS_CRCT_STAT_CD !=''  and WRHS_CRCT_STAT_CD !=null">
									AND B.WRHS_CRCT_STAT_CD = #{WRHS_CRCT_STAT_CD}
								</if>
							) A
							,EPCN_BIZR_INFO E
							,EPCN_BRCH_INFO F
			 	WHERE 1=1
			 	     AND A.WHSDL_BIZRID = E.BIZRID
		             AND A.WHSDL_BIZRNO = E.BIZRNO
		             AND A.MFC_BIZRID = F.BIZRID
		             AND A.MFC_BIZRNO = F.BIZRNO
		             AND A.MFC_BRCH_ID = F.BRCH_ID
		             AND A.MFC_BRCH_NO = F.BRCH_NO	
		             
		             <if test="MFC_BIZRID !=''  and MFC_BIZRID !=null">
						AND A.MFC_BIZRID 			= #{MFC_BIZRID}
						AND A.MFC_BIZRNO 		= #{MFC_BIZRNO}
					</if>
					<if test="MFC_BRCH_ID !=''  and MFC_BRCH_ID !=null">
						AND A.MFC_BRCH_ID 		= #{MFC_BRCH_ID}
						AND A.MFC_BRCH_NO 	= #{MFC_BRCH_NO}
					</if>
					<if test="BIZR_TP_CD !=''  and BIZR_TP_CD !=null">
						AND E.BIZR_TP_CD 			= #{BIZR_TP_CD}
					</if>
					<if test="WHSDL_BIZRID !=''  and WHSDL_BIZRID !=null">
						AND A.WHSDL_BIZRID 	= #{WHSDL_BIZRID}
						AND A.WHSDL_BIZRNO 	= #{WHSDL_BIZRNO}
					</if>  
					    
					<if test="EXCA_TRGT_SE.equalsIgnoreCase('I')" >   
							 <if test="MFC_BIZRID  ==null ">   
									AND	A.MFC_BIZRID || ';' || A.MFC_BIZRNO IN  
						        <foreach collection="MFC_BIZRNM_RETURN"  item="type"  open="(" close=")" separator=",">
						            #{type.BIZRID_NO}
						        </foreach>
				       		</if>  
		 			</if>	   
		             
	    <if test='excelYn == null or excelYn == "" '>
			           ORDER BY E.SEL_ORD, E.BIZRNM, F.BIZRNM, F.BRCH_NM DESC
			)
			WHERE PNO BETWEEN (#{ROWS_PER_PAGE}*(#{CURRENT_PAGE}-1))+1 AND #{ROWS_PER_PAGE}*#{CURRENT_PAGE}
		</if>	     
	</select>
	
	<!--토탈 조회수-->
	<select id="epce4705601_select4_cnt" parameterType="map" resultType="hashmap">
					SELECT
				 				COUNT(1) as CNT
				 				,SUM(D.CRCT_QTY_TOT) as CRCT_QTY_TOT
				                  ,SUM(D.CRCT_GTN_TOT) as CRCT_GTN_TOT
				                  ,SUM(D.CRCT_WHSL_FEE_TOT + D.CRCT_RTL_FEE_TOT) AS CRCT_FEE_TOT
				                  ,SUM(D.CRCT_WHSL_FEE_STAX_TOT) as CRCT_WHSL_FEE_STAX_TOT
				                  ,SUM(D.CRCT_GTN_TOT + D.CRCT_WHSL_FEE_TOT + D.CRCT_RTL_FEE_TOT + D.CRCT_WHSL_FEE_STAX_TOT) AS CRCT_AMT
				                  ,SUM(B.CRCT_QTY_TOT) AS CRCT_QTY_TOT2
				                  ,SUM(B.CRCT_GTN_TOT) AS CRCT_GTN_TOT2
				                  ,SUM(B.CRCT_WHSL_FEE_TOT + B.CRCT_RTL_FEE_TOT) AS CRCT_FEE_TOT2
				                  ,SUM(B.CRCT_WHSL_FEE_STAX_TOT) AS CRCT_WHSL_FEE_STAX_TOT2
				                  ,SUM(B.CRCT_GTN_TOT + B.CRCT_WHSL_FEE_TOT + B.CRCT_RTL_FEE_TOT + B.CRCT_WHSL_FEE_STAX_TOT) AS CRCT_AMT2
					 FROM 	  
						 		    (
				                      SELECT     
				                             WRHS_CRCT_DOC_NO
				                             ,WRHS_CRCT_STAT_CD
				                             ,WRHS_DOC_NO
				                             ,EXCA_STD_CD
				                             ,WRHS_CRCT_REG_DT
				                             ,CRCT_RTN_DT
				                              ,CRCT_WRHS_CFM_DT
				                              ,SUM(CRCT_QTY) AS CRCT_QTY_TOT
				                              ,SUM(CRCT_GTN)   AS CRCT_GTN_TOT
				                              ,SUM(CRCT_WHSL_FEE) AS CRCT_WHSL_FEE_TOT
				                              ,SUM(CRCT_WHSL_FEE_STAX) AS CRCT_WHSL_FEE_STAX_TOT
				                              ,SUM(CRCT_RTL_FEE) AS CRCT_RTL_FEE_TOT
				                              ,LK_WRHS_CRCT_DOC_NO
				                              ,MNUL_EXCA_SE
				                       FROM 
				                             EXCA_WRHS_CRCT
				                     WHERE 1=1
				                       AND EXCA_STD_CD = #{EXCA_STD_CD}
				                       AND MNUL_EXCA_SE IN ('M', 'R') /* 수기정산구분  M:수기등록  R:재정산등록 */
				                     GROUP BY WRHS_CRCT_DOC_NO, WRHS_DOC_NO, WRHS_CRCT_STAT_CD, EXCA_STD_CD, WRHS_CRCT_REG_DT, CRCT_RTN_DT, CRCT_WRHS_CFM_DT
				                     				, LK_WRHS_CRCT_DOC_NO, MNUL_EXCA_SE
				                   )B
				                   ,(
				                      SELECT     
				                             WRHS_CRCT_DOC_NO
				                             ,WRHS_CRCT_STAT_CD
				                             ,WRHS_DOC_NO
				                             ,EXCA_STD_CD
				                             ,WRHS_CRCT_REG_DT
				                             ,CRCT_RTN_DT
				                              ,CRCT_WRHS_CFM_DT
				                              ,SUM(CRCT_QTY) AS CRCT_QTY_TOT
				                              ,SUM(CRCT_GTN)   AS CRCT_GTN_TOT
				                              ,SUM(CRCT_WHSL_FEE) AS CRCT_WHSL_FEE_TOT
				                              ,SUM(CRCT_WHSL_FEE_STAX) AS CRCT_WHSL_FEE_STAX_TOT
				                              ,SUM(CRCT_RTL_FEE) AS CRCT_RTL_FEE_TOT
				                              ,LK_WRHS_CRCT_DOC_NO
				                       FROM 
				                             EXCA_WRHS_CRCT
				                     WHERE 1=1
				                       AND EXCA_STD_CD = #{EXCA_STD_CD}
				                     GROUP BY WRHS_CRCT_DOC_NO, WRHS_DOC_NO, WRHS_CRCT_STAT_CD, EXCA_STD_CD, WRHS_CRCT_REG_DT, CRCT_RTN_DT, CRCT_WRHS_CFM_DT
				                     				, LK_WRHS_CRCT_DOC_NO
				                    ) D
				                   ,EPCM_CFM_MST A
				                   ,EPCN_BIZR_INFO E
				                   ,EPCN_BRCH_INFO F
				            WHERE 1=1
				              AND B.LK_WRHS_CRCT_DOC_NO = D.WRHS_CRCT_DOC_NO
				              AND D.WRHS_DOC_NO = A.WRHS_DOC_NO
				              AND A.WHSDL_BIZRID = E.BIZRID
				              AND A.WHSDL_BIZRNO = E.BIZRNO
				              AND A.MFC_BIZRID = F.BIZRID
				              AND A.MFC_BIZRNO = F.BIZRNO
				              AND A.MFC_BRCH_ID = F.BRCH_ID
				              AND A.MFC_BRCH_NO = F.BRCH_NO
						
						<if test="WRHS_CRCT_STAT_CD !=''  and WRHS_CRCT_STAT_CD !=null">
							AND B.WRHS_CRCT_STAT_CD = #{WRHS_CRCT_STAT_CD}
						</if>
						 <if test="MFC_BIZRID !=''  and MFC_BIZRID !=null">
							AND A.MFC_BIZRID 			= #{MFC_BIZRID}
							AND A.MFC_BIZRNO 		= #{MFC_BIZRNO}
						</if>
						<if test="MFC_BRCH_ID !=''  and MFC_BRCH_ID !=null">
							AND A.MFC_BRCH_ID 		= #{MFC_BRCH_ID}
							AND A.MFC_BRCH_NO 	= #{MFC_BRCH_NO}
						</if>
						<if test="BIZR_TP_CD !=''  and BIZR_TP_CD !=null">
							AND E.BIZR_TP_CD 			= #{BIZR_TP_CD}
						</if>
						<if test="WHSDL_BIZRID !=''  and WHSDL_BIZRID !=null">
							AND A.WHSDL_BIZRID 	= #{WHSDL_BIZRID}
							AND A.WHSDL_BIZRNO 	= #{WHSDL_BIZRNO}
						</if>  
						    
						<if test="EXCA_TRGT_SE.equalsIgnoreCase('I')" >   
								 <if test="MFC_BIZRID  ==null ">   
										AND	A.MFC_BIZRID || ';' || A.MFC_BIZRNO IN  
							        <foreach collection="MFC_BIZRNM_RETURN"  item="type"  open="(" close=")" separator=",">
							            #{type.BIZRID_NO}
							        </foreach>
					       		</if>  
			 			</if>	
	</select>
	
	<!--상태체크-->
	<select id="epce4705601_select5" parameterType="map" resultType="int">
		SELECT COUNT(1)  
		FROM EXCA_WRHS_CRCT 
		WHERE 1=1
			AND WRHS_CRCT_DOC_NO = #{WRHS_CRCT_DOC_NO}
			AND MNUL_EXCA_SE in ('M', 'R') /* 수기정산구분 M:수기등록 R:재정산등록 */
			AND WRHS_CRCT_STAT_CD NOT IN ('R','T') /* 정정등록, 정정반려 */
	</select>
	
	<!--상태체크-->
	<select id="epce4705601_select6" parameterType="map" resultType="int">
		SELECT COUNT(1)  
		  FROM EXCA_WRHS_CRCT 
		WHERE 1=1
			AND WRHS_CRCT_DOC_NO =#{WRHS_CRCT_DOC_NO_RE}
            AND ((MNUL_EXCA_SE = 'R' AND WRHS_CRCT_STAT_CD != #{WRHS_CRCT_STAT_CD_CHK2})
            OR (MNUL_EXCA_SE != 'R' AND WRHS_CRCT_STAT_CD != #{WRHS_CRCT_STAT_CD_CHK}))			
	</select>
	
	<!--정산기간 진행중 체크-->
	<select id="epce4705601_select7" parameterType="map" resultType="int">
		SELECT COUNT(1) FROM EXCA_STD_MGNT WHERE EXCA_STAT_CD = 'S'
	</select>
	
	<!-- 입고정정  정정확인,정정반려,확인취소 상태 변경-->
	<update id="epce4705601_update" parameterType="map">
		    UPDATE EXCA_WRHS_CRCT 
		    	  SET WRHS_CRCT_STAT_CD	= #{WRHS_CRCT_STAT_CD}
		    			,UPD_PRSN_ID =	#{REG_PRSN_ID}
						,UPD_DTTM = SYSDATE
		    WHERE 1=1
		    	AND WRHS_CRCT_DOC_NO = #{WRHS_CRCT_DOC_NO_RE}
	</update>
	
	  
	<!-- ****************************************************************** -->	
	<!--  입고정정 내역조회     -->
	<!-- ****************************************************************** -->	
	<!-- 입고정정 내역조회 상세조회  -->
	<select id="epce4705664_select"  parameterType="map"  resultType="hashmap">
			SELECT 
						A.WRHS_CFM_DT
						,(SELECT CAR_NO FROM EPCM_RTN_MST WHERE WRHS_DOC_NO = A.WRHS_DOC_NO) AS CAR_NO
						,B.BIZRNM AS MFC_BIZRNM
						,ECL_DECRYPT(B.BIZRNO) AS MFC_BIZRNO	
						,B.RPST_NM AS MFC_RPST_NM
						,D.BRCH_NM AS MFC_BRCH_NM
						,B.RPST_TEL_NO1||'-'||B.RPST_TEL_NO2||'-'||B.RPST_TEL_NO3 AS MFC_RPST_TEL_NO
						,B.ADDR1||' '||B.ADDR2 AS MFC_ADDR
						,C.BIZRNM AS WHSDL_BIZRNM
						,ECL_DECRYPT(C.BIZRNO) AS WHSDL_BIZRNO
						,C.RPST_NM AS WHSDL_RPST_NM		
						,C.RPST_TEL_NO1||'-'||C.RPST_TEL_NO2||'-'||C.RPST_TEL_NO3 AS WHSDL_RPST_TEL_NO
						,C.ADDR1||' '||C.ADDR2 AS WHSDL_ADDR
						,A.WRHS_DOC_NO
						,A.WRHS_CRCT_REG_DT
						,A.WRHS_CRCT_DOC_NO
						,A.WRHS_CRCT_STAT_CD
			   FROM (
			   			  SELECT E.WRHS_CRCT_REG_DT
									 ,E.WRHS_CRCT_DOC_NO
									 ,E.WRHS_CRCT_STAT_CD
									 ,A.WRHS_DOC_NO
                                     ,NVL(A.WRHS_CFM_DT, E.CRCT_WRHS_CFM_DT) AS WRHS_CFM_DT
									 ,NVL(A.MFC_BIZRID, MNUL_MFC_BIZRID) AS MFC_BIZRID
									 ,NVL(A.MFC_BIZRNO, MNUL_MFC_BIZRNO) AS MFC_BIZRNO
									 ,NVL(A.MFC_BRCH_ID, MNUL_MFC_BRCH_ID) AS MFC_BRCH_ID
									 ,NVL(A.MFC_BRCH_NO, MNUL_MFC_BRCH_NO) AS MFC_BRCH_NO
									 ,NVL(A.WHSDL_BIZRID, MNUL_WHSDL_BIZRID) AS WHSDL_BIZRID
									 ,NVL(A.WHSDL_BIZRNO, MNUL_WHSDL_BIZRNO) AS WHSDL_BIZRNO
									 ,NVL(A.WHSDL_BRCH_ID, MNUL_WHSDL_BRCH_ID) AS WHSDL_BRCH_ID
									 ,NVL(A.WHSDL_BRCH_NO, MNUL_WHSDL_BRCH_NO) AS WHSDL_BRCH_NO
			   			    FROM EXCA_WRHS_CRCT E
			   						 ,EPCM_CFM_MST A
			   			  WHERE 1=1
			   			      AND E.WRHS_DOC_NO = A.WRHS_DOC_NO(+)
			   			      AND	E.WRHS_CRCT_DOC_NO = #{WRHS_CRCT_DOC_NO_RE}
						) A
						,EPCN_BIZR_INFO B	
						,EPCN_BIZR_INFO C
						,EPCN_BRCH_INFO D
			WHERE 1=1
				AND 	A.MFC_BIZRID  	 	= B.BIZRID
				AND	A.MFC_BIZRNO 	 	= B.BIZRNO
				AND 	A.WHSDL_BIZRID  	= C.BIZRID
				AND	A.WHSDL_BIZRNO 	= C.BIZRNO
				AND 	B.BIZRID  	 			= D.BIZRID
				AND	B.BIZRNO 	 			= D.BIZRNO
				AND	A.MFC_BIZRID 		= #{MFC_BIZRID}
				AND	A.MFC_BIZRNO 		= #{MFC_BIZRNO}
				AND	A.WHSDL_BIZRID 	= #{WHSDL_BIZRID}
				AND	A.WHSDL_BIZRNO 	= ECL_ENCRYPT(#{WHSDL_BIZRNO})
				AND 	D.BRCH_ID 			= #{MFC_BRCH_ID}
				AND 	D.BRCH_NO 			= #{MFC_BRCH_NO}	
	</select>
	
	<!-- 입고정정 내역조회 입고 그리드 부분  -->
	<select id="epce4705664_select2"  parameterType="map"  resultType="hashmap">
	
				SELECT 
		  		<![CDATA[
							EPCN_ETC_NM(C.PRPS_CD , 'E002') AS PRPS_NM
							,EPCN_ETC_NM(C.CPCT_CD , 'E001') AS CPCT_NM
							,C.PRPS_CD
							,C.CTNR_NM
							,A.CTNR_CD
							,DECODE( SUBSTR(A.CTNR_CD,2,1),'3' ,'2' ,'1') AS CTNR_SE
							,EPCN_ETC_NM(C.CPCT_CD , 'E001') AS CPCT_NM
							,NVL((SELECT RTN_QTY  FROM EPCM_RTN_INFO WHERE CTNR_CD = A.CTNR_CD AND RTN_DOC_NO = A.RTN_DOC_NO ) , 0) AS RTN_QTY

							,NVL( A.CRCT_DMGB_QTY,'0') AS DMGB_QTY
							,NVL( A.CRCT_VRSB_QTY,'0')	 AS VRSB_QTY
							,NVL( A.CRCT_QTY,'0') AS CFM_QTY
			                ,NVL( A.CRCT_GTN,'0') AS CFM_GTN
			                ,NVL( A.CRCT_WHSL_FEE,'0') AS CFM_WHSL_FEE
			                ,NVL( A.CRCT_WHSL_FEE_STAX,'0') AS CFM_WHSL_FEE_STAX
			                ,NVL( A.CRCT_RTL_FEE,'0') AS CFM_RTL_FEE
			                ,A.CRCT_GTN+A.CRCT_WHSL_FEE+A.CRCT_WHSL_FEE_STAX+A.CRCT_RTL_FEE AS CFM_AMT

							,NVL( A.CRCT_DMGB_QTY,'0') AS CRCT_DMGB_QTY
							,NVL( A.CRCT_VRSB_QTY,'0')	 AS CRCT_VRSB_QTY
							,NVL( A.CRCT_QTY,'0') AS CRCT_QTY
			                ,NVL( A.CRCT_GTN,'0') AS CRCT_GTN
			                ,NVL( A.CRCT_WHSL_FEE,'0') AS CRCT_WHSL_FEE
			                ,NVL( A.CRCT_WHSL_FEE_STAX,'0') AS CRCT_WHSL_FEE_STAX
			                ,NVL( A.CRCT_RTL_FEE,'0') AS CRCT_RTL_FEE
			                ,A.CRCT_GTN+A.CRCT_WHSL_FEE+A.CRCT_WHSL_FEE_STAX+A.CRCT_RTL_FEE AS CRCT_AMT

							,A.WRHS_DOC_NO
							,A.RTN_DOC_NO
							,A.WRHS_CRCT_DOC_NO

							,A.RMK   
							,SUBSTR(A.RMK ,3) AS RMK_C
							
							,WHSDL_BIZRID
							 ,WHSDL_BIZRNO
							 ,WHSDL_BRCH_ID
							 ,WHSDL_BRCH_NO
							 ,MFC_BIZRID
							 ,MFC_BIZRNO
							 ,MFC_BRCH_ID
							 ,MFC_BRCH_NO
							 ,WRHS_CFM_DT
							
							]]>
				FROM 	
							(
				              SELECT NVL(A.WRHS_DOC_NO, B.WRHS_DOC_NO) AS WRHS_DOC_NO
					                     ,A.WRHS_CRCT_DOC_NO
					                     ,B.RTN_DOC_NO AS RTN_DOC_NO
					                     ,NVL(A.CTNR_CD, B.CTNR_CD)AS CTNR_CD
					                     ,NVL(A.CRCT_DMGB_QTY,'0') AS CRCT_DMGB_QTY
					                     ,NVL(A.CRCT_VRSB_QTY,'0') AS CRCT_VRSB_QTY
					                     ,NVL(A.CRCT_QTY,'0') AS CRCT_QTY
					                     ,NVL(A.CRCT_GTN,'0') AS CRCT_GTN
					                     ,NVL(A.CRCT_WHSL_FEE,'0') AS CRCT_WHSL_FEE
					                     ,NVL(A.CRCT_WHSL_FEE_STAX,'0') AS CRCT_WHSL_FEE_STAX
					                     ,NVL(A.CRCT_RTL_FEE,'0') AS CRCT_RTL_FEE
					                     ,A.CRCT_GTN+A.CRCT_WHSL_FEE+A.CRCT_WHSL_FEE_STAX+A.CRCT_RTL_FEE AS CRCT_AMT
					                     ,A.RMK
					                     ,WHSDL_BIZRID
										 ,WHSDL_BIZRNO
										 ,WHSDL_BRCH_ID
										 ,WHSDL_BRCH_NO
										 ,MFC_BIZRID
										 ,MFC_BIZRNO
										 ,MFC_BRCH_ID
										 ,MFC_BRCH_NO
										 ,WRHS_CFM_DT
				                FROM (SELECT * FROM EXCA_WRHS_CRCT WHERE WRHS_CRCT_DOC_NO = #{WRHS_CRCT_DOC_NO}) A
					                     FULL OUTER JOIN
					                     (SELECT A.WRHS_CRCT_DOC_NO, A.RTN_DOC_NO
					                     			 ,WHSDL_BIZRID
														,WHSDL_BIZRNO
														,WHSDL_BRCH_ID
														,WHSDL_BRCH_NO
														,MFC_BIZRID
														,MFC_BIZRNO
														,MFC_BRCH_ID
														,MFC_BRCH_NO
														,WRHS_CFM_DT
					                     			 , B.* 
					                     	FROM EPCM_CFM_MST A, EPCM_CFM_INFO B 
					                      WHERE A.WRHS_DOC_NO = B.WRHS_DOC_NO 
					                          AND A.WRHS_DOC_NO	= #{WRHS_DOC_NO}
					                      	  AND A.WRHS_CRCT_DOC_NO = #{WRHS_CRCT_DOC_NO}
					                      ) B
					                     ON (A.WRHS_CRCT_DOC_NO = B.WRHS_CRCT_DOC_NO AND A.CTNR_CD = B.CTNR_CD)
				              ) A
							,EPCN_STD_CTNR_CD C
							,(SELECT LANG_SE_CD FROM EPCN_LANG_CD WHERE USE_YN = 'Y' AND STD_YN = 'Y' AND ROWNUM = '1') E
				WHERE  1=1
					AND	A.CTNR_CD 			= C.CTNR_CD
					AND 	C.LANG_SE_CD 		= E.LANG_SE_CD			

	</select>
	
	<!-- 입고정정 내역조회 입고정정  그리드 부분 -->
	<select id="epce4705664_select3"  parameterType="map"  resultType="hashmap">
				SELECT 
					
							EPCN_ETC_NM(C.PRPS_CD , 'E002') AS PRPS_NM
							,C.PRPS_CD
							,C.CTNR_NM
							,A.CTNR_CD
							,EPCN_ETC_NM(C.CPCT_CD , 'E001') AS CPCT_NM
							,A.CRCT_QTY
						    ,A.CRCT_GTN
							,A.CRCT_WHSL_FEE
							,A.CRCT_WHSL_FEE_STAX
							,A.CRCT_RTL_FEE

							,A.CRCT_GTN +A.CRCT_WHSL_FEE+A.CRCT_WHSL_FEE_STAX +A.CRCT_RTL_FEE   AS AMT_TOT
						 	,NVL(A.CRCT_DMGB_QTY,0) AS CRCT_DMGB_QTY
							,NVL(A.CRCT_VRSB_QTY,0) AS CRCT_VRSB_QTY
							,B.WHSDL_BIZRID
							,B.WHSDL_BIZRNO
							,B.WHSDL_BRCH_ID
							,B.WHSDL_BRCH_NO
							,B.MFC_BIZRID
							,B.MFC_BIZRNO
							,B.MFC_BRCH_ID
							,B.MFC_BRCH_NO
							,DECODE( SUBSTR(A.CTNR_CD,2,1),'3' ,'2' ,'1') AS CTNR_SE
							,B.RTN_DOC_NO
							,B.WRHS_DOC_NO
							,(SELECT RTN_DT FROM EPCM_RTN_MST G WHERE B.RTN_DOC_NO = G.RTN_DOC_NO ) AS RTN_DT
							,NVL((SELECT RTN_QTY FROM EPCM_RTN_INFO WHERE 1=1
										AND CTNR_CD = A.CTNR_CD
										AND RTN_DOC_NO = B.RTN_DOC_NO
									),0) AS RTN_QTY
							,A.RMK       
							,SUBSTR(A.RMK ,3) AS RMK_C   	
							,A.CRCT_RTN_DT
							,A.CRCT_WRHS_CFM_DT
				FROM 	EXCA_WRHS_CRCT A
							,EPCM_CFM_MST B
							,(
								SELECT C.* 
								  FROM EPCN_STD_CTNR_CD C
											,(SELECT LANG_SE_CD FROM EPCN_LANG_CD WHERE USE_YN = 'Y' AND STD_YN = 'Y' AND ROWNUM = '1') E
								WHERE 1=1
								    AND C.LANG_SE_CD = E.LANG_SE_CD
							) C
				WHERE  1=1
					AND 	A.WRHS_DOC_NO 	= B.WRHS_DOC_NO(+)
					AND	A.CTNR_CD 			= C.CTNR_CD(+)
					AND	A.WRHS_CRCT_DOC_NO = #{WRHS_CRCT_DOC_NO_RE}
	</select>
	
	<!-- 입고정정 내역조회 삭제 -->
	<delete id="epce4705664_delete"  parameterType="map" >
		DELETE FROM EXCA_WRHS_CRCT 
		WHERE 1=1
			AND WRHS_CRCT_DOC_NO	= #{WRHS_CRCT_DOC_NO}
	</delete>
	
	<update id="epce4705664_update" parameterType="map" >
	
		UPDATE EXCA_WRHS_CRCT 
		      SET LK_WRHS_CRCT_DOC_NO =''
					,UPD_PRSN_ID = #{UPD_PRSN_ID}
					,UPD_DTTM	= SYSDATE
		WHERE 1=1
			AND WRHS_DOC_NO =#{WRHS_DOC_NO}
			AND LK_WRHS_CRCT_DOC_NO = #{WRHS_CRCT_DOC_NO}
	
	</update>
	
	
	
	<!-- 입고정정건별등록 공급자부분  -->
	<select id="epce4705631_select"  resultType="hashmap" parameterType="map">
			 SELECT             
						A.WRHS_CFM_DT
						,B.BIZRNM 						 AS MFC_BIZRNM
						,ECL_DECRYPT(B.BIZRNO) AS MFC_BIZRNO_DE
						,B.RPST_NM					 AS MFC_RPST_NM
						,D.BRCH_NM					 AS MFC_BRCH_NM
						,B.RPST_TEL_NO1||'-'||B.RPST_TEL_NO2||'-'||B.RPST_TEL_NO3 AS MFC_RPST_TEL_NO
						,B.ADDR1||' '||B.ADDR2 	 AS MFC_ADDR
						,C.BIZRNM						 AS WHSDL_BIZRNM
						,ECL_DECRYPT(C.BIZRNO) AS WHSDL_BIZRNO_DE
						,C.RPST_NM					 AS WHSDL_RPST_NM		
						,C.RPST_TEL_NO1||'-'||C.RPST_TEL_NO2||'-'||C.RPST_TEL_NO3 AS WHSDL_RPST_TEL_NO
						,C.ADDR1||' '||C.ADDR2 	 AS WHSDL_ADDR
						,A.MFC_BIZRID
						,A.MFC_BIZRNO	
						,A.MFC_BRCH_ID
						,A.MFC_BRCH_NO
						,A.WHSDL_BIZRID
						,A.WHSDL_BIZRNO
						,A.WHSDL_BRCH_ID
						,A.WHSDL_BRCH_NO
						,A.WRHS_DOC_NO
						,E.RTN_DOC_NO
					 	,E.RTN_DT   
					 	,E.CAR_NO
						
			FROM 	EPCM_CFM_MST A			
						,EPCN_BIZR_INFO B			 
						,EPCN_BIZR_INFO C 		
						,EPCN_BRCH_INFO D	
						,EPCM_RTN_MST E				
			WHERE 1=1
			AND 		A.MFC_BIZRID  	 	= B.BIZRID
			AND		A.MFC_BIZRNO 	 	= B.BIZRNO
			AND 		A.WHSDL_BIZRID  	= C.BIZRID
			AND		A.WHSDL_BIZRNO 	= C.BIZRNO
			AND		A.RTN_DOC_NO		= E.RTN_DOC_NO
			AND	    A.RTN_DOC_NO		= #{RTN_DOC_NO}
			AND		A.MFC_BIZRID 		= #{MFC_BIZRID}
			AND		A.MFC_BIZRNO 		= #{MFC_BIZRNO}
			AND		A.WHSDL_BIZRID 	= #{CUST_BIZRID}
			AND		A.WHSDL_BIZRNO 	= #{CUST_BIZRNO}
			AND 		D.BRCH_ID 			= #{MFC_BRCH_ID}
			AND 		D.BRCH_NO 			= #{MFC_BRCH_NO}	
			
	</select>
	
	<!--입고정정건별등록  입고확인내역 그리드 쪽  -->
	<select id="epce4705631_select2"  resultType="hashmap" parameterType="map">
		  		SELECT 
		  		<![CDATA[
							EPCN_ETC_NM(C.PRPS_CD , 'E002') AS PRPS_NM
							,C.PRPS_CD
							,C.CTNR_NM
							,A.CTNR_CD
							,DECODE( SUBSTR(A.CTNR_CD,2,1),'3' ,'2' ,'1') AS CTNR_SE
							,EPCN_ETC_NM(C.CPCT_CD , 'E001') AS CPCT_NM
							,NVL((SELECT RTN_QTY  FROM EPCM_RTN_INFO WHERE CTNR_CD = A.CTNR_CD AND RTN_DOC_NO = A.RTN_DOC_NO ) , 0) AS RTN_QTY

							,NVL( A.CRCT_DMGB_QTY,'0') AS DMGB_QTY
							,NVL( A.CRCT_VRSB_QTY,'0')	 AS VRSB_QTY
							,NVL( A.CRCT_QTY,'0') AS CFM_QTY
			                ,NVL( A.CRCT_GTN,'0') AS CFM_GTN
			                ,NVL( A.CRCT_WHSL_FEE,'0') AS CFM_WHSL_FEE
			                ,NVL( A.CRCT_WHSL_FEE_STAX,'0') AS CFM_WHSL_FEE_STAX
			                ,NVL( A.CRCT_RTL_FEE,'0') AS CFM_RTL_FEE
			                ,A.CRCT_GTN+A.CRCT_WHSL_FEE+A.CRCT_WHSL_FEE_STAX+A.CRCT_RTL_FEE AS CFM_AMT

							,NVL( A.CRCT_DMGB_QTY,'0') AS CRCT_DMGB_QTY
							,NVL( A.CRCT_VRSB_QTY,'0')	 AS CRCT_VRSB_QTY
							,NVL( A.CRCT_QTY,'0') AS CRCT_QTY
			                ,NVL( A.CRCT_GTN,'0') AS CRCT_GTN
			                ,NVL( A.CRCT_WHSL_FEE,'0') AS CRCT_WHSL_FEE
			                ,NVL( A.CRCT_WHSL_FEE_STAX,'0') AS CRCT_WHSL_FEE_STAX
			                ,NVL( A.CRCT_RTL_FEE,'0') AS CRCT_RTL_FEE
			                ,A.CRCT_GTN+A.CRCT_WHSL_FEE+A.CRCT_WHSL_FEE_STAX+A.CRCT_RTL_FEE AS CRCT_AMT

							,A.WRHS_DOC_NO
							,A.RTN_DOC_NO
							,A.WRHS_CRCT_DOC_NO

							,A.RMK   
							,SUBSTR(A.RMK ,3) AS RMK_C
							
							,WHSDL_BIZRID
							 ,WHSDL_BIZRNO
							 ,WHSDL_BRCH_ID
							 ,WHSDL_BRCH_NO
							 ,MFC_BIZRID
							 ,MFC_BIZRNO
							 ,MFC_BRCH_ID
							 ,MFC_BRCH_NO
							 ,WRHS_CFM_DT
							
							]]>
				FROM 	
							(
				              SELECT NVL(A.WRHS_DOC_NO, B.WRHS_DOC_NO) AS WRHS_DOC_NO
					                     ,A.WRHS_CRCT_DOC_NO
					                     ,B.RTN_DOC_NO AS RTN_DOC_NO
					                     ,A.CTNR_CD
					                     ,NVL(A.CRCT_DMGB_QTY,'0') AS CRCT_DMGB_QTY
					                     ,NVL(A.CRCT_VRSB_QTY,'0') AS CRCT_VRSB_QTY
					                     ,NVL(A.CRCT_QTY,'0') AS CRCT_QTY
					                     ,NVL(A.CRCT_GTN,'0') AS CRCT_GTN
					                     ,NVL(A.CRCT_WHSL_FEE,'0') AS CRCT_WHSL_FEE
					                     ,NVL(A.CRCT_WHSL_FEE_STAX,'0') AS CRCT_WHSL_FEE_STAX
					                     ,NVL(A.CRCT_RTL_FEE,'0') AS CRCT_RTL_FEE
					                     ,A.CRCT_GTN+A.CRCT_WHSL_FEE+A.CRCT_WHSL_FEE_STAX+A.CRCT_RTL_FEE AS CRCT_AMT
					                     ,A.RMK
					                     ,WHSDL_BIZRID
										 ,WHSDL_BIZRNO
										 ,WHSDL_BRCH_ID
										 ,WHSDL_BRCH_NO
										 ,MFC_BIZRID
										 ,MFC_BIZRNO
										 ,MFC_BRCH_ID
										 ,MFC_BRCH_NO
										 ,WRHS_CFM_DT
				                FROM (SELECT * FROM EXCA_WRHS_CRCT WHERE WRHS_CRCT_DOC_NO = #{WRHS_CRCT_DOC_NO}) A
					                     FULL OUTER JOIN
					                     (SELECT A.WRHS_CRCT_DOC_NO, A.RTN_DOC_NO, A.WRHS_DOC_NO
					                     			 ,WHSDL_BIZRID
														,WHSDL_BIZRNO
														,WHSDL_BRCH_ID
														,WHSDL_BRCH_NO
														,MFC_BIZRID
														,MFC_BIZRNO
														,MFC_BRCH_ID
														,MFC_BRCH_NO
														,WRHS_CFM_DT
					                     	FROM EPCM_CFM_MST A
					                      WHERE A.WRHS_CRCT_DOC_NO = #{WRHS_CRCT_DOC_NO}
					                      ) B
					                     ON (A.WRHS_CRCT_DOC_NO = B.WRHS_CRCT_DOC_NO )
				              ) A
							,EPCN_STD_CTNR_CD C
							,(SELECT LANG_SE_CD FROM EPCN_LANG_CD WHERE USE_YN = 'Y' AND STD_YN = 'Y' AND ROWNUM = '1') E
				WHERE  1=1
					AND	A.CTNR_CD 			= C.CTNR_CD
					AND 	C.LANG_SE_CD 		= E.LANG_SE_CD

	</select>
	
	
	<!--중복체크 -->
	<select id="epce4705631_select4" parameterType="map" resultType="int">
		SELECT COUNT(*)
		  FROM EXCA_WRHS_CRCT
		WHERE 1=1
			AND WRHS_DOC_NO 		= #{WRHS_DOC_NO}
			AND CTNR_CD 				= #{CTNR_CD}
	</select>
	
	<!--수량체크 -->
	<select id="epce4705631_select5" parameterType="map" resultType="int">
  	   SELECT COUNT(*)
		 FROM (
		             SELECT SUM(NVL(DMGB_QTY,0)+NVL(VRSB_QTY,0)+NVL(CFM_QTY,0)) AS QTY_TOT
		               FROM EPCM_CFM_INFO
		             WHERE WRHS_DOC_NO = #{WRHS_DOC_NO}
		          )
		WHERE 1=1
      		AND QTY_TOT = #{CRCT_TOT}
	</select>
	
	<!--적용기간 체크 -->
	<select id="epce4705631_select6" parameterType="map" resultType="int">
		SELECT COUNT(1) FROM EXCA_STD_MGNT WHERE 1=1
		AND EXCA_STD_CD =#{EXCA_STD_CD}
		AND EXCA_STAT_CD !='S'
	</select>
	  
	<!-- 등록 -->
	<insert id="epce4705631_insert" parameterType="map" >
		INSERT
			INTO EXCA_WRHS_CRCT
				(
					WRHS_CRCT_DOC_NO
					,CTNR_CD
					,WRHS_DOC_NO
					,WRHS_CRCT_REG_DT
					,WRHS_CRCT_STAT_CD
					,CRCT_DMGB_QTY
					,CRCT_VRSB_QTY
					,CRCT_QTY
					,CRCT_GTN
					,CRCT_WHSL_FEE
					,CRCT_WHSL_FEE_STAX
					,CRCT_RTL_FEE
					,CRCT_RTN_DT
					,CRCT_WRHS_CFM_DT
					,EXCA_STD_CD
					,REG_PRSN_ID
					,REG_DTTM
					<if test="UPD_PRSN_ID !=null ">
					,UPD_PRSN_ID
					,UPD_DTTM
					</if>
					<if test="RMK !=null and RMK !='' ">
					,RMK
					</if>
					
					,MNUL_EXCA_SE
					,LK_WRHS_CRCT_DOC_NO
					
					,MNUL_WHSDL_BIZRID
					,MNUL_WHSDL_BIZRNO
					,MNUL_WHSDL_BRCH_ID
					,MNUL_WHSDL_BRCH_NO
					,MNUL_MFC_BIZRID
					,MNUL_MFC_BIZRNO
					,MNUL_MFC_BRCH_ID
					,MNUL_MFC_BRCH_NO
					
			  )
			  VALUES
			  (
					#{WRHS_CRCT_DOC_NO_RE}
					,#{CTNR_CD}
					,#{WRHS_DOC_NO}
					,TO_CHAR(SYSDATE,'YYYYMMDD')
					,#{WRHS_CRCT_STAT_CD}
					,#{CRCT_DMGB_QTY}
					,#{CRCT_VRSB_QTY}
					,#{CRCT_QTY}
					,#{CRCT_GTN}
					,#{CRCT_WHSL_FEE}
					,#{CRCT_WHSL_FEE_STAX}
					,#{CRCT_RTL_FEE}
					,REPLACE(#{CRCT_RTN_DT}, '-')
					,REPLACE(#{CRCT_WRHS_CFM_DT}, '-')
					
					,( select exca_std_cd from exca_std_mgnt where exca_stat_cd = 'S' ) /* 진행중인 정산기간코드 */
					
					<if test="UPD_PRSN_ID ==null ">
					,#{REG_PRSN_ID}
					,SYSDATE
					</if>
					<if test="UPD_PRSN_ID !=null ">
					,#{REG_PRSN_ID}
					,TO_DATE(#{REG_DTTM},'YYYY-MM-DD HH24:MI:SS')
					,#{UPD_PRSN_ID}
					,SYSDATE
					</if>
					<if test="RMK !=null and RMK !='' ">
					,#{RMK}    
					</if>
					,#{MNUL_EXCA_SE}
					,#{WRHS_CRCT_DOC_NO}
					
					,#{WHSDL_BIZRID}
					,#{WHSDL_BIZRNO}
					,#{WHSDL_BRCH_ID}
					,#{WHSDL_BRCH_NO}
					,#{MFC_BIZRID}
					,#{MFC_BIZRNO}
					,#{MFC_BRCH_ID}
					,#{MFC_BRCH_NO}

			  )
	</insert>
	
	 <!-- 입고관리에 정정등록 -->

	 <update id="epce4705631_update" parameterType="map" >
		  UPDATE EXCA_WRHS_CRCT 
		        SET LK_WRHS_CRCT_DOC_NO	= #{WRHS_CRCT_DOC_NO_RE}
						,UPD_PRSN_ID				=	#{REG_PRSN_ID}
						,UPD_DTTM						=	SYSDATE
		  WHERE 1=1 
		  AND WRHS_CRCT_DOC_NO	 = #{WRHS_CRCT_DOC_NO}
	 </update>
	 
<!--	     
/***************************************************************************************************************************************************************************************
* 	 입고정정 일괄등록
****************************************************************************************************************************************************************************************/
 -->	
	 <!--엑셀 업로드 조회 -->
	<select id="epce47056312_select" parameterType="map" resultType="hashmap">
				SELECT 
										T2.WRHS_DOC_NO
										,EPCN_BIZR_NM(T1.CUST_BIZRID,T1.CUST_BIZRNO) AS CUST_BIZRNM
										,T1.CUST_BIZRID
										
			              			    ,ECL_DECRYPT(T1.CUST_BIZRNO) AS CUST_BIZRNO_DE
			              			    ,T1.CUST_BIZRNO
			              			    ,T1.CUST_BRCH_ID
			              			    ,T1.CUST_BRCH_NO
			              			    ,T1.MFC_BIZRNO
			              			    ,T1.MFC_BIZRID
			              			    ,T1.MFC_BRCH_NO
			              			    ,T1.MFC_BRCH_ID
			              			    
										,EPCN_CTNR_NM(T1.CTNR_CD) AS CTNR_NM
										,T1.CTNR_CD
										,T4.CFM_QTY
			               				,NVL(T4.CFM_QTY * T5.STD_DPS ,'0')			AS CFM_GTN
			               				,NVL(T4.CFM_QTY * T1.WHSL_FEE ,'0')			AS CFM_WHSL_FEE
			               				,NVL( ((T4.CFM_QTY * T1.WHSL_FEE)+(T4.CFM_QTY * T1.RTL_FEE)) *0.1 ,'0')	AS CFM_WHSL_FEE_STAX
			               				,NVL(T4.CFM_QTY * T1.RTL_FEE ,'0') 				AS CFM_RTL_FEE
			               				,NVL(T4.CFM_QTY * T5.STD_DPS ,'0') +NVL(T4.CFM_QTY * T1.WHSL_FEE ,'0') + NVL( ((T4.CFM_QTY * T1.WHSL_FEE)+(T4.CFM_QTY * T1.RTL_FEE)) *0.1 ,'0') +NVL(T4.CFM_QTY * T1.RTL_FEE ,'0')  AS CFM_AMT
			              				,T2.FH_CFM_QTY_TOT +T2.FB_CFM_QTY_TOT + T2.DRCT_CFM_QTY_TOT AS CFM_QTY_TOT
									
										,EPCN_CTNR_NM(T6.CTNR_CD) 					AS CRCT_CTNR_NM
										,T6.CTNR_CD 											AS CRCT_CTNR_CD
									    ,NVL(#{CRCT_QTY},'0') 								AS CRCT_QTY
			               				,NVL(#{CRCT_QTY} * T7.STD_DPS,'0')			AS CRCT_GTN
			               				,NVL(#{CRCT_QTY} * T6.WHSL_FEE,'0') 			AS CRCT_WHSL_FEE
			               				,NVL( ((#{CRCT_QTY} * T6.WHSL_FEE) + (#{CRCT_QTY} * T6.RTL_FEE)) *0.1,'0')  	AS CRCT_WHSL_FEE_STAX
			               				,NVL(#{CRCT_QTY} * T6.RTL_FEE,'0') 			AS CRCT_RTL_FEE
			               				,NVL(#{CRCT_QTY} * T7.STD_DPS,'0') +NVL(#{CRCT_QTY} * T6.WHSL_FEE,'0') 	+NVL(#{CRCT_QTY} * T6.WHSL_FEE *0.1,'0') +NVL(#{CRCT_QTY} * T6.RTL_FEE,'0')+NVL(#{CRCT_QTY} * T6.RTL_FEE *0.1,'0') AS CRCT_AMT
			               				
			               				,'R'							AS WRHS_CRCT_STAT_CD
			               				,'0'							AS CRCT_DMGB_QTY
										,'0' 						AS CRCT_VRSB_QTY
										,T3.RTN_DT 			AS CRCT_RTN_DT
			               				,T2.WRHS_CFM_DT 	AS CRCT_WRHS_CFM_DT
			               				,#{EXCA_STD_CD}		AS EXCA_STD_CD
			               				
				FROM 		 EPCN_INDV_FEE_MGNT  	T1
	                 			 ,EPCM_CFM_MST 			T2
	                 			 ,EPCM_RTN_MST 			T3
	                 			 ,EPCM_CFM_INFO 			T4	
	                 			 ,EPCN_STD_DPS_MGNT 	T5	    
	                 			 ,EPCN_INDV_FEE_MGNT 	T6     
	                 			 ,EPCN_STD_DPS_MGNT 	T7	        			  
				WHERE 1=1
				AND T1.MFC_BIZRNO 			=	T2.MFC_BIZRNO
	        	AND T1.MFC_BIZRID			=	T2.MFC_BIZRID
				AND T1.MFC_BRCH_NO 		=	T2.MFC_BRCH_NO
				AND T1.MFC_BRCH_ID 		=	T2.MFC_BRCH_ID
				AND T1.CUST_BIZRID 			=	T2.WHSDL_BIZRID
				AND T1.CUST_BIZRNO 		=	T2.WHSDL_BIZRNO
				AND T1.CUST_BRCH_ID		=	T2.WHSDL_BRCH_ID
				AND T1.CUST_BRCH_NO 		=	T2.WHSDL_BRCH_NO
				AND T1.CTNR_CD				=  T4.CTNR_CD		
				AND T1.CTNR_CD				=  T5.CTNR_CD		
				AND T1.LANG_SE_CD			=  T5.LANG_SE_CD		
				AND T2.RTN_DOC_NO  		=	T3.RTN_DOC_NO	
				AND T2.WRHS_DOC_NO		=	T4.WRHS_DOC_NO
				AND T4.CTNR_CD				=  T5.CTNR_CD		
				
				AND T1.MFC_BIZRNO 			=	T6.MFC_BIZRNO
	        	AND T1.MFC_BIZRID			=	T6.MFC_BIZRID
				AND T1.MFC_BRCH_NO 		=	T6.MFC_BRCH_NO
				AND T1.MFC_BRCH_ID 		=	T6.MFC_BRCH_ID
				AND T1.CUST_BIZRID 			=	T6.CUST_BIZRID
				AND T1.CUST_BIZRNO 		=	T6.CUST_BIZRNO
				AND T1.CUST_BRCH_ID		=	T6.CUST_BRCH_ID
				AND T1.CUST_BRCH_NO 		=	T6.CUST_BRCH_NO
				AND T1.LANG_SE_CD			=	T6.LANG_SE_CD
				AND T6.CTNR_CD				=  T7.CTNR_CD		
				AND T6.LANG_SE_CD			=  T7.LANG_SE_CD		
				AND T2.RTN_STAT_CD			=	'PC'
				AND T2.WRHS_DOC_NO		=	#{WRHS_DOC_NO}
				AND T2.WHSDL_BIZRNO		=	ECL_ENCRYPT(#{WHSDL_BIZRNO})		
				AND T2.MFC_BIZRID			=	#{MFC_BIZRID}		 
				AND T2.MFC_BIZRNO			=	#{MFC_BIZRNO}			
				AND T4.CTNR_CD				=	#{CTNR_CD}
				AND T6.CTNR_CD				=	#{CRCT_CTNR_CD}
				AND REPLACE(T3.RTN_DT, '-') BETWEEN  T1.APLC_ST_DT and  T1.APLC_END_DT
				AND REPLACE(T3.RTN_DT, '-') BETWEEN  T5.APLC_ST_DT and  T5.APLC_END_DT
				AND REPLACE(T3.RTN_DT, '-') BETWEEN  T6.APLC_ST_DT and  T6.APLC_END_DT
	</select>
	 
<!--
/***************************************************************************************************************************************************************************************
* 	 입고정정수정
****************************************************************************************************************************************************************************************/
  -->	
  
  <select id="epce47056422_select"  resultType="hashmap" parameterType="map">
		  		SELECT
		  		<![CDATA[
		  					#{WRHS_CRCT_DOC_NO_RE} as WRHS_CRCT_DOC_NO_RE
		  					,'' as WRHS_CRCT_DOC_NO
		  					,A.WRHS_DOC_NO
		  					,A.EXCA_STD_CD
							,EPCN_ETC_NM(C.PRPS_CD , 'E002') AS PRPS_NM
							,C.PRPS_CD
							,C.CTNR_NM
							,A.CTNR_CD
							,DECODE( SUBSTR(A.CTNR_CD,2,1),'3' ,'2' ,'1') AS CTNR_SE
							,EPCN_ETC_NM(C.CPCT_CD , 'E001') AS CPCT_NM

							,NVL( A.CRCT_DMGB_QTY,'0') AS CRCT_DMGB_QTY
							,NVL( A.CRCT_VRSB_QTY,'0')	 AS CRCT_VRSB_QTY
							,NVL( A.CRCT_QTY,'0')	 AS CRCT_QTY
							,NVL( A.CRCT_GTN,'0')	 AS CRCT_GTN
							,NVL( A.CRCT_WHSL_FEE,'0')	 AS CRCT_WHSL_FEE
							,NVL( A.CRCT_WHSL_FEE_STAX,'0') AS CRCT_WHSL_FEE_STAX
							,NVL( A.CRCT_RTL_FEE,'0') AS CRCT_RTL_FEE
							,A.CRCT_GTN+A.CRCT_WHSL_FEE+A.CRCT_WHSL_FEE_STAX+A.CRCT_RTL_FEE AS CRCT_AMT
							,A.MNUL_WHSDL_BIZRID as WHSDL_BIZRID
							,A.MNUL_WHSDL_BIZRNO as WHSDL_BIZRNO
							,A.MNUL_WHSDL_BRCH_ID as WHSDL_BRCH_ID
							,A.MNUL_WHSDL_BRCH_NO as WHSDL_BRCH_NO
							,A.MNUL_MFC_BIZRID as MFC_BIZRID
							,A.MNUL_MFC_BIZRNO as MFC_BIZRNO
							,A.MNUL_MFC_BRCH_ID as MFC_BRCH_ID
							,A.MNUL_MFC_BRCH_NO as MFC_BRCH_NO
							,A.RMK
							,SUBSTR(A.RMK ,3) AS RMK_C     
							,A.REG_PRSN_ID
							,TO_CHAR(A.REG_DTTM,'YYYY-MM-DD HH24:MI:SS') AS REG_DTTM
							,A.CRCT_RTN_DT
							,A.CRCT_WRHS_CFM_DT
							]]>   	               
				FROM               	  
							EXCA_WRHS_CRCT A
							,EPCN_STD_CTNR_CD C
							,(SELECT LANG_SE_CD FROM EPCN_LANG_CD WHERE USE_YN = 'Y' AND STD_YN = 'Y' AND ROWNUM = '1') E
				WHERE  1=1
					AND	A.CTNR_CD 					= C.CTNR_CD
					AND 	C.LANG_SE_CD 				= E.LANG_SE_CD
					AND	A.WRHS_CRCT_DOC_NO	=#{WRHS_CRCT_DOC_NO_RE}
	</select>
  
  
  <!--입고정정건별등록  입고정정등록 그리드 쪽  -->
	<select id="epce4705642_select"  resultType="hashmap" parameterType="map">
		  		SELECT 
		  		<![CDATA[
		  					#{WRHS_CRCT_DOC_NO_RE} as WRHS_CRCT_DOC_NO_RE
		  					,#{WRHS_CRCT_DOC_NO} as WRHS_CRCT_DOC_NO
							,B.WRHS_DOC_NO
							,B.RTN_DOC_NO
							,EPCN_ETC_NM(C.PRPS_CD , 'E002') AS PRPS_NM
							,C.PRPS_CD
							,C.CTNR_NM
							,A.CTNR_CD
							,DECODE( SUBSTR(A.CTNR_CD,2,1),'3' ,'2' ,'1') AS CTNR_SE
							,EPCN_ETC_NM(C.CPCT_CD , 'E001') AS CPCT_NM
							,NVL((SELECT RTN_QTY  FROM EPCM_RTN_INFO WHERE CTNR_CD = A.CTNR_CD AND RTN_DOC_NO =B.RTN_DOC_NO ),'0')  AS RTN_QTY
							,NVL( A.CRCT_DMGB_QTY,'0')	 AS CRCT_DMGB_QTY
							,NVL( A.CRCT_VRSB_QTY,'0')	 AS CRCT_VRSB_QTY
							,NVL( A.CRCT_QTY,'0')	 AS CRCT_QTY
							,NVL( A.CRCT_GTN,'0')	 AS CRCT_GTN
							,NVL( A.CRCT_WHSL_FEE,'0')	 AS CRCT_WHSL_FEE
							,NVL( A.CRCT_WHSL_FEE_STAX,'0')	 AS CRCT_WHSL_FEE_STAX
							,NVL( A.CRCT_RTL_FEE,'0')	 AS CRCT_RTL_FEE
							,A.CRCT_GTN+A.CRCT_WHSL_FEE+A.CRCT_WHSL_FEE_STAX+A.CRCT_RTL_FEE AS CRCT_AMT
							,B.WHSDL_BIZRID
							,B.WHSDL_BIZRNO
							,B.WHSDL_BRCH_ID
							,B.WHSDL_BRCH_NO
							,B.MFC_BIZRID
							,B.MFC_BIZRNO
							,B.MFC_BRCH_ID
							,B.MFC_BRCH_NO
							,B.WRHS_CFM_DT
							,A.RMK   
							,SUBSTR(A.RMK ,3) AS RMK_C     
							,A.REG_PRSN_ID
							,TO_CHAR(A.REG_DTTM,'YYYY-MM-DD HH24:MI:SS') AS REG_DTTM
							,A.CRCT_RTN_DT
							,A.CRCT_WRHS_CFM_DT
							]]>   	               
				FROM               	  
							EXCA_WRHS_CRCT A
							,EPCM_CFM_MST B
							,EPCN_STD_CTNR_CD C
							,(SELECT LANG_SE_CD FROM EPCN_LANG_CD WHERE USE_YN = 'Y' AND STD_YN = 'Y' AND ROWNUM = '1') E
				WHERE  1=1
					AND 	A.WRHS_DOC_NO 			= B.WRHS_DOC_NO
					AND	A.CTNR_CD 					= C.CTNR_CD
					AND 	C.LANG_SE_CD 				= E.LANG_SE_CD
					AND	A.WRHS_CRCT_DOC_NO	=#{WRHS_CRCT_DOC_NO_RE}
	</select>
	
	<delete id="epce4705642_delete" parameterType="map" >
		DELETE FROM EXCA_WRHS_CRCT 
		 WHERE 1=1
			AND WRHS_CRCT_DOC_NO = #{WRHS_CRCT_DOC_NO_RE}
			AND WRHS_DOC_NO =#{WRHS_DOC_NO}
	</delete>
	  
<!--
/***************************************************************************************************************************************************************************************
* 	 입고내역선택 
****************************************************************************************************************************************************************************************/
  -->	
  
  <!-- 입고관리 조회  -->
	<select id="epce47056642_select" parameterType="map"   resultType="hashmap">
		<if test='excelYn == null or excelYn == "" '>
			SELECT 
					  *
			 FROM (
		</if>
					SELECT 
							<![CDATA[
						 				ROW_NUMBER()OVER(ORDER BY  A.RTN_REG_DT DESC, B.WHSDL_BIZRID ,B.MFC_BIZRID ,B.MFC_BRCH_ID) AS PNO
										, B.RTN_DOC_NO
										, B.WRHS_DOC_NO
										, A.RTN_REG_DT
										, A.RTN_DT
										, '<a href="javascript:dtl_link(1);" target="_self" class="gridLink">'||TO_CHAR(TO_DATE(B.WRHS_CFM_DT, 'yyyymmdd'),'yyyy-mm-dd')||'</a>' AS WRHS_CFM_DT 	
										,'<a href="javascript:dtl_link(2);" target="_self" class="gridLink">'||EPCN_ETC_NM(E.WRHS_CRCT_STAT_CD , 'C002')||'</a>' AS WRHS_CRCT_STAT_CD_NM
										, B.RTN_STAT_CD
										, C.BIZR_TP_CD AS BIZR_TP_CD_ORI
										, D.BIZRNM AS CUST_BIZRNM
										, A.FH_RTN_QTY_TOT
										, A.FB_RTN_QTY_TOT
										, A.DRCT_RTN_QTY_TOT
										, B.FH_CFM_QTY_TOT
										, B.FB_CFM_QTY_TOT
										, B.DRCT_CFM_QTY_TOT
										, B.WHSDL_BIZRID
										, B.WHSDL_BIZRNO  AS WHSDL_BIZRNO_ORI
										, PI_DECRYPT(B.WHSDL_BIZRNO) AS WHSDL_BIZRNO
										, B.WHSDL_BRCH_ID
										, B.WHSDL_BRCH_NO
										, B.MFC_BIZRID
										, B.MFC_BIZRNO
										, B.MFC_BRCH_ID
										, B.MFC_BRCH_NO
										, F.BIZRNM AS MFC_BIZRNM
										, F.BRCH_NM AS MFC_BRCH_NM
										, A.FH_RTN_QTY_TOT + A.FB_RTN_QTY_TOT + A.DRCT_RTN_QTY_TOT AS RTN_QTY_TOT
										, B.FH_CFM_QTY_TOT + B.FB_CFM_QTY_TOT + B.DRCT_CFM_QTY_TOT AS CFM_QTY_TOT
										, A.RTN_GTN_TOT
										, A.RTN_WHSL_FEE_TOT + A.RTN_RTL_FEE_TOT as RTN_FEE_TOT
										, A.RTN_WHSL_FEE_STAX_TOT
										, B.CFM_GTN_TOT
										, B.CFM_WHSL_FEE_TOT + B.CFM_RTL_FEE_TOT as CFM_FEE_TOT
										, B.CFM_WHSL_FEE_STAX_TOT
										, A.RTN_GTN_TOT + A.RTN_WHSL_FEE_TOT + A.RTN_WHSL_FEE_STAX_TOT + A.RTN_RTL_FEE_TOT   AS ATM_TOT
										, B.CFM_GTN_TOT + B.CFM_WHSL_FEE_TOT + B.CFM_WHSL_FEE_STAX_TOT + B.CFM_RTL_FEE_TOT  AS CFM_ATM_TOT
										, A.CAR_NO
										
										, E.CRCT_QTY
										, E.CRCT_GTN
										, E.CRCT_WHSL_FEE + E.CRCT_RTL_FEE AS CRCT_FEE_TOT
										, E.CRCT_WHSL_FEE_STAX  AS CRCT_FEE_STAX_TOT
										, E.CRCT_GTN + E.CRCT_WHSL_FEE + E.CRCT_RTL_FEE + E.CRCT_WHSL_FEE_STAX AS CRCT_ATM_TOT
										
										,E.WRHS_CRCT_DOC_NO

						]]>
					FROM 	EPCM_RTN_MST A
					 		   ,EPCM_CFM_MST B
					 		   ,EPCN_DTSS_CUST_INFO C
					 		   ,EPCN_BRCH_INFO D
					 		   ,(
					 		   	   SELECT WRHS_CRCT_DOC_NO, WRHS_CRCT_STAT_CD
					 		   	   			  ,SUM(CRCT_QTY) AS CRCT_QTY
					 		   	   			  ,SUM(CRCT_GTN) AS CRCT_GTN
					 		   	   			  ,SUM(CRCT_WHSL_FEE) AS CRCT_WHSL_FEE
					 		   	   			  ,SUM(CRCT_RTL_FEE) AS CRCT_RTL_FEE
					 		   	   			  ,SUM(CRCT_WHSL_FEE_STAX) AS CRCT_WHSL_FEE_STAX
					 		   	     FROM EXCA_WRHS_CRCT E
					 		   	    WHERE 1=1
					 		   	        AND E.WRHS_CRCT_STAT_CD = 'E' /* 도매업자 정산까지 모두 완료건 */
										AND E.LK_WRHS_CRCT_DOC_NO IS NULL /* 재등록되지 않은 입고정정문서 */
										AND E.EXCA_STD_CD = #{EXCA_STD_CD}
					 		   	   GROUP BY WRHS_CRCT_DOC_NO, WRHS_CRCT_STAT_CD  
					 		   ) E
					 		   ,EPCN_BRCH_INFO F
					WHERE 1=1
					AND A.RTN_DOC_NO 	  		= B.RTN_DOC_NO
					AND B.WHSDL_BIZRID			= C.CUST_BIZRID
					AND B.WHSDL_BIZRNO		= C.CUST_BIZRNO	
					AND B.WHSDL_BRCH_ID		= C.CUST_BRCH_ID
					AND B.WHSDL_BRCH_NO		= C.CUST_BRCH_NO	
					AND B.MFC_BIZRID				= C.MFC_BIZRID
					AND B.MFC_BIZRNO				= C.MFC_BIZRNO
					AND B.MFC_BRCH_ID			= C.MFC_BRCH_ID
					AND B.MFC_BRCH_NO			= C.MFC_BRCH_NO
					AND B.WHSDL_BIZRID			= D.BIZRID
					AND B.WHSDL_BIZRNO		= D.BIZRNO	
					AND B.WHSDL_BRCH_ID		= D.BRCH_ID
					AND B.WHSDL_BRCH_NO		= D.BRCH_NO	
					AND B.MFC_BIZRID				= F.BIZRID
					AND B.MFC_BIZRNO				= F.BIZRNO
					AND B.MFC_BRCH_ID			= F.BRCH_ID
					AND B.MFC_BRCH_NO			= F.BRCH_NO
					
					AND B.WRHS_CRCT_DOC_NO = E.WRHS_CRCT_DOC_NO
					

					 <if test="MFC_BIZRID !=''  and MFC_BIZRID !=null">
						AND B.MFC_BIZRID 		= #{MFC_BIZRID}
						AND B.MFC_BIZRNO 	= #{MFC_BIZRNO}
					</if>
					<if test="MFC_BRCH_ID !=''  and MFC_BRCH_ID !=null">
						AND B.MFC_BRCH_ID 	= #{MFC_BRCH_ID}
						AND B.MFC_BRCH_NO = #{MFC_BRCH_NO}
					</if>
					<if test="SYS_SE !=''  and SYS_SE !=null">
						AND B.SYS_SE		= #{SYS_SE}
					</if>
					<if test="BIZR_TP_CD !=''  and BIZR_TP_CD !=null">
						AND C.BIZR_TP_CD = #{BIZR_TP_CD}
					</if>
					<if test="WHSDL_BIZRID !=''  and WHSDL_BIZRID !=null">
						AND B.WHSDL_BIZRID = #{WHSDL_BIZRID}
						AND B.WHSDL_BIZRNO = #{WHSDL_BIZRNO}
					</if>
					
					<if test="EXCA_TRGT_SE.equalsIgnoreCase('I')" >
							 <if test="MFC_BIZRID  ==null ">
									AND	A.MFC_BIZRID || ';' || A.MFC_BIZRNO IN
						        <foreach collection="MFC_BIZRNM_RETURN"  item="type"  open="(" close=")" separator=",">
						            #{type.BIZRID_NO}
						        </foreach>
				       		</if>
		 			</if>	
		               	ORDER BY  A.RTN_REG_DT DESC, B.WHSDL_BIZRID ,B.MFC_BIZRID ,B.MFC_BRCH_ID
		 <if test='excelYn == null or excelYn == "" '>
			)
			WHERE PNO BETWEEN (#{ROWS_PER_PAGE}*(#{CURRENT_PAGE}-1))+1 AND #{ROWS_PER_PAGE}*#{CURRENT_PAGE}
		</if>	  
	</select>
	
	<!--상태체크-->
	<select id="epce47056642_select_cnt" parameterType="map" resultType="int">
 				SELECT   
		 					COUNT(1)
				 FROM 	EPCM_RTN_MST		A
				 		   ,EPCM_CFM_MST    	B
				 		   ,EPCN_DTSS_CUST_INFO	C
				 		   ,EPCN_BRCH_INFO			D
				 		   ,(
					 		   	   SELECT WRHS_CRCT_DOC_NO, WRHS_CRCT_STAT_CD
					 		   	   			  ,SUM(CRCT_QTY) AS CRCT_QTY
					 		   	   			  ,SUM(CRCT_GTN) AS CRCT_GTN
					 		   	   			  ,SUM(CRCT_WHSL_FEE) AS CRCT_WHSL_FEE
					 		   	   			  ,SUM(CRCT_RTL_FEE) AS CRCT_RTL_FEE
					 		   	   			  ,SUM(CRCT_WHSL_FEE_STAX) AS CRCT_WHSL_FEE_STAX
					 		   	     FROM EXCA_WRHS_CRCT E
					 		   	    WHERE 1=1
					 		   	        AND E.WRHS_CRCT_STAT_CD = 'E' /* 도매업자 정산까지 모두 완료건 */
										AND E.LK_WRHS_CRCT_DOC_NO IS NULL /* 재등록되지 않은 입고정정문서 */
										AND E.EXCA_STD_CD = #{EXCA_STD_CD}
					 		   	   GROUP BY WRHS_CRCT_DOC_NO, WRHS_CRCT_STAT_CD  
					 		   ) E
				WHERE 1=1
				AND A.RTN_DOC_NO 	  		= B.RTN_DOC_NO
				AND B.WHSDL_BIZRID			= C.CUST_BIZRID
				AND B.WHSDL_BIZRNO		= C.CUST_BIZRNO	
				AND B.WHSDL_BRCH_ID		= C.CUST_BRCH_ID
				AND B.WHSDL_BRCH_NO		= C.CUST_BRCH_NO	
				AND B.MFC_BIZRID				= C.MFC_BIZRID
				AND B.MFC_BIZRNO				= C.MFC_BIZRNO
				AND B.MFC_BRCH_ID			= C.MFC_BRCH_ID
				AND B.MFC_BRCH_NO			= C.MFC_BRCH_NO
				AND B.WHSDL_BIZRID			= D.BIZRID
				AND B.WHSDL_BIZRNO		= D.BIZRNO	
				AND B.WHSDL_BRCH_ID		= D.BRCH_ID
				AND B.WHSDL_BRCH_NO		= D.BRCH_NO	
				
				AND B.WRHS_CRCT_DOC_NO = E.WRHS_CRCT_DOC_NO
				
				 <if test="MFC_BIZRID !=''  and MFC_BIZRID !=null">
					AND B.MFC_BIZRID 		= #{MFC_BIZRID}
					AND B.MFC_BIZRNO 	= #{MFC_BIZRNO}
				</if>
				<if test="MFC_BRCH_ID !=''  and MFC_BRCH_ID !=null">
					AND B.MFC_BRCH_ID 	= #{MFC_BRCH_ID}
					AND B.MFC_BRCH_NO = #{MFC_BRCH_NO}
				</if>
				<if test="SYS_SE !=''  and SYS_SE !=null">
					AND B.SYS_SE		= #{SYS_SE}
				</if>
				<if test="BIZR_TP_CD !=''  and BIZR_TP_CD !=null">
					AND C.BIZR_TP_CD = #{BIZR_TP_CD}
				</if>
				<if test="WHSDL_BIZRID !=''  and WHSDL_BIZRID !=null">
					AND B.WHSDL_BIZRID = #{WHSDL_BIZRID}
					AND B.WHSDL_BIZRNO = #{WHSDL_BIZRNO}
				</if>
				
				<if test="EXCA_TRGT_SE.equalsIgnoreCase('I')" >
						 <if test="MFC_BIZRID  ==null ">
								AND	A.MFC_BIZRID || ';' || A.MFC_BIZRNO IN
					        <foreach collection="MFC_BIZRNM_RETURN"  item="type"  open="(" close=")" separator=",">
					            #{type.BIZRID_NO}
					        </foreach>
			       		</if>
		 		 </if>	
	
	</select>
	
	
	
</mapper>

